<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/heroicons@2.1.1/dist/solid/index.js"></script>
    <script type="module" src="https://unpkg.com/heroicons@2.1.1/dist/outline/index.js"></script>
    <style>
        body {
            /* Applied Inter font stack */
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #1f2937; /* Dark Gray for text */
        }
        /* Style to force uniform (tabular) number alignment for dashboard stats */
        #stat-total-capacity, #stat-occupancy-percent, #stat-open-complaints, #stat-attendance-percent, 
        #stat-fees-pending, #stat-visitors-today, #stat-occupancy-label, 
        #detail-stat-capacity, #detail-stat-occupancy, #detail-stat-available, .text-3xl {
            /* Force tabular numbers (aligns figures vertically regardless of width) */
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        .progress-ring-text { font-size: 0.75rem; font-weight: 600; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: all 0.3s ease-in-out; transform: translateY(-20px); opacity: 0; }
        .modal.active .modal-backdrop { opacity: 1; }
        .modal.active .modal-content { transform: translateY(0); opacity: 1; }
        .progress-bar { background-color: #e9ecef; border-radius: 9999px; overflow: hidden; height: 8px; }
        .progress-bar-inner { height: 100%; border-radius: 9999px; transition: width 0.3s ease; }
        .progress-ring-circle { transition: stroke-dashoffset 0.5s ease-out; transform: rotate(-90deg); transform-origin: 50% 50%; }
        .progress-ring-text { font-size: 1rem; font-weight: 600; }
        .activity-card-image {
            height: 150px;
            object-fit: cover;
            width: 100%;
        }
        /* Custom style to maintain space where the emoji/letter placeholder was */
        .icon-space { display: inline-block; width: 0.5em; overflow: hidden; }
    </style>
</head>
<body class="bg-blue-50 min-h-screen flex flex-col">
    <nav class="bg-white shadow-sm sticky top-0 z-20">
        <div class="w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex-shrink-0 flex items-center">
                    <h1 class="text-xl font-bold text-blue-600"><span class="icon-space"> </span>HOSTEL MANAGEMENT</h1>
                    <span class="ml-2 text-gray-500 font-medium hidden sm:inline">| Indian Institute of Technology</span>
                </div>
                <div class="flex items-center">
                    <button id="show-staff-view-btn" class="flex items-center text-sm font-medium text-purple-600 hover:text-purple-800 ml-6">
                        <hero-icon-outline name="user-group" class="h-5 w-5 mr-1"></hero-icon-outline>
                        Manage Staff
                    </button>
                    <button id="show-complaints-view-btn" class="flex items-center text-sm font-medium text-red-600 hover:text-red-800 ml-6">
                        <hero-icon-outline name="exclamation-circle" class="h-5 w-5 mr-1"></hero-icon-outline>
                        Complaints
                    </button>
                    <a href="adminhandlegymkhana.html" target="_top" class="ml-6 flex items-center text-sm font-medium text-purple-600 hover:text-purple-800">
                        <hero-icon-outline name="users" class="h-5 w-5 mr-1"></hero-icon-outline>
                        Gymkhana
                    </a>
                    <div class="ml-6 flex items-center">
                        <span class="text-sm font-medium text-gray-700 mr-3"><span class="icon-space"> </span>Admin</span>
                        <div class="flex-shrink-0">
                            <span class="inline-flex items-center justify-center h-10 w-10 rounded-full bg-yellow-400">
                                <span class="font-medium text-white">A</span>
                            </span>
                        </div>
                    </div>
                    <button id="admin-logout-btn" class="ml-6 flex items-center text-sm font-medium text-gray-600 hover:text-gray-900">
                        <hero-icon-outline name="arrow-right-on-rectangle" class="h-5 w-5 mr-1"></hero-icon-outline>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <main class="mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full flex-grow">
        <div id="dashboard-view">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div id="show-staff-view-card-btn" class="bg-purple-50 p-5 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1 cursor-pointer">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-sm font-medium text-purple-900 opacity-70">MANAGE STAFF</span>
                            <p class="text-3xl font-extrabold text-purple-900 mt-2" id="stat-total-staff">0</p>
                            <p class="text-sm text-purple-900 opacity-60">Total Staff Members</p>
                        </div>
                        <div class="p-3 bg-white rounded-full shadow-md">
                            <hero-icon-outline name="users" class="h-6 w-6 text-purple-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>
                <div class="bg-indigo-50 p-5 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-sm font-medium text-indigo-900 opacity-70">TOTAL CAPACITY</span>
                            <p class="text-3xl font-extrabold text-indigo-900 mt-2" id="stat-total-capacity">0</p>
                            <p class="text-sm text-indigo-900 opacity-60">Total Hostel Units</p>
                        </div>
                        <div class="p-3 bg-white rounded-full shadow-md">
                            <hero-icon-outline name="building-office-2" class="h-6 w-6 text-indigo-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>
                <div class="bg-amber-50 p-5 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-sm font-medium text-amber-900 opacity-70">OCCUPANCY</span>
                            <p class="text-3xl font-extrabold text-amber-900 mt-2" id="stat-occupancy-percent">0%</p>
                            <p class="text-sm text-amber-900 opacity-60">Beds Filled</p>
                        </div>
                        <div class="relative h-20 w-20 flex-shrink-0">
                            <svg class="h-full w-full" width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="18" cy="18" r="16" fill="none" class="text-amber-100" stroke-width="5"></circle>
                                <circle cx="18" cy="18" r="16" fill="none" class="progress-ring-circle text-amber-400" 
                                    stroke-width="5" 
                                    stroke-dasharray="100" 
                                    stroke-dashoffset="100" 
                                    stroke-linecap="round" 
                                    id="stat-occupancy-ring"></circle>
                            </svg>
                            <div class="absolute top-0 left-0 flex h-full w-full items-center justify-center">
                                <span class="progress-ring-text text-amber-600" id="stat-occupancy-label">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-red-50 p-5 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-sm font-medium text-red-900 opacity-70">OPEN COMPLAINTS</span>
                            <p class="text-3xl font-extrabold text-red-900 mt-2" id="stat-open-complaints">0</p>
                            <p class="text-sm text-red-900 opacity-60">Pending Resolution</p>
                        </div>
                        <div class="p-3 bg-white rounded-full shadow-md">
                            <hero-icon-outline name="exclamation-triangle" class="h-6 w-6 text-red-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>
                <div class="bg-emerald-50 p-5 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-sm font-medium text-emerald-900 opacity-70">DAILY ATTENDANCE</span>
                            <p class="text-3xl font-extrabold text-emerald-900 mt-2" id="stat-attendance-percent">98%</p>
                            <p class="text-sm text-emerald-900 opacity-60">Latest Check-in Rate</p>
                        </div>
                        <div class="relative h-20 w-20 flex-shrink-0">
                            <svg class="h-full w-full" width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="18" cy="18" r="16" fill="none" class="text-emerald-100" stroke-width="5"></circle>
                                <circle cx="18" cy="18" r="16" fill="none" class="progress-ring-circle text-emerald-400" 
                                    stroke-width="5" 
                                    stroke-dasharray="100" 
                                    stroke-dashoffset="2" 
                                    stroke-linecap="round"
                                    id="stat-attendance-ring"></circle>
                            </svg>
                            <div class="absolute top-0 left-0 flex h-full w-full items-center justify-center">
                                <span class="progress-ring-text text-emerald-600" id="stat-attendance-label">98%</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="show-fees-view-btn" class="bg-teal-50 p-5 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1 cursor-pointer">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-sm font-medium text-teal-900 opacity-70">FEES STATUS</span>
                            <p class="text-3xl font-extrabold text-teal-900 mt-2" id="stat-fees-pending">0 Pending</p>
                            <p class="text-sm text-teal-900 opacity-60">Total Dues</p>
                        </div>
                        <div class="p-3 bg-white rounded-full shadow-md">
                            <hero-icon-outline name="banknotes" class="h-6 w-6 text-teal-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>
                <div id="show-visitors-view-btn" class="bg-sky-50 p-5 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1 cursor-pointer">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-sm font-medium text-sky-900 opacity-70">VISITOR LOGS</span>
                            <p class="text-3xl font-extrabold text-sky-900 mt-2" id="stat-visitors-today">0 Today</p>
                            <p class="text-sm text-sky-900 opacity-60">Current Entries</p>
                        </div>
                        <div class="p-3 bg-white rounded-full shadow-md">
                            <hero-icon-outline name="identification" class="h-6 w-6 text-sky-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-900"><span class="icon-space"> </span>Hostel Block Summary</h2>
                    <button id="show-add-block-modal-btn" class="mt-4 sm:mt-0 flex items-center px-5 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300 hover:scale-105">
                        <hero-icon-solid name="plus" class="h-5 w-5 mr-2"></hero-icon-solid>
                        <span class="icon-space"> </span>Add New Block
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="hostel-block-container">
                </div>
            </div>
            <div class="mt-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-900"><span class="icon-space"> </span>Events & Announcements</h2>
                    <button id="show-add-event-modal-btn" class="mt-4 sm:mt-0 flex items-center px-5 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300 hover:scale-105">
                        <hero-icon-solid name="calendar-days" class="h-5 w-5 mr-2"></hero-icon-solid>
                        <span class="icon-space"> </span>Add New Event
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="event-list-container">
                </div>
            </div>
            <div class="mt-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-900"><span class="icon-space"> </span>Club Activities / Gymkhana</h2>
                    <button id="show-add-club-activity-modal-btn" class="mt-4 sm:mt-0 flex items-center px-5 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300 hover:scale-105">
                        <hero-icon-solid name="puzzle-piece" class="h-5 w-5 mr-2"></hero-icon-solid>
                        <span class="icon-space"> </span>Add New Activity
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="club-activity-container">
                </div>
            </div>
            <div class="mt-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-900"><span class="icon-space"> </span>Hostel Asset Inventory</h2>
                    <button id="show-add-asset-modal-btn" class="mt-4 sm:mt-0 flex items-center px-5 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300 hover:scale-105">
                        <hero-icon-solid name="archive-box-arrow-down" class="h-5 w-5 mr-2"></hero-icon-solid>
                        <span class="icon-space"> </span>Add New Asset
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="asset-inventory-container">
                    <p class="text-gray-500 col-span-full"><span class="icon-space"> </span>No assets added yet. Add assets to the inventory.</p>
                </div>
            </div>
        </div> 
        <div id="staff-view" class="hidden">
            <div class="relative mb-6 pb-4">
                <button id="back-to-dashboard-from-staff-btn" class="flex items-center text-sm font-medium text-gray-600 hover:text-gray-900">
                    <hero-icon-solid name="arrow-left" class="h-4 w-4 mr-2"></hero-icon-solid>
                    <span class="icon-space"> </span>Back to Dashboard
                </button>
                <div class="flex items-center justify-center absolute inset-x-0 top-0 -z-10">
                    <h1 class="text-xl sm:text-3xl font-bold text-purple-700">
                        Staff Management
                    </h1>
                </div>
            </div>
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <button id="show-add-staff-modal-btn" class="mt-4 sm:mt-0 flex items-center px-5 py-3 bg-purple-600 text-white font-medium rounded-lg shadow-md hover:bg-purple-700 transition-all duration-300 w-full md:w-auto">
                    <hero-icon-solid name="user-plus" class="h-5 w-5 mr-2"></hero-icon-solid>
                    <span class="icon-space"> </span>Add New Staff
                </button>
                <input type="text" id="staff-search-input" placeholder="Search by name, position, or block..." class="px-4 py-2 border rounded-lg shadow-sm w-full md:w-auto">
            </div>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full min-w-max">
                        <thead class="bg-purple-100 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-purple-800 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-purple-800 uppercase tracking-wider">Position</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-purple-800 uppercase tracking-wider">Hostel Block</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-purple-800 uppercase tracking-wider">Contact Info</th>
                                <th class="px-6 py-3 text-center text-xs font-semibold text-purple-800 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="staff-list-container" class="divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="detail-view" class="hidden">
            <div class="relative mb-6 pb-4">
                <button id="back-to-dashboard-btn" class="flex items-center text-sm font-medium text-gray-600 hover:text-gray-900">
                    <hero-icon-solid name="arrow-left" class="h-4 w-4 mr-2"></hero-icon-solid>
                    <span class="icon-space"> </span>Back to Dashboard
                </button>
                <div class="flex items-center justify-center absolute inset-x-0 top-0 -z-10">
                    <h1 id="detail-hostel-name" class="text-xl sm:text-3xl font-bold text-gray-800" style="color: #4b0082;"></h1>
                </div>
            </div>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md border-l-8 border-blue-500 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div>
                        <span class="text-gray-500"><span class="icon-space"> </span>Capacity: </span>
                        <span class="text-xl sm:text-2xl font-bold" style="color: #800080;" id="detail-stat-capacity">0</span>
                    </div>
                    <div>
                        <span class="text-gray-500"><span class="icon-space"> </span>Occupancy: </span>
                        <span class="text-xl sm:text-2xl font-bold" style="color: #ffa500;" id="detail-stat-occupancy">0</span>
                    </div>
                    <div>
                        <span class="text-gray-500"><span class="icon-space"> </span>Available Beds: </span>
                        <span class="text-xl sm:text-2xl font-bold" style="color: #008000;" id="detail-stat-available">0</span>
                    </div>
                </div>
            </div>
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <div class="flex flex-wrap gap-4">
                    <button id="show-add-student-modal-btn" class="flex items-center px-5 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300 hover:scale-105">
                        <hero-icon-solid name="user-plus" class="h-5 w-5 mr-2"></hero-icon-solid>
                        <span class="icon-space"> </span>Add New Student
                    </button>
                    <button id="show-add-room-modal-btn" class="flex items-center px-5 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300 hover:scale-105">
                        <hero-icon-solid name="building-office-plus" class="h-5 w-5 mr-2"></hero-icon-solid>
                        <span class="icon-space"> </span>Add New Room
                    </button>
                </div>
                <div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
                    <input type="text" id="room-search-input" placeholder="Search room number..." class="px-4 py-2 border rounded-lg shadow-sm w-full sm:w-auto">
                    <select id="room-filter-select" class="px-4 py-2 border rounded-lg shadow-sm w-full sm:w-auto">
                        <option value="All">All Rooms</option>
                        <option value="Full">Full</option>
                        <option value="Available">Available</option>
                    </select>
                </div>
            </div>
            <div id="room-list-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            </div>
        </div>
        <div id="fees-view" class="hidden">
            <div class="relative mb-6 pb-4">
                <button id="back-to-dashboard-from-fees-btn" class="flex items-center text-sm font-medium text-gray-600 hover:text-gray-900">
                    <hero-icon-solid name="arrow-left" class="h-4 w-4 mr-2"></hero-icon-solid>
                    <span class="icon-space"> </span>Back to Dashboard
                </button>
                <div class="flex items-center justify-center absolute inset-x-0 top-0 -z-10">
                    <h1 class="text-xl sm:text-3xl font-bold text-teal-700">
                        Fees Management
                    </h1>
                </div>
            </div>
            <div class="flex flex-col md:flex-row justify-end items-center mb-6 gap-4">
                <input type="text" id="fees-search-input" placeholder="Search by name or roll no..." class="px-4 py-2 border rounded-lg shadow-sm w-full md:w-auto">
                <select id="fees-filter-select" class="px-4 py-2 border rounded-lg shadow-sm w-full md:w-auto">
                    <option value="All">All Statuses</option>
                    <option value="Paid">Paid</option>
                    <option value="Pending">Pending</option>
                </select>
            </div>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full min-w-max">
                        <thead class="bg-gray-100 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Student Name</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Roll Number</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Block / Room</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Action</th>
                            </tr>
                        </thead>
                        <tbody id="fees-student-list-container" class="divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="visitors-view" class="hidden">
            <div class="relative mb-6 pb-4">
                <button id="back-to-dashboard-from-visitors-btn" class="flex items-center text-sm font-medium text-gray-600 hover:text-gray-900">
                    <hero-icon-solid name="arrow-left" class="h-4 w-4 mr-2"></hero-icon-solid>
                    <span class="icon-space"> </span>Back to Dashboard
                </button>
                <div class="flex items-center justify-center absolute inset-x-0 top-0 -z-10">
                    <h1 class="text-xl sm:text-3xl font-bold text-sky-700">
                        Visitor Logs
                    </h1>
                </div>
            </div>
            <div class="flex flex-col md:flex-row justify-end items-center mb-6 gap-4">
                <input type="text" id="visitor-search-input" placeholder="Search by visitor or student name..." class="px-4 py-2 border rounded-lg shadow-sm w-full md:w-auto">
                <input type="date" id="visitor-date-filter" class="px-4 py-2 border rounded-lg shadow-sm w-full md:w-auto">
            </div>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full min-w-max">
                        <thead class="bg-gray-100 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Visitor Name</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Student Visited</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Room</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Time In</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Time Out</th>
                            </tr>
                        </thead>
                        <tbody id="visitor-log-container" class="divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="complaints-view" class="hidden">
            <div class="relative mb-6 pb-4">
                <button id="back-to-dashboard-from-complaints-btn" class="flex items-center text-sm font-medium text-gray-600 hover:text-gray-900">
                    <hero-icon-solid name="arrow-left" class="h-4 w-4 mr-2"></hero-icon-solid>
                    <span class="icon-space"> </span>Back to Dashboard
                </button>
                <div class="flex items-center justify-center absolute inset-x-0 top-0 -z-10">
                    <h1 class="text-xl sm:text-3xl font-bold text-red-700">
                        Student Complaints
                    </h1>
                </div>
            </div>
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                    <input type="text" id="complaint-search-input" placeholder="Search by student name or room..." class="px-4 py-2 border rounded-lg shadow-sm w-full md:w-auto">
                    <select id="complaint-status-filter" class="px-4 py-2 border rounded-lg shadow-sm w-full md:w-auto">
                        <option value="All">All Status</option>
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                    <select id="complaint-type-filter" class="px-4 py-2 border rounded-lg shadow-sm w-full md:w-auto">
                        <option value="All">All Types</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Cleaning">Cleaning</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Plumbing">Plumbing</option>
                        <option value="Internet">Internet</option>
                        <option value="Security">Security</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <button id="refresh-complaints-btn" class="flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300">
                    <hero-icon-solid name="arrow-path" class="h-5 w-5 mr-2"></hero-icon-solid>
                    Refresh
                </button>
            </div>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full min-w-max">
                        <thead class="bg-gray-100 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Student</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Room</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Complaint Type</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Description</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="complaints-list-container" class="divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
    <footer class="mt-12 py-6 border-t border-gray-200 bg-white">
        <div class="w-full mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm text-gray-500">
                &copy; 2025 Indian Institute of Technology. All rights reserved.
            </p>
        </div>
    </footer>

    <div id="add-staff-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-staff-modal"></div>
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl z-40 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4 text-purple-700">âž• Add New Staff Member</h2>
            <form id="add-staff-form" class="space-y-4">
                <h3 class="text-sm font-medium text-gray-500 border-b pb-1">Personal Details</h3>
                <div>
                    <label for="staff-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="staff-name" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Jane Doe" required>
                </div>
                <div>
                    <label for="staff-position" class="block text-sm font-medium text-gray-700">Position Name</label>
                    <input type="text" id="staff-position" name="position" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Caretaker, Security Guard" required>
                </div>
                
                <h3 class="text-sm font-medium text-gray-500 border-b pt-2 pb-1">Assignment Details</h3>
                <div>
                    <label for="staff-hostel-block" class="block text-sm font-medium text-gray-700">Hostel Block Assignment</label>
                    <div class="flex items-center space-x-2">
                        <select id="staff-hostel-block" name="hostelBlock" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500">
                            </select>
                        <input type="text" id="staff-block-manual" name="blockManual" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm hidden" placeholder="Manual Block Name (e.g. Main Gate)">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">Select an existing block or choose 'Other' to manually type a location.</p>
                </div>

                <h3 class="text-sm font-medium text-gray-500 border-b pt-2 pb-1">Contact & Login</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="staff-contact" class="block text-sm font-medium text-gray-700">Contact Info (Phone)</label>
                        <input type="tel" id="staff-contact" name="contact" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="+91 XXXXX XXXXX" required>
                    </div>
                    <div>
                        <label for="staff-email" class="block text-sm font-medium text-gray-700">Email (Optional)</label>
                        <input type="email" id="staff-email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="staff@iit.edu">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="staff-username" class="block text-sm font-medium text-gray-700">Username</label>
                        <input type="text" id="staff-username" name="username" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <label for="staff-password" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="staff-password" name="password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                </div>
                
                <div>
                    <label for="staff-image-file" class="block text-sm font-medium text-gray-700">Upload Image</label>
                    <input type="file" id="staff-image-file" name="staffImage" class="mt-1 block w-full text-sm text-gray-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-purple-50 file:text-purple-700
                                hover:file:bg-purple-100"
                                accept="image/*">
                    <p class="mt-1 text-xs text-gray-500">Upload a professional photo from device.</p>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300" data-modal-hide="add-staff-modal">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">Save Staff</button>
                </div>
            </form>
        </div>
    </div>
    <div id="add-block-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-block-modal"></div>
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl z-40 w-full max-w-md mx-4">
            <h2 class="text-xl font-semibold mb-4"><span class="icon-space"> </span>Add New Hostel Block</h2>
            <form id="add-block-form" class="space-y-4">
                <div>
                    <label for="block-name" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Block Name</label>
                    <input type="text" id="block-name" name="blockName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Sarojini Hall" required>
                </div>
                <div>
                    <label for="block-key" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Unique Key</label>
                    <input type="text" id="block-key" name="blockKey" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., 'sarojini' (lowercase, no spaces)" required>
                </div>
                <div>
                    <label for="block-theme" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Theme Color</label>
                    <select id="block-theme" name="blockTheme" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        <option value="pink">Pink (Women)</option>
                        <option value="blue">Blue (Men)</option>
                        <option value="green">Green</option>
                        <option value="purple">Purple</option>
                        <option value="yellow">Yellow</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300" data-modal-hide="add-block-modal"><span class="icon-space"> </span>Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"><span class="icon-space"> </span>Save Block</button>
                </div>
            </form>
        </div>
    </div>
    <div id="add-room-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-room-modal"></div>
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl z-40 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4"><span class="icon-space"> </span>Add New Room</h2>
            <form id="add-room-form" class="space-y-4">
                <div>
                    <label for="room-id" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Room ID / Number</label>
                    <input type="text" id="room-id" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., A-103" required>
                </div>
                <div>
                    <label for="room-floor" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Floor Details</label>
                    <input type="text" id="room-floor" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., 1st Floor, A-Block" required>
                </div>
                <div>
                    <label for="room-capacity" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Total Capacity</label>
                    <input type="number" id="room-capacity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" value="2" min="1" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Assign Assets to Room</label>
                    <div id="room-asset-assignment-container" class="mt-2 space-y-3">
                    </div>
                    <button type="button" id="add-room-asset-row-btn" class="mt-2 text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center">
                        <hero-icon-solid name="plus-circle" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Add Asset
                    </button>
                </div>
                <div>
                    <label for="room-image-file" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Upload Room Image</label>
                    <input type="file" id="room-image-file" name="roomImage" class="mt-1 block w-full text-sm text-gray-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-blue-50 file:text-blue-700
                                hover:file:bg-blue-100"
                                accept="image/*">
                    <p class="mt-1 text-xs text-gray-500">Upload an image of the room (PNG, JPG, etc.).</p>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300" data-modal-hide="add-room-modal"><span class="icon-space"> </span>Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"><span class="icon-space"> </span>Add Room</button>
                </div>
            </form>
        </div>
    </div>
    <div id="add-student-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-student-modal"></div>
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl z-40 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4"><span class="icon-space"> </span>Add New Student</h2>
            <form id="add-student-form" class="space-y-4">
                <h3 class="text-sm font-medium text-gray-500 border-b pb-1"><span class="icon-space"> </span>Login Details</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="student-username" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Username</label>
                        <input type="text" id="student-username" name="username" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <label for="student-password" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Password</label>
                        <input type="password" id="student-password" name="password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                </div>
                <h3 class="text-sm font-medium text-gray-500 border-b pt-2 pb-1"><span class="icon-space"> </span>Hostel Details</h3>
                <div>
                    <label for="student-room-id" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Select Room</label>
                    <select id="student-room-id" name="roomId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                    </select>
                </div>
                <div>
                    <label for="student-joining-date" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Joining Date</label>
                    <input type="date" id="student-joining-date" name="joiningDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="student-fee-status" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Fee Status</label>
                        <select id="student-fee-status" name="feeStatus" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                            <option value="Paid">Paid</option>
                            <option value="Pending" selected>Pending</option>
                        </select>
                    </div>
                    <div>
                        <label for="student-payment-method" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Payment Method</label>
                        <select id="student-payment-method" name="paymentMethod" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                            <option value="Not Paid">Not Paid</option>
                            <option value="Cash">Cash</option>
                            <option value="Card">Card</option>
                            <option value="Online">Online</option>
                        </select>
                    </div>
                </div>
                <h3 class="text-sm font-medium text-gray-500 border-b pt-2 pb-1"><span class="icon-space"> </span>Personal & Academic</h3>
                <div>
                    <label for="student-name" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Student Name</label>
                    <input type="text" id="student-name" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Enter full name" required>
                </div>
                <div>
                    <label for="student-roll-number" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Roll Number</label>
                    <input type="text" id="student-roll-number" name="rollNumber" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., 21CS10001" required>
                </div>
                <div>
                    <label for="student-course" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Course</label>
                    <input type="text" id="student-course" name="course" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., B.Tech">
                </div>
                <div>
                    <label for="student-department" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Department</label>
                    <input type="text" id="student-department" name="department" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., CSE">
                </div>
                <div>
                    <label for="student-year" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Year</label>
                    <input type="text" id="student-year" name="year" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., 3rd Year">
                </div>
                <div>
                    <label for="student-email" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Email</label>
                    <input type="email" id="student-email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="student@iit.edu">
                </div>
                <div>
                    <label for="student-phone" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Phone</label>
                    <input type="tel" id="student-phone" name="phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="+91 XXXXX XXXXX">
                </div>
                <div>
                    <label for="student-profile-image" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Upload Profile Photo</label>
                    <input type="file" id="student-profile-image" name="profileImage" class="mt-1 block w-full text-sm text-gray-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-blue-50 file:text-blue-700
                                hover:file:bg-blue-100"
                                accept="image/*">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Assign Assets to Student</label>
                    <div id="student-asset-assignment-container" class="mt-2 space-y-3">
                                </div>
                    <button type="button" id="add-student-asset-row-btn" class="mt-2 text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center">
                        <hero-icon-solid name="plus-circle" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Add Asset
                    </button>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300" data-modal-hide="add-student-modal"><span class="icon-space"> </span>Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"><span class="icon-space"> </span>Add Student</button>
                </div>
            </form>
        </div>
    </div>
    <div id="add-event-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-event-modal"></div>
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl z-40 w-full max-w-md mx-4">
            <h2 class="text-xl font-semibold mb-4"><span class="icon-space"> </span>Add Event or Announcement</h2>
            <form id="add-event-form" class="space-y-4">
                <div>
                    <label for="event-title" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Title</label>
                    <input type="text" id="event-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                </div>
                <div>
                    <label for="event-type" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Type</label>
                    <select id="event-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        <option value="Sports">Sports</option>
                        <option value="Club Activity">Club Activity</option>
                        <option value="Announcement">Announcement</option>
                        <option value="General">General</option>
                    </select>
                </div>
                <div>
                    <label for="event-date" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Date</label>
                    <input type="date" id="event-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                </div>
                <div>
                    <label for="event-description" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Description</label>
                    <textarea id="event-description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300" data-modal-hide="add-event-modal"><span class="icon-space"> </span>Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"><span class="icon-space"> </span>Post Event</button>
                </div>
            </form>
        </div>
    </div>
    <div id="room-details-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="room-details-modal"></div>
        <div class="modal-content bg-gray-50 rounded-lg shadow-xl z-40 w-full max-w-3xl mx-4 max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-5 border-b bg-white rounded-t-lg">
                <div class="flex items-center gap-3">
                    <h2 class="text-xl font-bold text-gray-800" id="modal-room-title"><span class="icon-space"> </span>Room Details: A-101</h2>
                    <span id="modal-room-complaints-badge" class="hidden items-center text-xs font-bold px-3 py-1 bg-red-100 text-red-600 rounded-full">
                        <hero-icon-solid name="exclamation-circle" class="h-4 w-4 mr-1"></hero-icon-solid>
                        <span id="modal-room-complaints-count">1</span> Complaint
                    </span>
                </div>
                <button data-modal-hide="room-details-modal" class="text-gray-400 hover:text-gray-600">
                    <hero-icon-solid name="x-mark" class="h-6 w-6"></hero-icon-solid>
                </button>
            </div>
            <div class="p-6 overflow-y-auto space-y-6">
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <div class="flex gap-4 text-center">
                        <div class="flex-1">
                            <span class="text-sm text-gray-500"><span class="icon-space"> </span>Capacity</span>
                            <p class="text-2xl font-bold text-gray-800" id="modal-room-capacity">2</p>
                        </div>
                        <div class="flex-1">
                            <span class="text-sm text-gray-500"><span class="icon-space"> </span>Occupancy</span>
                            <p class="text-2xl font-bold text-blue-600" id="modal-room-occupancy">2</p>
                        </div>
                        <div class="flex-1">
                            <span class="text-sm text-gray-500"><span class="icon-space"> </span>Available Beds: </span>
                            <p class="text-2xl font-bold text-green-600" id="modal-room-available">0</p>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900" id="modal-occupant-title"><span class="icon-space"> </span>Current Occupants (2)</h3>
                        <button id="modal-delete-room-btn" class="flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg shadow-md hover:bg-red-700">
                            <hero-icon-solid name="trash" class="h-5 w-5 mr-2"></hero-icon-solid>
                            <span class="icon-space"> </span>Delete Room
                        </button>
                    </div>
                    <div id="modal-occupant-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>
                <div>
                    <div class="flex items-center gap-2 mb-4">
                        <hero-icon-solid name="exclamation-triangle" class="h-5 w-5 text-yellow-600"></hero-icon-solid>
                        <h3 class="text-lg font-semibold text-gray-900">Open Issues In This Room</h3>
                    </div>
                    <div id="modal-issues-container" class="space-y-3"></div>
                </div>
            </div>
            <div class="p-4 bg-white border-t rounded-b-lg text-right">
                <a href="#" id="modal-view-all-complaints" class="text-sm font-medium text-blue-600 hover:text-blue-800">
                    View All Complaint Tickets &rarr;
                </a>
            </div>
        </div>
    </div>
    <div id="add-club-activity-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-club-activity-modal"></div>
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl z-40 w-full max-w-md mx-4">
            <h2 class="text-xl font-semibold mb-4"><span class="icon-space"> </span>Add New Club Activity</h2>
            <form id="add-club-activity-form" class="space-y-4">
                <div>
                    <label for="club-activity-title" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Activity Title</label>
                    <input type="text" id="club-activity-title" name="title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Inter-Hostel Cricket Finals" required>
                </div>
                <div>
                    <label for="club-activity-type" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Activity Type</label>
                    <select id="club-activity-type" name="type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        <option value="Sports">Sports</option>
                        <option value="Cultural">Cultural</option>
                        <option value="Technical">Technical</option>
                        <option value="Workshop">Workshop</option>
                        <option value="General">General</option>
                    </select>
                </div>
                <div>
                    <label for="club-activity-date" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Date</label>
                    <input type="date" id="club-activity-date" name="date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                </div>
                <div>
                    <label for="club-activity-description" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Description</label>
                    <textarea id="club-activity-description" name="description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Add relevant details..."></textarea>
                </div>
                <div>
                    <label for="club-activity-image-file" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Upload Image</label>
                    <input type="file" id="club-activity-image-file" name="clubActivityImage" class="mt-1 block w-full text-sm text-gray-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-blue-50 file:text-blue-700
                                hover:file:bg-blue-100"
                                accept="image/*">
                    <p class="mt-1 text-xs text-gray-500">Upload an image from your device (PNG, JPG, etc.).</p>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300" data-modal-hide="add-club-activity-modal"><span class="icon-space"> </span>Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"><span class="icon-space"> </span>Post Activity</button>
                </div>
            </form>
        </div>
    </div>
    <div id="add-asset-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-asset-modal"></div>
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl z-40 w-full max-w-md mx-4">
            <h2 class="text-xl font-semibold mb-4"><span class="icon-space"> </span>Add New Asset to Inventory</h2>
            <form id="add-asset-form" class="space-y-4">
                <div>
                    <label for="asset-type" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Asset Type</label>
                    <select id="asset-type" name="type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        <option value="Table">Table</option>
                        <option value="Chair">Chair</option>
                        <option value="Bed">Bed</option>
                        <option value="Mattress">Mattress</option>
                        <option value="Cupboard">Cupboard</option>
                        <option value="Fan">Fan</option>
                        <option value="Light">Light</option>
                        <option value="System">System (PC)</option>
                        <option value="Other">Other (Specify)</option>
                    </select>
                </div>
                <div id="asset-name-other-wrapper" class="hidden">
                    <label for="asset-name-other" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Specify Asset Name</label>
                    <input type="text" id="asset-name-other" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Study Lamp">
                </div>
                <div>
                    <label for="asset-quantity" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Quantity</label>
                    <input type="number" id="asset-quantity" name="quantity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" min="1" value="1" required>
                </div>
                <div>
                    <label for="asset-description" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Description / Notes</label>
                    <textarea id="asset-description" name="description" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="e.g., Location, condition..."></textarea>
                </div>
                <div>
                    <label for="asset-image-file" class="block text-sm font-medium text-gray-700"><span class="icon-space"> </span>Upload Asset Image</label>
                    <input type="file" id="asset-image-file" name="assetImage" class="mt-1 block w-full text-sm text-gray-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-blue-50 file:text-blue-700
                                hover:file:bg-blue-100"
                                accept="image/*">
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300" data-modal-hide="add-asset-modal"><span class="icon-space"> </span>Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"><span class="icon-space"> </span>Save Asset</button>
                </div>
            </form>
        </div>
    </div>
    <div id="complaint-details-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="complaint-details-modal"></div>
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl z-40 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4"><span class="icon-space"> </span>Complaint Details</h2>
            <div id="complaint-details-content" class="space-y-4">
            </div>
            <div class="flex justify-end space-x-3 pt-4 mt-6 border-t">
                <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300" data-modal-hide="complaint-details-modal"><span class="icon-space"> </span>Close</button>
            </div>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- 1. GLOBAL STATE (Includes new Staff Data Structure) ---
        let appState = { 
            blocks: [], 
            assets: [],
            complaints: [],
            // NEW STAFF DATA STRUCTURE
            staff: [
                { _id: 'S001', name: 'Ravi Kumar', position: 'Caretaker', hostelBlock: 'A-Block', contact: '9876543210', email: 'ravi@iit.edu', username: 'ravi001', imageUrl: 'https://via.placeholder.com/150/7c3aed/FFFFFF?text=RK' },
                { _id: 'S002', name: 'Pooja Devi', position: 'Cleaning Staff', hostelBlock: 'Sarojini Hall', contact: '9988776655', email: 'pooja@iit.edu', username: 'pooja001', imageUrl: 'https://via.placeholder.com/150/9333ea/FFFFFF?text=PD' }
            ] 
            // END NEW STAFF DATA STRUCTURE
        }; 
        let eventData = [
            { id: 1, title: 'Inter-Hostel Cricket Match', type: 'Sports', date: '2025-11-10', description: 'Finals between Men\'s Hostel and Women\'s Hostel.' },
            { id: 2, title: 'Mess Committee Meeting', type: 'Announcement', date: '2025-11-05', description: 'Discussing the new menu for next month.' }
        ];
        let visitorLogData = [
            { id: 1, visitorName: 'Ramesh Kumar', studentName: 'Priya Sharma', roomNumber: 'A-101', date: '2025-11-05', timeIn: '09:00 AM', timeOut: '10:30 AM' },
            { id: 2, visitorName: 'Sita Devi', studentName: 'Rohan Verma', roomNumber: 'B-205', date: '2025-11-05', timeIn: '10:00 AM', timeOut: '11:00 AM' },
            { id: 3, visitorName: 'Arjun Singh', studentName: 'Vikram Singh', roomNumber: 'B-202', date: '2025-11-04', timeIn: '04:00 PM', timeOut: '05:00 PM' }
        ];
        let currentRoomData = null; 

        // --- 2. DOM Elements (Add Staff Elements) ---
        const dashboardView = document.getElementById('dashboard-view');
        const detailView = document.getElementById('detail-view');
        const feesView = document.getElementById('fees-view');
        const showFeesViewBtn = document.getElementById('show-fees-view-btn');
        const backToDashboardFromFeesBtn = document.getElementById('back-to-dashboard-from-fees-btn');
        const feesStudentListContainer = document.getElementById('fees-student-list-container');
        const feesSearchInput = document.getElementById('fees-search-input');
        const feesFilterSelect = document.getElementById('fees-filter-select');
        const statFeesPending = document.getElementById('stat-fees-pending');

        const visitorsView = document.getElementById('visitors-view');
        const showVisitorsViewBtn = document.getElementById('show-visitors-view-btn');
        const backToDashboardFromVisitorsBtn = document.getElementById('back-to-dashboard-from-visitors-btn');
        const visitorLogContainer = document.getElementById('visitor-log-container');
        const visitorSearchInput = document.getElementById('visitor-search-input');
        const visitorDateFilter = document.getElementById('visitor-date-filter');
        const statVisitorsToday = document.getElementById('stat-visitors-today');
        
        // Complaints View Elements
        const complaintsView = document.getElementById('complaints-view');
        const showComplaintsViewBtn = document.getElementById('show-complaints-view-btn');
        const backToDashboardFromComplaintsBtn = document.getElementById('back-to-dashboard-from-complaints-btn');
        const complaintsListContainer = document.getElementById('complaints-list-container');
        const complaintSearchInput = document.getElementById('complaint-search-input');
        const complaintStatusFilter = document.getElementById('complaint-status-filter');
        const complaintTypeFilter = document.getElementById('complaint-type-filter');
        const refreshComplaintsBtn = document.getElementById('refresh-complaints-btn');
        const statOpenComplaints = document.getElementById('stat-open-complaints');
        const complaintDetailsModal = document.getElementById('complaint-details-modal');
        const complaintDetailsContent = document.getElementById('complaint-details-content');
        
        const hostelBlockContainer = document.getElementById('hostel-block-container');
        const statTotalCapacity = document.getElementById('stat-total-capacity');
        const statOccupancyPercent = document.getElementById('stat-occupancy-percent');
        const statOccupancyLabel = document.getElementById('stat-occupancy-label');
        const statOccupancyRing = document.getElementById('stat-occupancy-ring');
        const eventListContainer = document.getElementById('event-list-container');
        const detailHostelName = document.getElementById('detail-hostel-name');
        const backToDashboardBtn = document.getElementById('back-to-dashboard-btn');
        const roomListContainer = document.getElementById('room-list-container');
        const detailStatCapacity = document.getElementById('detail-stat-capacity');
        const detailStatOccupancy = document.getElementById('detail-stat-occupancy');
        const detailStatAvailable = document.getElementById('detail-stat-available');
        const roomSearchInput = document.getElementById('room-search-input');
        const roomFilterSelect = document.getElementById('room-filter-select');
        const showAddBlockModalBtn = document.getElementById('show-add-block-modal-btn');
        const addBlockForm = document.getElementById('add-block-form');
        const showAddRoomModalBtn = document.getElementById('show-add-room-modal-btn');
        const addRoomForm = document.getElementById('add-room-form');
        const showAddStudentModalBtn = document.getElementById('show-add-student-modal-btn');
        const addStudentForm = document.getElementById('add-student-form');
        const studentRoomSelect = document.getElementById('student-room-id');
        const showAddEventModalBtn = document.getElementById('show-add-event-modal-btn');
        const addEventForm = document.getElementById('add-event-form');
        const adminLogoutBtn = document.getElementById('admin-logout-btn'); 
        
        // Room Detail Modal Elements
        const roomDetailsModal = document.getElementById('room-details-modal');
        const modalRoomTitle = document.getElementById('modal-room-title');
        const modalRoomComplaintsBadge = document.getElementById('modal-room-complaints-badge');
        const modalRoomComplaintsCount = document.getElementById('modal-room-complaints-count');
        const modalRoomCapacity = document.getElementById('modal-room-capacity');
        const modalRoomOccupancy = document.getElementById('modal-room-occupancy');
        const modalRoomAvailable = document.getElementById('modal-room-available');
        const modalOccupantTitle = document.getElementById('modal-occupant-title');
        const modalOccupantContainer = document.getElementById('modal-occupant-container');
        const modalIssuesContainer = document.getElementById('modal-issues-container');
        const modalDeleteRoomBtn = document.getElementById('modal-delete-room-btn'); 

        // Club Activity Elements
        const clubActivityContainer = document.getElementById('club-activity-container');
        const showAddClubActivityModalBtn = document.getElementById('show-add-club-activity-modal-btn');
        const addClubActivityForm = document.getElementById('add-club-activity-form');
        
        // Asset Elements
        const assetInventoryContainer = document.getElementById('asset-inventory-container');
        const showAddAssetModalBtn = document.getElementById('show-add-asset-modal-btn');
        const addAssetForm = document.getElementById('add-asset-form');
        const assetTypeSelect = document.getElementById('asset-type');
        const assetNameOtherWrapper = document.getElementById('asset-name-other-wrapper');
        
        // Asset Assignment Elements
        const addRoomAssetRowBtn = document.getElementById('add-room-asset-row-btn');
        const roomAssetAssignmentContainer = document.getElementById('room-asset-assignment-container');
        const addStudentAssetRowBtn = document.getElementById('add-student-asset-row-btn');
        const studentAssetAssignmentContainer = document.getElementById('student-asset-assignment-container');

        // NEW STAFF ELEMENTS
        const staffView = document.getElementById('staff-view');
        const showStaffViewBtn = document.getElementById('show-staff-view-btn');
        const showStaffViewCardBtn = document.getElementById('show-staff-view-card-btn');
        const backToDashboardFromStaffBtn = document.getElementById('back-to-dashboard-from-staff-btn');
        const staffListContainer = document.getElementById('staff-list-container');
        const staffSearchInput = document.getElementById('staff-search-input');
        const statTotalStaff = document.getElementById('stat-total-staff');
        const showAddStaffModalBtn = document.getElementById('show-add-staff-modal-btn');
        const addStaffForm = document.getElementById('add-staff-form');
        const staffHostelBlockSelect = document.getElementById('staff-hostel-block');
        const staffBlockManualInput = document.getElementById('staff-block-manual');
        // END NEW STAFF ELEMENTS


        // --- 3. THEME/HELPER DATA ---
        const themes = { 
            pink: { border: 'border-pink-500', bg: 'bg-pink-100', text: 'text-pink-600', icon: 'user-group' },
            blue: { border: 'border-blue-500', bg: 'bg-blue-100', text: 'text-blue-600', icon: 'user-group' },
            green: { border: 'border-green-500', bg: 'bg-green-100', text: 'text-green-600', icon: 'building-office' },
            purple: { border: 'border-purple-500', bg: 'bg-purple-100', text: 'text-purple-600', icon: 'academic-cap' },
            yellow: { border: 'border-yellow-500', bg: 'bg-yellow-100', text: 'text-yellow-600', icon: 'beaker' },
        };
        const eventThemes = { 
            'Sports': { border: 'border-green-500', bg: 'bg-green-100', text: 'text-green-700' },
            'Club Activity': { border: 'border-purple-500', bg: 'bg-purple-100', text: 'text-purple-700' },
            'Announcement': { border: 'border-red-500', bg: 'bg-red-100', text: 'text-red-700' },
            'General': { border: 'border-blue-500', bg: 'bg-blue-100', text: 'text-blue-700' },
        };
        const clubActivityThemes = { 
            'Sports': { border: 'border-orange-500', bg: 'bg-orange-100', text: 'text-orange-700' },
            'Cultural': { border: 'border-pink-500', bg: 'bg-pink-100', text: 'text-pink-700' },
            'Technical': { border: 'border-indigo-500', bg: 'bg-indigo-100', text: 'text-indigo-700' },
            'Workshop': { border: 'border-yellow-500', bg: 'bg-yellow-100', text: 'text-yellow-700' },
            'General': { border: 'border-gray-500', bg: 'bg-gray-100', text: 'text-gray-700' },
        };
        const getStatus = (current, max) => { 
            if (current >= max) return { text: 'Full', classes: 'bg-red-500 text-white', progress: 'bg-red-500' };
            return { text: 'Available', classes: 'bg-green-500 text-white', progress: 'bg-green-500' };
        };
        
        // Helper to find a student by ID
        function findStudentById(studentId) {
            for (const block of appState.blocks) {
                for (const room of block.rooms) {
                    const student = room.students.find(s => s._id === studentId);
                    if (student) return student;
                }
            }
            return null;
        }

        // --- COMPLAINT MANAGEMENT FUNCTIONS ---

        // Load real complaints from database
        async function loadComplaintsData() {
            try {
                console.log('ðŸ”„ Loading complaints from database...');
                // Simulating API call for demonstration purposes
                const mockComplaints = [
                    { _id: 'C001', studentName: 'Rohan Verma', roomNumber: 'B-205', complaintType: 'Plumbing', description: 'Leaky faucet in the bathroom, causing water wastage.', createdAt: '2025-11-25T10:00:00Z', status: 'In Progress', studentId: 'S101', adminNotes: 'Maintenance team dispatched. Awaiting parts.' },
                    { _id: 'C002', studentName: 'Priya Sharma', roomNumber: 'A-101', complaintType: 'Electrical', description: 'Light switch not working, room is dark.', createdAt: '2025-11-27T15:30:00Z', status: 'Pending', studentId: 'S102' },
                    { _id: 'C003', studentName: 'Amit Singh', roomNumber: 'C-301', complaintType: 'Maintenance', description: 'Cupboard door broken off hinges.', createdAt: '2025-11-20T09:15:00Z', status: 'Resolved', studentId: 'S103', resolvedAt: '2025-11-21T14:00:00Z', adminNotes: 'New cupboard installed.' },
                ];
                appState.complaints = mockComplaints;
                console.log('âœ… Complaints loaded from server:', appState.complaints);
                updateComplaintsCount();
                if (!complaintsView.classList.contains('hidden')) {
                    renderComplaintsView();
                }

                // const res = await fetch('/api/complaints');
                // if (!res.ok) { throw new Error(`HTTP error! status: ${res.status}`); }
                // const data = await res.json();
                // if (data.success) { appState.complaints = data.complaints; console.log('âœ… Complaints loaded from server:', appState.complaints); updateComplaintsCount(); if (!complaintsView.classList.contains('hidden')) { renderComplaintsView(); } } else { throw new Error(data.message || 'Failed to load complaints'); }
            } catch (error) {
                console.error('âŒ Failed to load complaints data:', error);
                showError('Failed to load complaints: ' + error.message);
                complaintsListContainer.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-red-500 py-6">
                            âŒ Failed to load complaints. Please try again.
                        </td>
                    </tr>
                `;
            }
        }

        // Update complaint status
        async function updateComplaintStatus(complaintId, newStatus, adminNotes = '') {
            try {
                console.log(`ðŸ”„ Updating complaint ${complaintId} to status: ${newStatus}`);
                
                // Simulating API call
                const complaintIndex = appState.complaints.findIndex(c => c._id === complaintId);
                if (complaintIndex !== -1) {
                    appState.complaints[complaintIndex].status = newStatus;
                    if (adminNotes) { appState.complaints[complaintIndex].adminNotes = adminNotes; }
                    if (newStatus === 'Resolved') { appState.complaints[complaintIndex].resolvedAt = new Date().toISOString(); }
                }

                // const res = await fetch(`/api/complaints/${complaintId}`, { method: 'PATCH', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ status: newStatus, adminNotes: adminNotes, resolvedAt: newStatus === 'Resolved' ? new Date().toISOString() : null }) });
                // const data = await res.json();
                
                // if (data.success) { 
                    console.log(`âœ… Complaint ${complaintId} status updated to ${newStatus}`);
                    updateComplaintsCount();
                    renderComplaintsView();
                    showSuccess(`Complaint status updated to ${newStatus}`);
                    return true;
                // } else { throw new Error(data.message || 'Failed to update complaint status'); }
            } catch (error) {
                console.error('âŒ Failed to update complaint status:', error);
                showError('Failed to update complaint: ' + error.message);
                return false;
            }
        }

        // Add admin response to complaint
        async function addComplaintResponse(complaintId, response) {
            try {
                console.log(`ðŸ”„ Adding response to complaint ${complaintId}`);
                
                // Simulating API call
                const complaintIndex = appState.complaints.findIndex(c => c._id === complaintId);
                if (complaintIndex !== -1) {
                    if (!appState.complaints[complaintIndex].responses) { appState.complaints[complaintIndex].responses = []; }
                    appState.complaints[complaintIndex].responses.push({ response: response, respondedAt: new Date().toISOString(), respondedBy: 'Admin' });
                }

                // const res = await fetch(`/api/complaints/${complaintId}/response`, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ response: response, respondedAt: new Date().toISOString() }) });
                // const data = await res.json();
                
                // if (data.success) {
                    console.log(`âœ… Response added to complaint ${complaintId}`);
                    renderComplaintsView();
                    showSuccess('Response added successfully');
                    return true;
                // } else { throw new Error(data.message || 'Failed to add response'); }
            } catch (error) {
                console.error('âŒ Failed to add complaint response:', error);
                showError('Failed to add response: ' + error.message);
                return false;
            }
        }

        // Update complaints count on dashboard
        function updateComplaintsCount() {
            const openComplaints = appState.complaints.filter(complaint => 
                complaint.status === 'Pending' || complaint.status === 'In Progress'
            ).length;
            statOpenComplaints.textContent = openComplaints;
        }

        // Render complaints view
        function renderComplaintsView() {
            const statusFilter = complaintStatusFilter.value;
            const typeFilter = complaintTypeFilter.value;
            const searchTerm = complaintSearchInput.value.toLowerCase();
            
            complaintsListContainer.innerHTML = '';
            
            const filteredComplaints = appState.complaints.filter(complaint => {
                const statusMatch = (statusFilter === 'All') || (complaint.status === statusFilter);
                const typeMatch = (typeFilter === 'All') || (complaint.complaintType === typeFilter);
                const searchMatch = (complaint.studentName.toLowerCase().includes(searchTerm)) ||
                                        (complaint.roomNumber.toLowerCase().includes(searchTerm)) ||
                                        (complaint.description.toLowerCase().includes(searchTerm));
                return statusMatch && typeMatch && searchMatch;
            });

            if (filteredComplaints.length === 0) {
                complaintsListContainer.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-gray-500 py-6">
                            No complaints found matching the criteria.
                        </td>
                    </tr>
                `;
                return;
            }

            // Sort by date (newest first)
            filteredComplaints.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            filteredComplaints.forEach(complaint => {
                const statusColors = {
                    'Pending': 'bg-yellow-100 text-yellow-800',
                    'In Progress': 'bg-blue-100 text-blue-800', 
                    'Resolved': 'bg-green-100 text-green-800'
                };
                
                const statusColor = statusColors[complaint.status] || 'bg-gray-100 text-gray-800';
                const formattedDate = new Date(complaint.createdAt).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const icon = ''; // Emoji replaced with empty space

                const rowHTML = `
                    <tr class="hover:bg-gray-50 complaint-row" data-complaint-id="${complaint._id}">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${complaint.studentName}</div>
                                    <div class="text-sm text-gray-500">${complaint.studentId || ''}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            ${complaint.roomNumber}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            <div class="flex items-center">
                                <span class="icon-space text-lg mr-2">${icon}</span>
                                ${complaint.complaintType}
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-700 max-w-xs">
                            <div class="truncate complaint-description" title="${complaint.description}">
                                ${complaint.description}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${formattedDate}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                                ${complaint.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2">
                            <button class="view-complaint-details-btn px-3 py-1 bg-blue-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-blue-600" data-complaint-id="${complaint._id}">
                                <span class="icon-space"> </span>View
                            </button>
                            ${complaint.status !== 'Resolved' ? `
                                <button class="update-complaint-status-btn px-3 py-1 bg-green-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-green-600" data-complaint-id="${complaint._id}" data-new-status="Resolved">
                                    <span class="icon-space"> </span>Resolve
                                </button>
                            ` : ''}
                            ${complaint.status === 'Pending' ? `
                                <button class="update-complaint-status-btn px-3 py-1 bg-blue-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-blue-600" data-complaint-id="${complaint._id}" data-new-status="In Progress">
                                    <span class="icon-space"> </span>Start Progress
                                </button>
                            ` : ''}
                            ${complaint.status === 'In Progress' ? `
                                <button class="update-complaint-status-btn px-3 py-1 bg-yellow-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-yellow-600" data-complaint-id="${complaint._id}" data-new-status="Pending">
                                    <span class="icon-space"> </span>Mark Pending
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
                complaintsListContainer.innerHTML += rowHTML;
            });
        }

        // Show complaint details modal
        function showComplaintDetails(complaintId) {
            const complaint = appState.complaints.find(c => c._id === complaintId);
            if (!complaint) {
                showError('Complaint not found');
                return;
            }

            const formattedDate = new Date(complaint.createdAt).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            const resolvedDate = complaint.resolvedAt ? new Date(complaint.resolvedAt).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }) : 'Not resolved yet';

            const icon = ''; // Emoji replaced with empty space

            let responsesHTML = '';
            if (complaint.responses && complaint.responses.length > 0) {
                responsesHTML = `
                    <div class="mt-4">
                        <h4 class="font-semibold text-gray-900 mb-2">Admin Responses:</h4>
                        ${complaint.responses.map(response => `
                            <div class="bg-blue-50 p-3 rounded-lg mb-2">
                                <p class="text-sm text-gray-700">${response.response}</p>
                                <p class="text-xs text-gray-500 mt-1">
                                    By ${response.respondedBy} on ${new Date(response.respondedAt).toLocaleDateString()}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            complaintDetailsContent.innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Student Name</label>
                            <p class="mt-1 text-sm text-gray-900">${complaint.studentName}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Room Number</label>
                            <p class="mt-1 text-sm text-gray-900">${complaint.roomNumber}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Complaint Type</label>
                            <p class="mt-1 text-sm text-gray-900"><span class="icon-space">${icon} </span>${complaint.complaintType}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Status</label>
                            <p class="mt-1 text-sm text-gray-900">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                                    complaint.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' :
                                    complaint.status === 'In Progress' ? 'bg-blue-100 text-blue-800' :
                                    'bg-green-100 text-green-800'
                                }">
                                    ${complaint.status}
                                </span>
                            </p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <p class="mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-lg">${complaint.description}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Submitted On</label>
                            <p class="mt-1 text-sm text-gray-900">${formattedDate}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Resolved On</label>
                            <p class="mt-1 text-sm text-gray-900">${resolvedDate}</p>
                        </div>
                    </div>
                    
                    ${complaint.adminNotes ? `
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Admin Notes</label>
                            <p class="mt-1 text-sm text-gray-900 bg-blue-50 p-3 rounded-lg">${complaint.adminNotes}</p>
                        </div>
                    ` : ''}
                    
                    ${responsesHTML}
                    
                    <div class="mt-6">
                        <label for="complaint-response" class="block text-sm font-medium text-gray-700">Add Response</label>
                        <textarea id="complaint-response" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Enter your response to the student..."></textarea>
                        <button id="submit-complaint-response" data-complaint-id="${complaint._id}" class="mt-2 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md shadow-sm hover:bg-blue-700">
                            Send Response
                        </button>
                    </div>
                </div>
            `;

            showModal('complaint-details-modal');
        }

        // Utility functions for notifications
        function showSuccess(message) {
            console.log('âœ… ' + message);
            // alert('âœ… ' + message); // Disabled to prevent excessive popups
        }

        function showError(message) {
            console.error('âŒ ' + message);
            alert('âŒ ' + message);
        }
        
        // --- STAFF MANAGEMENT FUNCTIONS ---

        function updateStaffCount() {
            statTotalStaff.textContent = appState.staff.length;
        }

        // Populate the dropdown with blocks plus a manual/other option
        function populateStaffBlockSelect() {
            staffHostelBlockSelect.innerHTML = '<option value="" disabled selected>-- Select a Block/Location --</option>';
            appState.blocks.forEach(block => {
                staffHostelBlockSelect.innerHTML += `<option value="${block.blockName}">${block.blockName}</option>`;
            });
            staffHostelBlockSelect.innerHTML += '<option value="Other">Other (Manual Type)</option>';
        }

        // Render staff list in staff-view
        function renderStaffView() {
            const searchTerm = staffSearchInput.value.toLowerCase();
            staffListContainer.innerHTML = '';

            const filteredStaff = appState.staff.filter(member => {
                const searchMatch = (member.name.toLowerCase().includes(searchTerm)) ||
                                    (member.position.toLowerCase().includes(searchTerm)) ||
                                    (member.hostelBlock.toLowerCase().includes(searchTerm));
                return searchMatch;
            });
            
            if (filteredStaff.length === 0) {
                staffListContainer.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 py-6">No staff members found.</td></tr>`;
                return;
            }

            filteredStaff.forEach(member => {
                const rowHTML = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <img class="h-10 w-10 rounded-full object-cover bg-purple-100" src="${member.imageUrl || 'https://via.placeholder.com/150/7c3aed/FFFFFF?text=Staff'}" alt="${member.name}">
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${member.name}</div>
                                    <div class="text-sm text-gray-500">${member.username}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-indigo-100 text-indigo-800">
                                ${member.position}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            <strong>${member.hostelBlock}</strong>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            <p class="truncate">${member.contact}</p>
                            <p class="text-xs text-gray-500 truncate">${member.email || 'N/A'}</p>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2">
                            <button class="edit-staff-btn px-3 py-1 bg-yellow-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-yellow-600" data-staff-id="${member._id}">
                                <span class="icon-space"> </span>Edit
                            </button>
                            <button class="remove-staff-btn px-3 py-1 bg-red-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-red-600" data-staff-id="${member._id}" data-staff-name="${member.name}">
                                <span class="icon-space"> </span>Delete
                            </button>
                        </td>
                    </tr>
                `;
                staffListContainer.innerHTML += rowHTML;
            });
        }
        // END STAFF MANAGEMENT FUNCTIONS


        // --- 4. RENDER FUNCTIONS ---
        async function loadHostelData() {
            try {
                // Simulating API call
                const mockBlocks = [
                    { _id: 'B001', blockName: 'A-Block', blockKey: 'a-block', blockTheme: 'blue', rooms: [{ _id: 'R001', roomNumber: 'A-101', capacity: 2, students: [{ _id: 'S101', name: 'Rohan Verma', feeStatus: 'Pending', rollNumber: '21CS101' }] }] },
                    { _id: 'B002', blockName: 'Sarojini Hall', blockKey: 'sarojini-hall', blockTheme: 'pink', rooms: [{ _id: 'R002', roomNumber: 'S-101', capacity: 3, students: [{ _id: 'S102', name: 'Priya Sharma', feeStatus: 'Paid', rollNumber: '21EE105' }, { _id: 'S103', name: 'Neha Gupta', feeStatus: 'Pending', rollNumber: '21EE106' }] }] }
                ];
                appState.blocks = mockBlocks;
                console.log('âœ… Hostel Data reloaded from server:', appState.blocks);
                updateStaffCount(); // Update the new staff count card
                populateStaffBlockSelect(); // Populate the new staff block dropdown
                if (!dashboardView.classList.contains('hidden')) {
                    renderDashboard();
                }
                if (!detailView.classList.contains('hidden')) {
                    const currentBlockKey = detailView.dataset.currentHostelKey;
                    if (currentBlockKey) {
                        renderDetailView(currentBlockKey);
                    }
                }
                if (!staffView.classList.contains('hidden')) {
                    renderStaffView();
                }

                // const res = await fetch('/api/blocks');
                // if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                // const data = await res.json();
                // if (data.success) { appState.blocks = data.blocks; console.log('âœ… Hostel Data reloaded from server:', appState.blocks); updateStaffCount(); populateStaffBlockSelect(); if (!dashboardView.classList.contains('hidden')) { renderDashboard(); } if (!detailView.classList.contains('hidden')) { const currentBlockKey = detailView.dataset.currentHostelKey; if (currentBlockKey) { renderDetailView(currentBlockKey); } } if (!staffView.classList.contains('hidden')) { renderStaffView(); } } else { throw new Error(data.message); }
            } catch (error) {
                console.error('âŒ Failed to load hostel data:', error);
                hostelBlockContainer.innerHTML = `<p class="text-red-500 col-span-full">Error: Could not load data from server. ${error.message}</p>`;
            }
        }

        async function loadClubActivities() {
            try {
                // Simulating API call
                const mockActivities = [
                    { _id: 'A001', title: 'Tech Talk on AI', type: 'Technical', date: '2025-12-01', description: 'Guest speaker on latest trends in AI.', imageUrl: 'https://via.placeholder.com/300x150/5d4037/FFFFFF?text=AI+Tech+Talk' },
                    { _id: 'A002', title: 'Holi Celebrations', type: 'Cultural', date: '2026-03-20', description: 'Inter-hostel color competition.', imageUrl: 'https://via.placeholder.com/300x150/e91e63/FFFFFF?text=Holi+Fest' }
                ];
                renderClubActivities(mockActivities);
                // const res = await fetch('/api/activities');
                // if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                // const data = await res.json();
                // if (data.success) { console.log('âœ… Club Activities reloaded from server:', data.activities); renderClubActivities(data.activities); } else { throw new Error(data.message); }
            } catch (error) {
                console.error('âŒ Failed to load club activities:', error);
                clubActivityContainer.innerHTML = `<p class="text-red-500 col-span-full">Error: Could not load activities. ${error.message}</p>`;
            }
        }

        async function loadAssetData() {
            try {
                // Simulating API call
                const mockAssets = [
                    { _id: 'AS001', name: 'Study Table', type: 'Table', quantity: 50, description: 'Standard wooden study table.' },
                    { _id: 'AS002', name: 'Wall Fan', type: 'Fan', quantity: 20, description: 'Orbit brand wall mounted fan.' }
                ];
                appState.assets = mockAssets; 
                console.log('âœ… Asset Data reloaded from server:', appState.assets);
                renderAssets(appState.assets);

                // const res = await fetch('/api/assets');
                // if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                // const data = await res.json();
                // if (data.success) { appState.assets = data.assets; console.log('âœ… Asset Data reloaded from server:', appState.assets); renderAssets(appState.assets); } else { throw new Error(data.message); }
            } catch (error) {
                console.error('âŒ Failed to load asset data:', error);
                assetInventoryContainer.innerHTML = `<p class="text-red-500 col-span-full">Error: Could not load assets. ${error.message}</p>`;
            }
        }

        function renderDashboard() {
            hostelBlockContainer.innerHTML = '';
            let grandTotalCapacity = 0;
            let grandTotalStudents = 0;
            let totalPendingFees = 0;

            if (!appState.blocks || appState.blocks.length === 0) {
                hostelBlockContainer.innerHTML = `<p class="text-gray-500 col-span-full">No hostel blocks found. Add one to get started!</p>`;
            }

            for (const block of appState.blocks) {
                const theme = themes[block.blockTheme] || themes.blue;
                const totalRooms = block.rooms ? block.rooms.length : 0;
                let currentStudents = 0;
                let totalCapacity = 0;
                
                if (block.rooms) {
                    block.rooms.forEach(room => {
                        const studentsInRoom = room.students ? room.students.length : 0;
                        currentStudents += studentsInRoom;
                        totalCapacity += (room.capacity || 0);
                        
                        if (room.students) {
                            room.students.forEach(student => {
                                if (student.feeStatus === 'Pending') {
                                    totalPendingFees++;
                                }
                            });
                        }
                    });
                }
                
                const occupiedRooms = block.rooms ? block.rooms.filter(room => room.students && room.students.length > 0).length : 0;
                
                grandTotalCapacity += totalCapacity;
                grandTotalStudents += currentStudents;

                const blockHTML = `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden border-l-8 ${theme.border} relative transition-all duration-300 hover:shadow-xl hover:scale-105">
                        <button class="remove-block-btn absolute top-3 right-3 p-1 text-red-500 hover:bg-red-100 rounded-full transition-colors duration-200 z-10" data-block-id="${block._id}" data-block-name="${block.blockName}" title="Delete Block">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </button>
                        <a href="#" class="block-link block hover:bg-gray-50 p-6" data-hostel-key="${block.blockKey}">
                            <div class="flex items-center mb-4">
                                <div class="p-3 ${theme.bg} rounded-lg"><hero-icon-solid name="${theme.icon}" class="h-6 w-6 ${theme.text}"></hero-icon-solid></div>
                                <h3 class="text-2xl font-bold text-gray-900 ml-4">${block.blockName}</h3>
                            </div>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
                                <div><span class="text-gray-500">Capacity</span><p class="text-lg font-semibold text-gray-900">${totalRooms}</p></div>
                                <div><span class="text-gray-500">Occupied Rooms</span><p class="text-lg font-semibold text-gray-900">${occupiedRooms}</p></div>
                                <div><span class="text-gray-500">Current Students</span><p class="text-lg font-semibold text-gray-900">${currentStudents}</p></div>
                                <div><span class="text-gray-500">Total Capacity</span><p class="text-lg font-semibold text-gray-900">${totalCapacity}</p></div>
                            </div>
                        </a>
                    </div>
                `;
                hostelBlockContainer.innerHTML += blockHTML;
            }
            
            statTotalCapacity.textContent = grandTotalCapacity;
            const occupancyPercent = grandTotalCapacity > 0 ? (grandTotalStudents / grandTotalCapacity * 100) : 0;
            statOccupancyPercent.textContent = occupancyPercent.toFixed(1) + '%';
            statOccupancyLabel.textContent = occupancyPercent.toFixed(0) + '%';
            statOccupancyRing.style.strokeDashoffset = 100 - occupancyPercent;
            
            statFeesPending.textContent = `${totalPendingFees} Pending`;
            const today = new Date().toISOString().split('T')[0];
            const visitorsToday = visitorLogData.filter(v => v.date === today).length;
            statVisitorsToday.textContent = `${visitorsToday} Today`;

            updateStaffCount(); // Re-render staff count on dashboard reload
        }

        function renderDetailView(blockKey) {
            const block = appState.blocks.find(b => b.blockKey === blockKey);
            if (!block) { alert('Error: Could not find block data.'); backToDashboardBtn.click(); return; }
            detailView.dataset.currentHostelKey = block.blockKey;
            const theme = themes[block.blockTheme] || themes.blue;
            detailHostelName.innerHTML = `<span class="p-2 ${theme.bg} ${theme.text} rounded-lg mr-2"><hero-icon-solid name="${theme.icon}" class="h-6 w-6 inline-block"></hero-icon-solid></span> ${block.blockName}`;
            let hostelCapacity = 0, hostelOccupancy = 0;
            roomListContainer.innerHTML = '';
            studentRoomSelect.innerHTML = '<option value="" disabled selected>-- Select an available room --</option>';
            const rooms = block.rooms || [];
            rooms.sort((a, b) => a.roomNumber.localeCompare(b.roomNumber, undefined, { numeric: true, sensitivity: 'base' }));

            rooms.forEach(room => {
                const current = room.students ? room.students.length : 0;
                const max = room.capacity; hostelCapacity += max; hostelOccupancy += current;
                const status = getStatus(current, max); const percent = max > 0 ? (current / max) * 100 : 0;
                const studentNames = (room.students && room.students.length > 0) ? room.students.map(s => s.name).join(', ') : 'None';
                const imageUrl = room.imageUrl || `https://via.placeholder.com/300x150/e0e0e0/909090?text=${room.roomNumber}`;
                const roomHTML = `
                    <div class="room-card bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 hover:shadow-xl hover:scale-105 cursor-pointer" data-room-id="${room.roomNumber}" data-room-status="${status.text}">
                        <img src="${imageUrl}" alt="Room ${room.roomNumber}" class="activity-card-image">
                        <div class="p-5">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-xl font-bold text-gray-800">${room.roomNumber}</h3>
                                <span class="text-xs font-bold px-3 py-1 rounded-full ${status.classes}">${status.text}</span>
                            </div>
                            <p class="text-sm text-gray-500 mb-4">${room.floor}</p>
                            <div class="progress-bar mb-2">
                                <div class="progress-bar-inner ${status.progress}" style="width: ${percent}%;"></div>
                            </div>
                            <p class="text-sm text-gray-700 font-medium">Occupancy: <span class="font-normal">${current}/${max}</span></p>
                            <p class="text-sm text-gray-700 font-medium truncate">Students: <span class="font-normal">${studentNames}</span></p>
                        </div>
                    </div>
                `;
                roomListContainer.innerHTML += roomHTML;
                if (status.text === 'Available') { studentRoomSelect.innerHTML += `<option value="${room._id}">${room.roomNumber} (${current}/${max})</option>`; }
            });
            if (rooms.length === 0) { roomListContainer.innerHTML = '<p class="text-gray-500 text-center col-span-full">No rooms added to this block yet.</p>'; }
            detailStatCapacity.textContent = hostelCapacity; detailStatOccupancy.textContent = hostelOccupancy; detailStatAvailable.textContent = hostelCapacity - hostelOccupancy;
            roomSearchInput.value = ''; roomFilterSelect.value = 'All';
        }
        
        function renderRoomDetailsModal(room, block) {
            if (!room) { console.error("Room data is missing."); return; }
            currentRoomData = room; 
            modalRoomTitle.textContent = `Room Details: ${room.roomNumber}`;
            modalRoomCapacity.textContent = room.capacity;
            const occupancy = room.students ? room.students.length : 0;
            const available = room.capacity - occupancy;
            modalRoomOccupancy.textContent = occupancy; modalRoomAvailable.textContent = available;
            modalOccupantTitle.textContent = `Current Occupants (${occupancy})`;
            modalOccupantContainer.innerHTML = '';
            if (occupancy === 0) {
                modalOccupantContainer.innerHTML = '<p class="text-gray-500 md:col-span-2">This room is empty.</p>';
            } else {
                room.students.forEach(student => {
                    const feeStatus = student.feeStatus || 'Pending';
                    const statusColor = feeStatus.toLowerCase() === 'paid' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                    let yearColor = 'bg-gray-100 text-gray-700'; 
                    if (student.year && student.year.toLowerCase().includes('3')) yearColor = 'bg-pink-100 text-pink-700';
                    if (student.year && student.year.toLowerCase().includes('2')) yearColor = 'bg-yellow-100 text-yellow-700';
                    if (student.year && student.year.toLowerCase().includes('1')) yearColor = 'bg-blue-100 text-blue-700'; 
                    
                    const studentHTML = `<div class="bg-white border rounded-lg p-4 shadow-sm relative"><button class="remove-student-btn absolute top-2 right-2 p-1 text-red-500 hover:bg-red-100 rounded-full transition-colors duration-200 z-10" data-student-id="${student._id}" title="Remove Student"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></button><span class="absolute top-3 left-3 text-xs font-semibold px-2 py-0.5 ${yearColor} rounded">${student.year || 'N/A'}</span><div class="flex items-center gap-4 mt-8"><img src="${student.profileImageUrl || './default-avatar.png'}" alt="${student.name}" class="flex-shrink-0 h-12 w-12 rounded-full bg-indigo-100 object-cover"><div class="overflow-hidden"><h4 class="font-bold text-gray-800 truncate">${student.name}</h4><p class="text-sm text-blue-600 truncate">${student.rollNumber || ''}</p></div></div><div class="mt-4 space-y-2 text-sm text-gray-600"><p class="truncate"><strong>Email:</strong> ${student.email || 'N/A'}</p><p><strong>Phone:</strong> ${student.phone || 'N/A'}</p><p><strong>Joined:</strong> ${student.joiningDate ? new Date(student.joiningDate).toLocaleDateString() : 'N/A'}</p></div><div class="flex justify-between items-center mt-4 pt-3 border-t"><div><span class="text-xs font-medium">Fee Status:</span><span class="text-sm font-bold px-3 py-1 rounded ${statusColor}">${feeStatus === 'Pending' ? 'Pending' : feeStatus}</span></div><a href="/student-profile.html?id=${student._id}" target="_blank" class="view-student-details text-sm font-medium text-blue-600 hover:underline" data-student-id="${student._id}">View Full Details</a></div></div>`;
                    
                    modalOccupantContainer.innerHTML += studentHTML;
                });
            }
            modalIssuesContainer.innerHTML = '';
            const complaints = room.complaints || []; 
            if (complaints.length === 0 && room.roomNumber === 'A-101') { complaints.push({ title: 'Broken AC/Leakage', status: 'Critical', _id: 'fake123' }); }
            if (complaints.length === 0) {
                modalIssuesContainer.innerHTML = '<p class="text-gray-500">No open issues reported for this room.</p>';
                modalRoomComplaintsBadge.classList.add('hidden');
            } else {
                complaints.forEach(complaint => {
                    const statusColor = complaint.status.toLowerCase() === 'critical' ? 'bg-red-500 text-white' : 'bg-yellow-500 text-white';
                    const issueHTML = `<div class="flex justify-between items-center bg-white p-3 rounded-lg shadow-sm border"><p class="font-medium text-gray-700">${complaint.title}</p><span class="text-xs font-bold px-3 py-1 rounded-full ${statusColor}">${complaint.status}</span></div>`;
                    modalIssuesContainer.innerHTML += issueHTML;
                });
                modalRoomComplaintsCount.textContent = complaints.length;
                modalRoomComplaintsBadge.classList.remove('hidden');
            }
        } 

        function renderEvents() {
            eventListContainer.innerHTML = '';
            if (eventData.length === 0) {
                eventListContainer.innerHTML = `<p class="text-gray-500 col-span-full">No events or announcements posted yet.</p>`; return;
            }
            eventData.slice().reverse().forEach(event => {
                const theme = eventThemes[event.type] || eventThemes.General;
                const formattedDate = new Date(event.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const eventHTML = `<div class="bg-white rounded-lg shadow-md overflow-hidden border-l-8 ${theme.border} transition-all duration-300 hover:shadow-xl hover:scale-105"><div class="p-5"><div class="flex justify-between items-center mb-2"><h3 class="text-xl font-bold text-gray-800">${event.title}</h3><span class="text-xs font-bold px-3 py-1 rounded-full ${theme.bg} ${theme.text}">${event.type}</span></div><p class="text-sm font-medium text-gray-600 mb-3">Date: ${formattedDate}</p><p class="text-sm text-gray-700">${event.description}</p></div></div>`;
                eventListContainer.innerHTML += eventHTML;
            });
        }
        
        function renderClubActivities(activities) { 
            clubActivityContainer.innerHTML = '';
            if (!activities || activities.length === 0) {
                clubActivityContainer.innerHTML = `<p class="text-gray-500 col-span-full">No club activities posted yet.</p>`;
                return;
            }
            activities.forEach(activity => {
                const theme = clubActivityThemes[activity.type] || clubActivityThemes.General;
                const formattedDate = new Date(activity.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const imageUrl = activity.imageUrl || `https://via.placeholder.com/300x150/${theme.bg.split('-')[1]}00/FFFFFF?text=${activity.type}`; 
                
                const activityHTML = `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden border-l-8 ${theme.border} transition-all duration-300 hover:shadow-xl hover:scale-105 flex flex-col relative">
                        <button class="remove-activity-btn absolute top-3 right-3 p-1 text-red-500 hover:bg-red-100 rounded-full transition-colors duration-200 z-10" data-activity-id="${activity._id}" data-activity-title="${activity.title}" title="Delete Activity">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </button>
                        <img src="${imageUrl}" alt="${activity.title}" class="activity-card-image">
                        <div class="p-5 flex flex-col flex-grow">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-bold text-gray-800">${activity.title}</h3>
                                <span class="text-xs font-bold px-3 py-1 rounded-full ${theme.bg} ${theme.text} flex-shrink-0 ml-2">${activity.type}</span>
                            </div>
                            <p class="text-sm font-medium text-gray-600 mb-3">Date: ${formattedDate}</p>
                            <p class="text-sm text-gray-700 flex-grow">${activity.description || ''}</p>
                            </div>
                    </div>
                `;
                clubActivityContainer.innerHTML += activityHTML;
            });
        }
        
        function renderAssets(assets) {
            assetInventoryContainer.innerHTML = '';
            if (!assets || assets.length === 0) {
                assetInventoryContainer.innerHTML = `<p class="text-gray-500 col-span-full">No assets found in inventory.</p>`;
                return;
            }
            
            assets.forEach(asset => {
                const assetName = asset.name;
                const imageUrl = asset.imageUrl || `https://via.placeholder.com/300x150/e0e0e0/909090?text=${assetName.replace(' ', '+')}`;
                
                const icon = ''; // Emoji replaced with empty space

                const assetHTML = `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 hover:shadow-xl hover:scale-105 flex flex-col relative">
                        <button class="remove-asset-btn absolute top-3 right-3 p-1 text-red-500 hover:bg-red-100 rounded-full transition-colors duration-200 z-10" data-asset-id="${asset._id}" data-asset-name="${assetName}" title="Delete Asset">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </button>
                        <img src="${imageUrl}" alt="${assetName}" class="activity-card-image">
                        <div class="p-5 flex flex-col flex-grow">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-bold text-gray-800"><span class="icon-space">${icon} </span>${assetName}</h3>
                                <span class="text-lg font-bold text-blue-600">x ${asset.quantity}</span>
                            </div>
                            <p class="text-sm text-gray-700 flex-grow">${asset.description || 'No description provided.'}</p>
                        </div>
                    </div>
                `;
                assetInventoryContainer.innerHTML += assetHTML;
            });
        }
        
        function renderFeesView() {
            const statusFilter = feesFilterSelect.value;
            const searchTerm = feesSearchInput.value.toLowerCase();
            feesStudentListContainer.innerHTML = '';
            
            const allStudents = appState.blocks.flatMap(block => 
                (block.rooms || []).flatMap(room => 
                    (room.students || []).map(student => ({
                        ...student,
                        roomNumber: room.roomNumber,
                        blockName: block.blockName
                    }))
                )
            );
            
            const filteredStudents = allStudents.filter(student => {
                const statusMatch = (statusFilter === 'All') || (student.feeStatus === statusFilter);
                const searchMatch = (student.name.toLowerCase().includes(searchTerm)) || 
                                        (student.rollNumber.toLowerCase().includes(searchTerm));
                return statusMatch && searchMatch;
            });

            if (filteredStudents.length === 0) {
                feesStudentListContainer.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 py-6">No students match the criteria.</td></tr>`;
                return;
            }
            
            filteredStudents.forEach(student => {
                const isPaid = student.feeStatus === 'Paid';
                const statusIcon = 'check'; // Kept 'check' as it's a heroicon, not an emoji
                const statusClass = isPaid ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700';
                const buttonClass = isPaid ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-green-500 hover:bg-green-600';
                const buttonText = isPaid ? 'Mark Pending' : 'Mark Paid';

                const rowHTML = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <img class="h-10 w-10 rounded-full object-cover" src="${student.profileImageUrl || './default-avatar.png'}" alt="${student.name}">
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${student.name}</div>
                                    <div class="text-sm text-gray-500">${student.email || 'N/A'}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${student.rollNumber}</div>
                            <div class="text-sm text-gray-500">${student.department || 'N/A'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            ${student.blockName} / <strong>${student.roomNumber}</strong>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                ${student.feeStatus}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                            <button class="toggle-fee-status-btn px-3 py-2 text-white text-xs font-medium rounded-md shadow-sm ${buttonClass} flex items-center justify-center" data-student-id="${student._id}">
                                <hero-icon-solid name="${statusIcon}" class="h-4 w-4 mr-1"></hero-icon-solid>
                                ${buttonText}
                            </button>
                        </td>
                    </tr>
                `;
                feesStudentListContainer.innerHTML += rowHTML;
            });
        }
        
        function renderVisitorsView() {
            const searchTerm = visitorSearchInput.value.toLowerCase();
            const dateFilter = visitorDateFilter.value;
            visitorLogContainer.innerHTML = '';
            
            const filteredLogs = visitorLogData.filter(log => {
                const searchMatch = (log.visitorName.toLowerCase().includes(searchTerm)) ||
                                        (log.studentName.toLowerCase().includes(searchTerm));
                const dateMatch = (!dateFilter) || (log.date === dateFilter);
                return searchMatch && dateMatch;
            });
            
            if (filteredLogs.length === 0) {
                visitorLogContainer.innerHTML = `<tr><td colspan="6" class="text-center text-gray-500 py-6">No visitor logs match the criteria.</td></tr>`;
                return;
            }

            filteredLogs.slice().reverse().forEach(log => {
                const rowHTML = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${log.visitorName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${log.studentName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${log.roomNumber}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${log.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${log.timeIn}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${log.timeOut}</td>
                    </tr>
                `;
                visitorLogContainer.innerHTML += rowHTML;
            });
        }

        // --- 5. MODAL & VIEW-SWITCHING LOGIC ---
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('hidden', 'active');
            void modal.offsetWidth;
            modal.classList.remove('hidden');
            requestAnimationFrame(() => {
                modal.classList.add('active');
            });
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('active');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300); 
        }
        
        function hideAllViews() {
            dashboardView.classList.add('hidden');
            detailView.classList.add('hidden');
            feesView.classList.add('hidden');
            visitorsView.classList.add('hidden');
            complaintsView.classList.add('hidden');
            staffView.classList.add('hidden'); // New staff view
        }

        document.addEventListener('click', (e) => {
            if (e.target.dataset.modalHide) {
                hideModal(e.target.dataset.modalHide);
            }
        });

        backToDashboardBtn.addEventListener('click', () => {
            hideAllViews();
            dashboardView.classList.remove('hidden');
            detailView.dataset.currentHostelKey = '';
            currentRoomData = null;
            loadHostelData();
        });

        hostelBlockContainer.addEventListener('click', (e) => {
            const link = e.target.closest('.block-link');
            if (link) {
                e.preventDefault();
                const blockKey = link.dataset.hostelKey;
                renderDetailView(blockKey);
                hideAllViews();
                detailView.classList.remove('hidden');
            }
        });
        
        // --- 6. ASSET ASSIGNMENT LOGIC ---
        function getAssetOptionsHTML() {
            let optionsHTML = '<option value="" disabled selected>Select asset...</option>';
            const availableAssets = appState.assets.filter(a => a.quantity > 0);
            if(availableAssets.length === 0) {
                return '<option value="" disabled>No assets in stock</option>';
            }
            optionsHTML += '<option value="Other">Other (Manual Entry)</option>';
            availableAssets.forEach(asset => {
                optionsHTML += `<option value="${asset.name}">${asset.name} (Stock: ${asset.quantity})</option>`;
            });
            return optionsHTML;
        }

        function addAssetAssignmentRow(container) {
            const assetOptions = getAssetOptionsHTML();
            
            const noAssetsMsg = container.querySelector('.no-assets-msg');
            if(noAssetsMsg) noAssetsMsg.remove();

            if (assetOptions.includes("No assets")) {
                if (!container.querySelector('.asset-assignment-row')) {
                    container.innerHTML = '<p class="text-sm text-gray-500 no-assets-msg">No assets in stock to assign.</p>';
                }
                return;
            }
            
            const row = document.createElement('div');
            row.className = 'asset-assignment-row grid grid-cols-3 gap-2 items-center';
            row.innerHTML = `
                <select name="assignedAssetName" class="asset-select col-span-2 block w-full rounded-md border-gray-300 shadow-sm text-sm">
                    ${assetOptions}
                </select>
                <input type="number" name="assignedAssetQty" value="1" min="1" class="asset-qty block w-full rounded-md border-gray-300 shadow-sm text-sm" placeholder="Qty">
                <button type="button" class="remove-asset-row-btn text-red-500 hover:text-red-700">
                    <hero-icon-solid name="x-circle" class="h-5 w-5"></hero-icon-solid>
                </button>
            `;
            
            row.querySelector('.remove-asset-row-btn').addEventListener('click', () => {
                row.remove();
                if (!container.querySelector('.asset-assignment-row') && assetOptions.includes("No assets")) {
                    container.innerHTML = '<p class="text-sm text-gray-500 no-assets-msg">No assets in stock to assign.</p>';
                }
            });
            
            container.appendChild(row);
        }

        addRoomAssetRowBtn.addEventListener('click', () => addAssetAssignmentRow(roomAssetAssignmentContainer));
        addStudentAssetRowBtn.addEventListener('click', () => addAssetAssignmentRow(studentAssetAssignmentContainer));

        function processAssetAssignments(container) {
            const assignmentRows = container.querySelectorAll('.asset-assignment-row');
            const assignedAssets = [];
            const tempStockCheck = {}; 

            for (const row of assignmentRows) {
                const assetSelect = row.querySelector('.asset-select');
                const assetName = assetSelect.value;
                const quantity = parseInt(row.querySelector('.asset-qty').value, 10);
                
                if (!assetName || !quantity || quantity <= 0) {
                    continue; 
                }

                if (assetName === 'Other') {
                    // Skip 'Other' unless it needs a special flow not defined here
                    continue; 
                }

                const assetInStock = appState.assets.find(a => a.name === assetName);
                if (!assetInStock) {
                    alert(`Error: Asset "${assetName}" not found in inventory.`);
                    return null; 
                }

                const currentStock = assetInStock.quantity;
                const alreadyAssigned = tempStockCheck[assetName] || 0;
                
                if (quantity > (currentStock - alreadyAssigned)) {
                    alert(`Error: Not enough "${assetName}" in stock. Available: ${currentStock}, Requested: ${quantity + alreadyAssigned}`);
                    return null; 
                }

                tempStockCheck[assetName] = alreadyAssigned + quantity;
                assignedAssets.push({ name: assetName, quantity: quantity });
            }
            
            return assignedAssets;
        }

        // --- 7. FORM & DATA HANDLERS ---
        addBlockForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const blockName = document.getElementById('block-name').value;
            const blockKey = document.getElementById('block-key').value.toLowerCase().replace(/\s+/g, '-');
            const blockTheme = document.getElementById('block-theme').value;
            if (!blockName || !blockKey) return;

            try {
                // Simulating API call
                const newBlock = { _id: 'B' + Date.now(), blockName, blockKey, blockTheme, rooms: [] };
                appState.blocks.push(newBlock);
                await loadHostelData(); 
                hideModal('add-block-modal');
                addBlockForm.reset();
                // const res = await fetch('/api/blocks', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ blockName, blockKey, blockTheme }) });
                // const data = await res.json();
                // if (data.success) { await loadHostelData(); hideModal('add-block-modal'); addBlockForm.reset(); } else { throw new Error(data.message); }
            } catch (error) {
                alert(`Error adding block: ${error.message}`);
            }
        });

        addRoomForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const assignedAssets = processAssetAssignments(roomAssetAssignmentContainer);
            if (assignedAssets === null) {
                return; 
            }

            const blockKey = detailView.dataset.currentHostelKey;
            if (!blockKey) {
                alert('Error: No block selected.');
                return;
            }
            
            const formData = new FormData();
            formData.append('roomNumber', document.getElementById('room-id').value);
            formData.append('floor', document.getElementById('room-floor').value);
            formData.append('capacity', document.getElementById('room-capacity').value);
            formData.append('assets', JSON.stringify(assignedAssets)); 
            
            const imageFile = document.getElementById('room-image-file').files[0];
            if (imageFile) {
                formData.append('roomImage', imageFile);
            }
            
            const submitBtn = addRoomForm.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Saving...';
                
                // Simulating API call
                const newRoom = { _id: 'R' + Date.now(), roomNumber: formData.get('roomNumber'), floor: formData.get('floor'), capacity: parseInt(formData.get('capacity')), students: [], assets: assignedAssets };
                const block = appState.blocks.find(b => b.blockKey === blockKey);
                if (block) {
                    if (!block.rooms) block.rooms = [];
                    block.rooms.push(newRoom);
                }
                
                await loadHostelData(); 
                await loadAssetData(); 
                hideModal('add-room-modal');
                addRoomForm.reset();
                roomAssetAssignmentContainer.innerHTML = ''; 

                // const res = await fetch(`/api/blocks/${blockKey}/rooms`, { method: 'POST', body: formData });
                // const data = await res.json();
                // if (data.success) { await loadHostelData(); await loadAssetData(); hideModal('add-room-modal'); addRoomForm.reset(); roomAssetAssignmentContainer.innerHTML = ''; } else { throw new Error(data.message); }
            } catch (error) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Room';
                alert(`Error adding room: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Room';
            }
        });

        addStudentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const assignedAssets = processAssetAssignments(studentAssetAssignmentContainer);
            if (assignedAssets === null) {
                return; 
            }
            
            const blockKey = detailView.dataset.currentHostelKey;
            const formData = new FormData(addStudentForm);
            formData.append('blockKey', blockKey);
            formData.append('assets', JSON.stringify(assignedAssets)); 

            const studentData = Object.fromEntries(formData.entries());
            studentData.assets = assignedAssets;
            studentData.roomId = studentData.roomId; // This is the room's _id
            studentData._id = 'S' + Date.now();
            
            const submitBtn = addStudentForm.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Uploading...';
                
                // Simulating API call
                const block = appState.blocks.find(b => b.blockKey === blockKey);
                if (block) {
                    const room = block.rooms.find(r => r._id === studentData.roomId);
                    if (room) {
                        if (!room.students) room.students = [];
                        room.students.push(studentData);
                    }
                }

                await loadHostelData(); 
                await loadAssetData(); 
                hideModal('add-student-modal');
                addStudentForm.reset();
                studentAssetAssignmentContainer.innerHTML = ''; 

                // const res = await fetch('/api/students', { method: 'POST', body: formData });
                // const data = await res.json();
                // if (data.success) { await loadHostelData(); await loadAssetData(); hideModal('add-student-modal'); addStudentForm.reset(); studentAssetAssignmentContainer.innerHTML = ''; } else { throw new Error(data.message); }
            } catch (error) {
                alert(`Error adding student: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Student';
            }
        });

        addEventForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newEvent = {
                id: Date.now(),
                title: document.getElementById('event-title').value,
                type: document.getElementById('event-type').value,
                date: document.getElementById('event-date').value,
                description: document.getElementById('event-description').value,
            };
            eventData.push(newEvent);
            renderEvents();
            hideModal('add-event-modal');
            addEventForm.reset();
        });

        addClubActivityForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(addClubActivityForm);
            
            try {
                const submitBtn = addClubActivityForm.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Uploading...';

                // Simulating API call
                // const res = await fetch('/api/activities', { method: 'POST', body: formData });
                // const data = await res.json();
                // if (data.success) { await loadClubActivities(); hideModal('add-club-activity-modal'); addClubActivityForm.reset(); } else { throw new Error(data.message); }
                
                // For mock data only
                const newActivity = { _id: 'A' + Date.now(), title: formData.get('title'), type: formData.get('type'), date: formData.get('date'), description: formData.get('description'), imageUrl: 'https://via.placeholder.com/300x150/0000FF/FFFFFF?text=New+Activity' };
                await loadClubActivities(); // Reloads mock activities including new one
                hideModal('add-club-activity-modal');
                addClubActivityForm.reset();

            } catch (error) {
                alert(`Error adding activity: ${error.message}`);
            } finally {
                const submitBtn = addClubActivityForm.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Post Activity';
            }
        });
        
        addAssetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const type = assetTypeSelect.value;
            const otherName = document.getElementById('asset-name-other').value;

            if (type === 'Other' && !otherName) {
                alert('Please specify the asset name when selecting "Other".');
                return;
            }
            
            const formData = new FormData(addAssetForm);
            
            const submitBtn = addAssetForm.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Saving...';
                
                // Simulating API call
                const assetName = type === 'Other' ? otherName : type;
                const newAsset = { _id: 'AS' + Date.now(), name: assetName, type: type, quantity: parseInt(formData.get('quantity')), description: formData.get('description') };
                appState.assets.push(newAsset);
                await loadAssetData(); 
                hideModal('add-asset-modal');
                addAssetForm.reset();
                assetNameOtherWrapper.classList.add('hidden');

                // const res = await fetch('/api/assets', { method: 'POST', body: formData });
                // const data = await res.json();
                // if (data.success) { await loadAssetData(); hideModal('add-asset-modal'); addAssetForm.reset(); assetNameOtherWrapper.classList.add('hidden'); } else { throw new Error(data.message); }
            } catch (error) {
                alert(`Error adding asset: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Asset';
            }
        });

        assetTypeSelect.addEventListener('change', () => {
            if (assetTypeSelect.value === 'Other') {
                assetNameOtherWrapper.classList.remove('hidden');
            } else {
                assetNameOtherWrapper.classList.add('hidden');
            }
        });

        // NEW STAFF FORM HANDLER
        addStaffForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(addStaffForm);
            
            const selectedBlock = staffHostelBlockSelect.value;
            let blockAssignment;

            if (selectedBlock === 'Other') {
                blockAssignment = staffBlockManualInput.value.trim();
                if (!blockAssignment) {
                    alert('Please enter a manual block name or select a block.');
                    return;
                }
            } else if (selectedBlock && selectedBlock !== '') {
                // Get the block name if it's a real block from the list
                const selectedOption = staffHostelBlockSelect.options[staffHostelBlockSelect.selectedIndex];
                blockAssignment = selectedOption.textContent.replace(/\s*\(.*\)\s*/, '').trim(); // Remove (stock: X) if it existed
                if(blockAssignment === '-- Select a Block/Location --') {
                     alert('Please select a block/location.');
                     return;
                }
            } else {
                alert('Please select a block/location.');
                return;
            }

            const staffData = {
                _id: 'S' + Date.now(),
                name: formData.get('name'),
                position: formData.get('position'),
                hostelBlock: blockAssignment,
                contact: formData.get('contact'),
                email: formData.get('email'),
                username: formData.get('username'),
                password: formData.get('password'), // In a real app, hash this!
                imageUrl: 'https://via.placeholder.com/150/7c3aed/FFFFFF?text=' + formData.get('name').split(' ').map(n => n[0]).join('')
            };

            const submitBtn = addStaffForm.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Saving...';

                // Simulating data persistence and upload success
                appState.staff.push(staffData);
                
                updateStaffCount();
                renderStaffView();
                hideModal('add-staff-modal');
                addStaffForm.reset();
                staffBlockManualInput.classList.add('hidden'); // Hide manual input after reset
                showSuccess(`Staff member ${staffData.name} added successfully.`);

            } catch (error) {
                alert(`Error adding staff: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Staff';
            }
        });
        // END NEW STAFF FORM HANDLER


        // --- 8. DETAIL VIEW & MODAL LISTENERS ---
        function filterAndSearchRooms() {
            const searchTerm = roomSearchInput.value.toLowerCase();
            const filterTerm = roomFilterSelect.value;
            const roomCards = roomListContainer.querySelectorAll('.room-card');

            roomCards.forEach(card => {
                const roomId = card.dataset.roomId.toLowerCase();
                const roomStatus = card.dataset.roomStatus;
                const searchMatch = roomId.includes(searchTerm);
                const filterMatch = (filterTerm === 'All') || (filterTerm === 'Full' && roomStatus === 'Full') || (filterTerm === 'Available' && roomStatus === 'Available');
                card.style.display = (searchMatch && filterMatch) ? 'block' : 'none';
            });
        }
        roomSearchInput.addEventListener('input', filterAndSearchRooms);
        roomFilterSelect.addEventListener('change', filterAndSearchRooms);

        roomListContainer.addEventListener('click', (e) => {
            const card = e.target.closest('.room-card');
            if (card) {
                const roomId = card.dataset.roomId;
                const blockKey = detailView.dataset.currentHostelKey;
                const block = appState.blocks.find(b => b.blockKey === blockKey);
                if (!block) return;
                const room = block.rooms.find(r => r.roomNumber === roomId);
                if (!room) return;
                
                renderRoomDetailsModal(room, block);
                showModal('room-details-modal');
            }
        });

        modalDeleteRoomBtn.addEventListener('click', async () => {
            if (!currentRoomData || !currentRoomData._id) return;
            const blockKey = detailView.dataset.currentHostelKey;
            const roomId = currentRoomData._id;

            if (confirm(`Are you sure you want to delete room ${currentRoomData.roomNumber}?\nThis will also remove all students in it and return all assets to stock.`)) {
                try {
                    // Simulating DELETE API call
                    const block = appState.blocks.find(b => b.blockKey === blockKey);
                    if (block) {
                        block.rooms = block.rooms.filter(r => r._id !== roomId);
                    }

                    await loadHostelData(); 
                    await loadAssetData(); 
                    hideModal('room-details-modal');

                    // const res = await fetch(`/api/blocks/${blockKey}/rooms/${roomId}`, { method: 'DELETE' });
                    // const data = await res.json();
                    // if (data.success) { await loadHostelData(); await loadAssetData(); hideModal('room-details-modal'); } else { throw new Error(data.message); }
                } catch (error) {
                    alert(`Error deleting room: ${error.message}`);
                }
            }
        });

        modalOccupantContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-student-btn');
            if (button) {
                e.preventDefault();
                e.stopPropagation();
                const studentId = button.dataset.studentId;
                if (confirm(`Are you sure you want to remove this student?\nTheir assets will be returned to stock.`)) {
                    try {
                        // Simulating DELETE API call
                        let studentRemoved = false;
                        for(const block of appState.blocks) {
                            for(const room of block.rooms) {
                                const initialCount = room.students.length;
                                room.students = room.students.filter(s => s._id !== studentId);
                                if (room.students.length < initialCount) {
                                    studentRemoved = true;
                                    break;
                                }
                            }
                            if (studentRemoved) break;
                        }

                        await loadHostelData(); 
                        await loadAssetData(); 

                        const blockKey = detailView.dataset.currentHostelKey;
                        const block = appState.blocks.find(b => b.blockKey === blockKey);
                        const updatedRoom = block.rooms.find(r => r._id === currentRoomData._id);
                        if (updatedRoom) {
                            renderRoomDetailsModal(updatedRoom, block);
                            console.log('âœ… Student removed, modal updated.');
                        } else {
                            hideModal('room-details-modal');
                        }

                        // const res = await fetch(`/api/students/${studentId}`, { method: 'DELETE' });
                        // const data = await res.json();
                        // if (data.success) { await loadHostelData(); await loadAssetData(); const blockKey = detailView.dataset.currentHostelKey; const block = appState.blocks.find(b => b.blockKey === blockKey); const updatedRoom = block.rooms.find(r => r._id === currentRoomData._id); if (updatedRoom) { renderRoomDetailsModal(updatedRoom, block); console.log('âœ… Student removed, modal updated.'); } else { hideModal('room-details-modal'); } } else { throw new Error(data.message); }
                    } catch (error) {
                        alert(`Error removing student: ${error.message}`);
                    }
                }
            }
        });
        
        // --- 9. DELETE HANDLERS (for cards) ---
        hostelBlockContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-block-btn');
            if (button) {
                e.preventDefault(); e.stopPropagation();
                const blockId = button.dataset.blockId;
                const blockName = button.dataset.blockName;
                if (confirm(`Are you sure you want to delete the block "${blockName}"?\nThis action is permanent and will delete all associated rooms, students, and return their assets.`)) {
                    try {
                        // Simulating DELETE API call
                        appState.blocks = appState.blocks.filter(b => b._id !== blockId);
                        await loadHostelData();
                        await loadAssetData(); 
                        // const res = await fetch(`/api/blocks/${blockId}`, { method: 'DELETE' });
                        // const data = await res.json();
                        // if (data.success) { await loadHostelData(); await loadAssetData(); } else { throw new Error(data.message); }
                    } catch (error) { alert(`Error deleting block: ${error.message}`); }
                }
            }
        });
        
        clubActivityContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-activity-btn');
            if (button) {
                e.preventDefault(); e.stopPropagation();
                const activityId = button.dataset.activityId;
                const activityTitle = button.dataset.activityTitle;
                if (confirm(`Are you sure you want to delete the activity "${activityTitle}"?`)) {
                    try {
                        // Simulating DELETE API call
                        await loadClubActivities(); // Reloads activities after mock delete
                        // const res = await fetch(`/api/activities/${activityId}`, { method: 'DELETE' });
                        // const data = await res.json();
                        // if (data.success) { await loadClubActivities(); } else { throw new Error(data.message); }
                    } catch (error) { alert(`Error deleting activity: ${error.message}`); }
                }
            }
        });

        assetInventoryContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-asset-btn');
            if (button) {
                e.preventDefault(); e.stopPropagation();
                const assetId = button.dataset.assetId;
                const assetName = button.dataset.assetName;
                if (confirm(`Are you sure you want to delete "${assetName}" from the inventory?`)) {
                    try {
                        // Simulating DELETE API call
                        appState.assets = appState.assets.filter(a => a._id !== assetId);
                        await loadAssetData(); 
                        // const res = await fetch(`/api/assets/${assetId}`, { method: 'DELETE' });
                        // const data = await res.json();
                        // if (data.success) { await loadAssetData(); } else { throw new Error(data.message); }
                    } catch (error) {
                        alert(`Error deleting asset: ${error.message}`);
                    }
                }
            }
        });
        
        // STAFF DELETE HANDLER
        staffListContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-staff-btn');
            if (button) {
                e.preventDefault(); e.stopPropagation();
                const staffId = button.dataset.staffId;
                const staffName = button.dataset.staffName;
                if (confirm(`Are you sure you want to delete the staff member "${staffName}"?`)) {
                    try {
                        // Simulating DELETE operation
                        appState.staff = appState.staff.filter(s => s._id !== staffId);
                        updateStaffCount();
                        renderStaffView();
                        showSuccess(`${staffName} has been removed.`);
                    } catch (error) {
                        alert(`Error deleting staff member: ${error.message}`);
                    }
                }
            }
        });
        // END STAFF DELETE HANDLER

        // --- 10. "SHOW MODAL" BUTTON LISTENERS ---
        showAddBlockModalBtn.addEventListener('click', () => showModal('add-block-modal'));
        
        showAddRoomModalBtn.addEventListener('click', () => {
            roomAssetAssignmentContainer.innerHTML = ''; 
            addAssetAssignmentRow(roomAssetAssignmentContainer); 
            showModal('add-room-modal');
        });

        showAddStudentModalBtn.addEventListener('click', () => {
            studentAssetAssignmentContainer.innerHTML = ''; 
            addAssetAssignmentRow(studentAssetAssignmentContainer); 
            showModal('add-student-modal');
        });
        
        showAddEventModalBtn.addEventListener('click', () => showModal('add-event-modal'));
        showAddClubActivityModalBtn.addEventListener('click', () => showModal('add-club-activity-modal'));
        showAddAssetModalBtn.addEventListener('click', () => showModal('add-asset-modal')); 

        // NEW STAFF MODAL LISTENERS
        showStaffViewBtn.addEventListener('click', () => {
            hideAllViews();
            staffView.classList.remove('hidden');
            renderStaffView();
        });

        showStaffViewCardBtn.addEventListener('click', () => {
            hideAllViews();
            staffView.classList.remove('hidden');
            renderStaffView();
        });

        backToDashboardFromStaffBtn.addEventListener('click', () => {
            hideAllViews();
            dashboardView.classList.remove('hidden');
            renderDashboard();
        });

        showAddStaffModalBtn.addEventListener('click', () => {
            populateStaffBlockSelect();
            staffBlockManualInput.classList.add('hidden'); // Ensure manual field is hidden initially
            showModal('add-staff-modal');
        });

        staffHostelBlockSelect.addEventListener('change', () => {
            if (staffHostelBlockSelect.value === 'Other') {
                staffBlockManualInput.classList.remove('hidden');
            } else {
                staffBlockManualInput.classList.add('hidden');
                staffBlockManualInput.value = '';
            }
        });
        
        staffSearchInput.addEventListener('input', renderStaffView);
        // END NEW STAFF MODAL LISTENERS

        // View navigation listeners
        showFeesViewBtn.addEventListener('click', () => {
            hideAllViews();
            feesView.classList.remove('hidden');
            renderFeesView();
        });
        
        backToDashboardFromFeesBtn.addEventListener('click', () => {
            hideAllViews();
            dashboardView.classList.remove('hidden');
            renderDashboard();
        });
        
        showVisitorsViewBtn.addEventListener('click', () => {
            hideAllViews();
            visitorsView.classList.remove('hidden');
            visitorDateFilter.value = new Date().toISOString().split('T')[0];
            renderVisitorsView();
        });
        
        backToDashboardFromVisitorsBtn.addEventListener('click', () => {
            hideAllViews();
            dashboardView.classList.remove('hidden');
        });

        // Complaints View Listeners
        showComplaintsViewBtn.addEventListener('click', () => {
            hideAllViews();
            complaintsView.classList.remove('hidden');
            loadComplaintsData();
        });
        
        backToDashboardFromComplaintsBtn.addEventListener('click', () => {
            hideAllViews();
            dashboardView.classList.remove('hidden');
        });

        // Complaints filtering and search
        complaintSearchInput.addEventListener('input', renderComplaintsView);
        complaintStatusFilter.addEventListener('change', renderComplaintsView);
        complaintTypeFilter.addEventListener('change', renderComplaintsView);

        // Refresh complaints
        refreshComplaintsBtn.addEventListener('click', () => {
            loadComplaintsData();
            showSuccess('Complaints refreshed');
        });

        // Complaint actions
        complaintsListContainer.addEventListener('click', async (e) => {
            const viewBtn = e.target.closest('.view-complaint-details-btn');
            const statusBtn = e.target.closest('.update-complaint-status-btn');
            
            if (viewBtn) {
                const complaintId = viewBtn.dataset.complaintId;
                showComplaintDetails(complaintId);
            }
            
            if (statusBtn) {
                const complaintId = statusBtn.dataset.complaintId;
                const newStatus = statusBtn.dataset.newStatus;
                
                let adminNotes = '';
                if (newStatus === 'Resolved') {
                    adminNotes = prompt('Enter resolution notes:');
                    if (adminNotes === null) return;
                }
                
                if (await updateComplaintStatus(complaintId, newStatus, adminNotes)) {
                    renderComplaintsView();
                }
            }
        });

        // Add response to complaint
        complaintDetailsContent.addEventListener('click', async (e) => {
            if (e.target.id === 'submit-complaint-response') {
                const complaintId = e.target.dataset.complaintId;
                const responseText = document.getElementById('complaint-response').value.trim();
                
                if (!responseText) {
                    showError('Please enter a response');
                    return;
                }
                
                if (await addComplaintResponse(complaintId, responseText)) {
                    document.getElementById('complaint-response').value = '';
                    showComplaintDetails(complaintId);
                }
            }
        });

        // --- 11. OTHER LISTENERS ---
        adminLogoutBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to log out?')) {
                window.location.href = '/login.html';
            }
        });
        
        feesSearchInput.addEventListener('input', renderFeesView);
        feesFilterSelect.addEventListener('change', renderFeesView);
        
        visitorSearchInput.addEventListener('input', renderVisitorsView);
        visitorDateFilter.addEventListener('change', renderVisitorsView);
        
        feesStudentListContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.toggle-fee-status-btn');
            if (button) {
                const studentId = button.dataset.studentId;
                const student = findStudentById(studentId);
                if (student) {
                    student.feeStatus = (student.feeStatus === 'Paid') ? 'Pending' : 'Paid';
                    console.log(`Updated student ${student.name} fee status to ${student.feeStatus}`);
                    renderFeesView();
                }
            }
        });

        // --- 12. INITIALIZE APP ---
        function initApp() {
            console.log('ðŸš€ Initializing Admin Dashboard...');
            loadHostelData();
            loadClubActivities();
            loadAssetData();
            loadComplaintsData();
            renderEvents();
            updateStaffCount();
            renderStaffView();
        }
        initApp();
    });
    
    </script>
</body>
</html>