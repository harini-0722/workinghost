<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel Admin Dashboard | Professional View</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        indigo: {
                            50: '#f0f3ff',
                            100: '#e0e7ff',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        }
                    }
                }
            }
        }
    </script>
    <script type="module" src="https://unpkg.com/heroicons@2.1.1/dist/index.js"></script>
    
    <style>
        /* Apply Inter Font explicitly to body */
        body {
            font-family: 'Inter', sans-serif;
            /* Using gray-50 for a professional, clean background */
            background-color: #f9fafb; 
        }
        /* Your custom styles */
        .progress-ring-text { font-size: 0.75rem; font-weight: 600; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); opacity: 0; transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: all 0.3s ease-in-out; transform: translateY(-20px); opacity: 0; }
        .modal.active .modal-backdrop { opacity: 1; }
        .modal.active .modal-content { transform: translateY(0); opacity: 1; }
        .progress-bar { background-color: #e9ecef; border-radius: 9999px; overflow: hidden; height: 8px; }
        .progress-bar-inner { height: 100%; border-radius: 9999px; transition: width 0.3s ease; }
        .progress-ring-circle { transition: stroke-dashoffset 0.5s ease-out; transform: rotate(-90deg); transform-origin: 50% 50%; }
        .progress-ring-text { font-size: 1rem; font-weight: 600; }
        .activity-card-image {
            height: 150px;
            object-fit: cover;
            width: 100%;
        }
        /* Style adjustments for professional look */
        .shadow-lg { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); }
        .hover\:shadow-xl:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

    <nav class="bg-white shadow-lg sticky top-0 z-20 border-b border-gray-200">
        <div class="w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex-shrink-0 flex items-center">
                    <hero-icon-solid name="building-library" class="h-7 w-7 text-indigo-600 mr-2"></hero-icon-solid>
                    <h1 class="text-xl font-extrabold text-gray-800 tracking-tight">HOSTEL MANAGEMENT</h1>
                    <span class="ml-4 text-gray-400 font-normal hidden sm:inline border-l pl-4">Indian Institute of Technology</span>
                </div>
                <div class="flex items-center space-x-6">
                    <button id="show-complaints-view-btn" class="flex items-center text-sm font-semibold text-red-600 hover:text-red-700 transition duration-150">
                        <hero-icon-outline name="bell-alert" class="h-5 w-5 mr-1"></hero-icon-outline>
                        Complaints
                    </button>

                    <a href="adminhandlegymkhana.html" target="_top" class="flex items-center text-sm font-semibold text-purple-600 hover:text-purple-700 transition duration-150">
                        <hero-icon-outline name="users" class="h-5 w-5 mr-1"></hero-icon-outline>
                        Gymkhana
                    </a>
                    
                    <div class="flex items-center">
                        <span class="text-sm font-semibold text-gray-700 mr-3 hidden sm:inline">Admin</span>
                        <div class="flex-shrink-0">
                            <span class="inline-flex items-center justify-center h-10 w-10 rounded-full bg-indigo-500 border-2 border-white shadow-md">
                                <span class="font-semibold text-white">A</span>
                            </span>
                        </div>
                    </div>
                    
                    <button id="admin-logout-btn" class="flex items-center text-sm font-semibold text-gray-600 hover:text-gray-900 transition duration-150">
                        <hero-icon-outline name="arrow-right-on-rectangle" class="h-5 w-5 mr-1"></hero-icon-outline>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="mx-auto px-4 sm:px-6 lg:px-8 py-10 w-full flex-grow">
        
        <div id="dashboard-view">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500 transition-all duration-300 hover:shadow-xl hover:scale-[1.01]">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-xs font-semibold text-gray-500 tracking-wider uppercase">TOTAL CAPACITY</span>
                            <p class="text-3xl font-extrabold text-indigo-700 mt-2" id="stat-total-capacity">0</p>
                            <p class="text-sm text-gray-500 mt-1">Total Hostel Units</p>
                        </div>
                        <div class="p-3 bg-indigo-100 rounded-xl shadow-inner">
                            <hero-icon-outline name="building-office-2" class="h-6 w-6 text-indigo-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-amber-500 transition-all duration-300 hover:shadow-xl hover:scale-[1.01]">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-xs font-semibold text-gray-500 tracking-wider uppercase">OCCUPANCY RATE</span>
                            <p class="text-3xl font-extrabold text-amber-700 mt-2" id="stat-occupancy-percent">0%</p>
                            <p class="text-sm text-gray-500 mt-1">Beds Filled</p>
                        </div>
                        <div class="relative h-20 w-20 flex-shrink-0">
                            <svg class="h-full w-full" width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="18" cy="18" r="16" fill="none" class="text-amber-100 stroke-current" stroke-width="5"></circle>
                                <circle cx="18" cy="18" r="16" fill="none" class="progress-ring-circle text-amber-500 stroke-current" 
                                        stroke-width="5" 
                                        stroke-dasharray="100" 
                                        stroke-dashoffset="100" 
                                        stroke-linecap="round" 
                                        id="stat-occupancy-ring"></circle>
                            </svg>
                            <div class="absolute top-0 left-0 flex h-full w-full items-center justify-center">
                                <span class="progress-ring-text text-amber-600" id="stat-occupancy-label">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500 transition-all duration-300 hover:shadow-xl hover:scale-[1.01]">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-xs font-semibold text-gray-500 tracking-wider uppercase">OPEN COMPLAINTS</span>
                            <p class="text-3xl font-extrabold text-red-700 mt-2" id="stat-open-complaints">0</p>
                            <p class="text-sm text-gray-500 mt-1">Pending Resolution</p>
                        </div>
                        <div class="p-3 bg-red-100 rounded-xl shadow-inner">
                            <hero-icon-outline name="exclamation-triangle" class="h-6 w-6 text-red-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-emerald-500 transition-all duration-300 hover:shadow-xl hover:scale-[1.01]">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-xs font-semibold text-gray-500 tracking-wider uppercase">DAILY ATTENDANCE</span>
                            <p class="text-3xl font-extrabold text-emerald-700 mt-2" id="stat-attendance-percent">98%</p>
                            <p class="text-sm text-gray-500 mt-1">Latest Check-in Rate</p>
                        </div>
                        <div class="relative h-20 w-20 flex-shrink-0">
                            <svg class="h-full w-full" width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="18" cy="18" r="16" fill="none" class="text-emerald-100 stroke-current" stroke-width="5"></circle>
                                <circle cx="18" cy="18" r="16" fill="none" class="progress-ring-circle text-emerald-500 stroke-current" 
                                        stroke-width="5" 
                                        stroke-dasharray="100" 
                                        stroke-dashoffset="2" 
                                        stroke-linecap="round"
                                        id="stat-attendance-ring"></circle>
                            </svg>
                            <div class="absolute top-0 left-0 flex h-full w-full items-center justify-center">
                                <span class="progress-ring-text text-emerald-600" id="stat-attendance-label">98%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="show-fees-view-btn" class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-teal-500 transition-all duration-300 hover:shadow-xl hover:scale-[1.01] cursor-pointer">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-xs font-semibold text-gray-500 tracking-wider uppercase">FEES STATUS</span>
                            <p class="text-3xl font-extrabold text-teal-700 mt-2" id="stat-fees-pending">0 Pending</p>
                            <p class="text-sm text-gray-500 mt-1">Total Dues</p>
                        </div>
                        <div class="p-3 bg-teal-100 rounded-xl shadow-inner">
                            <hero-icon-outline name="banknotes" class="h-6 w-6 text-teal-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>

                <div id="show-visitors-view-btn" class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-sky-500 transition-all duration-300 hover:shadow-xl hover:scale-[1.01] cursor-pointer">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-xs font-semibold text-gray-500 tracking-wider uppercase">VISITOR LOGS</span>
                            <p class="text-3xl font-extrabold text-sky-700 mt-2" id="stat-visitors-today">0 Today</p>
                            <p class="text-sm text-gray-500 mt-1">Current Entries</p>
                        </div>
                        <div class="p-3 bg-sky-100 rounded-xl shadow-inner">
                            <hero-icon-outline name="identification" class="h-6 w-6 text-sky-500"></hero-icon-outline>
                        </div>
                    </div>
                </div>
            </div>
            
            <hr class="my-10 border-gray-200">

            <div class="mt-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-2xl font-extrabold text-gray-800 flex items-center">
                        <hero-icon-solid name="building-office-2" class="h-6 w-6 text-gray-600 mr-2"></hero-icon-solid>
                        Hostel Block Summary
                    </h2>
                    <button id="show-add-block-modal-btn" class="mt-4 sm:mt-0 flex items-center px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 hover:scale-[1.02] text-sm">
                        <hero-icon-solid name="plus" class="h-5 w-5 mr-2"></hero-icon-solid>
                        Add New Block
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="hostel-block-container">
                    </div>
            </div>

            <hr class="my-10 border-gray-200">

            <div class="mt-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-2xl font-extrabold text-gray-800 flex items-center">
                        <hero-icon-solid name="calendar-days" class="h-6 w-6 text-gray-600 mr-2"></hero-icon-solid>
                        Events & Announcements
                    </h2>
                    <button id="show-add-event-modal-btn" class="mt-4 sm:mt-0 flex items-center px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 hover:scale-[1.02] text-sm">
                        <hero-icon-solid name="calendar-plus" class="h-5 w-5 mr-2"></hero-icon-solid>
                        Add New Event
                    </button>
                </div>
               <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="event-list-container">
                    </div>
            </div>

            <hr class="my-10 border-gray-200">

            <div class="mt-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-2xl font-extrabold text-gray-800 flex items-center">
                        <hero-icon-solid name="puzzle-piece" class="h-6 w-6 text-gray-600 mr-2"></hero-icon-solid>
                        Club Activities / Gymkhana
                    </h2>
                    <button id="show-add-club-activity-modal-btn" class="mt-4 sm:mt-0 flex items-center px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 hover:scale-[1.02] text-sm">
                        <hero-icon-solid name="calendar-plus" class="h-5 w-5 mr-2"></hero-icon-solid>
                        Add New Activity
                    </button>
                </div>
               <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="club-activity-container">
                    </div>
            </div>
            
            <hr class="my-10 border-gray-200">

            <div class="mt-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-2xl font-extrabold text-gray-800 flex items-center">
                        <hero-icon-solid name="archive-box" class="h-6 w-6 text-gray-600 mr-2"></hero-icon-solid>
                        Hostel Asset Inventory
                    </h2>
                    <button id="show-add-asset-modal-btn" class="mt-4 sm:mt-0 flex items-center px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 hover:scale-[1.02] text-sm">
                        <hero-icon-solid name="archive-box-arrow-down" class="h-5 w-5 mr-2"></hero-icon-solid>
                        Add New Asset
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="asset-inventory-container">
                    <p class="text-gray-500 col-span-full flex items-center">
                          <hero-icon-outline name="cube" class="h-5 w-5 mr-2 text-gray-400"></hero-icon-outline>
                          No assets added yet. Add assets to the inventory.
                    </p>
                </div>
            </div>
        </div> 

        <div id="detail-view" class="hidden">
             <div class="relative mb-8 pb-4 border-b border-gray-200">
                 <button id="back-to-dashboard-btn" class="flex items-center text-sm font-semibold text-gray-600 hover:text-indigo-700 transition duration-150 p-2 rounded-lg hover:bg-gray-100">
                     <hero-icon-solid name="arrow-left" class="h-5 w-5 mr-2"></hero-icon-solid>
                     Back to Dashboard
                 </button>
                 <div class="flex items-center justify-center absolute inset-x-0 top-0 z-0">
                     <h1 id="detail-hostel-name" class="text-3xl font-extrabold text-gray-800 tracking-tight" style="color: #4b0082;"></h1>
                 </div>
             </div>
            
             <div class="bg-white p-6 rounded-xl shadow-lg border-l-8 border-indigo-500 mb-8">
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                     <div>
                         <span class="text-gray-500 font-semibold text-sm uppercase tracking-wider">Capacity</span>
                         <div class="flex items-center justify-center mt-2">
                             <hero-icon-outline name="building-office-2" class="h-6 w-6 text-purple-600 mr-2"></hero-icon-outline>
                             <span class="text-3xl font-bold text-purple-700" id="detail-stat-capacity">0</span>
                         </div>
                     </div>
                     <div class="border-l border-r border-gray-200">
                         <span class="text-gray-500 font-semibold text-sm uppercase tracking-wider">Occupancy</span>
                         <div class="flex items-center justify-center mt-2">
                             <hero-icon-outline name="chart-pie" class="h-6 w-6 text-amber-600 mr-2"></hero-icon-outline>
                             <span class="text-3xl font-bold text-amber-700" id="detail-stat-occupancy">0</span>
                         </div>
                     </div>
                     <div>
                         <span class="text-gray-500 font-semibold text-sm uppercase tracking-wider">Available Beds</span>
                         <div class="flex items-center justify-center mt-2">
                             <hero-icon-outline name="squares-plus" class="h-6 w-6 text-green-600 mr-2"></hero-icon-outline>
                             <span class="text-3xl font-bold text-green-700" id="detail-stat-available">0</span>
                         </div>
                     </div>
                 </div>
             </div>
            
             <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 bg-white p-4 rounded-xl shadow-md">
                 <div class="flex flex-wrap gap-4">
                      <button id="show-add-student-modal-btn" class="flex items-center px-5 py-2.5 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-all duration-300 text-sm">
                              <hero-icon-solid name="user-plus" class="h-5 w-5 mr-2"></hero-icon-solid>
                              Add New Student
                      </button>
                      <button id="show-add-room-modal-btn" class="flex items-center px-5 py-2.5 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-all duration-300 text-sm">
                              <hero-icon-solid name="building-office-2" class="h-5 w-5 mr-2"></hero-icon-solid>
                              Add New Room
                      </button>
                 </div>
                 
                 <div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
                      <div class="relative w-full sm:w-auto">
                          <hero-icon-outline name="magnifying-glass" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"></hero-icon-outline>
                          <input type="text" id="room-search-input" placeholder="Search room number..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full sm:w-48 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
                      </div>
                      <select id="room-filter-select" class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full sm:w-32 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
                          <option value="All">All Rooms</option>
                          <option value="Full">Full</option>
                          <option value="Available">Available</option>
                      </select>
                 </div>
             </div>

             <div id="room-list-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                 </div>
        </div>

        <div id="fees-view" class="hidden">
             <div class="relative mb-8 pb-4 border-b border-gray-200">
                 <button id="back-to-dashboard-from-fees-btn" class="flex items-center text-sm font-semibold text-gray-600 hover:text-teal-700 transition duration-150 p-2 rounded-lg hover:bg-gray-100">
                     <hero-icon-solid name="arrow-left" class="h-5 w-5 mr-2"></hero-icon-solid>
                     Back to Dashboard
                 </button>
                 <div class="flex items-center justify-center absolute inset-x-0 top-0 z-0">
                     <h1 class="text-3xl font-extrabold text-teal-700 tracking-tight">
                         <hero-icon-solid name="banknotes" class="h-7 w-7 inline-block mr-2"></hero-icon-solid>
                         Fees Management
                     </h1>
                 </div>
             </div>
            
             <div class="flex flex-col md:flex-row justify-end items-center mb-6 gap-4 bg-white p-4 rounded-xl shadow-md">
                 <div class="relative w-full md:w-64">
                     <hero-icon-outline name="magnifying-glass" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"></hero-icon-outline>
                     <input type="text" id="fees-search-input" placeholder="Search by name or roll no..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
                 </div>
                 <select id="fees-filter-select" class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full md:w-32 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
                     <option value="All">All Statuses</option>
                     <option value="Paid">Paid</option>
                     <option value="Pending">Pending</option>
                 </select>
             </div>
            
             <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                 <div class="overflow-x-auto">
                     <table class="w-full min-w-max">
                         <thead class="bg-gray-100 border-b border-gray-200">
                             <tr>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Student Name</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Roll Number</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Block / Room</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Status</th>
                                 <th class="px-6 py-3 text-center text-xs font-bold text-gray-700 uppercase tracking-wider">Action</th>
                             </tr>
                         </thead>
                         <tbody id="fees-student-list-container" class="divide-y divide-gray-200">
                              </tbody>
                     </table>
                 </div>
             </div>
        </div>
        
        <div id="visitors-view" class="hidden">
             <div class="relative mb-8 pb-4 border-b border-gray-200">
                 <button id="back-to-dashboard-from-visitors-btn" class="flex items-center text-sm font-semibold text-gray-600 hover:text-sky-700 transition duration-150 p-2 rounded-lg hover:bg-gray-100">
                     <hero-icon-solid name="arrow-left" class="h-5 w-5 mr-2"></hero-icon-solid>
                     Back to Dashboard
                 </button>
                 <div class="flex items-center justify-center absolute inset-x-0 top-0 z-0">
                     <h1 class="text-3xl font-extrabold text-sky-700 tracking-tight">
                         <hero-icon-solid name="user-group" class="h-7 w-7 inline-block mr-2"></hero-icon-solid>
                         Visitor Logs
                     </h1>
                 </div>
             </div>
            
             <div class="flex flex-col md:flex-row justify-end items-center mb-6 gap-4 bg-white p-4 rounded-xl shadow-md">
                 <div class="relative w-full md:w-64">
                     <hero-icon-outline name="magnifying-glass" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"></hero-icon-outline>
                     <input type="text" id="visitor-search-input" placeholder="Search by visitor or student name..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
                 </div>
                 <input type="date" id="visitor-date-filter" class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full md:w-36 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
             </div>
            
             <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                 <div class="overflow-x-auto">
                     <table class="w-full min-w-max">
                         <thead class="bg-gray-100 border-b border-gray-200">
                             <tr>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Visitor Name</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Student Visited</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Room</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Date</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Time In</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Time Out</th>
                             </tr>
                         </thead>
                         <tbody id="visitor-log-container" class="divide-y divide-gray-200">
                             </tbody>
                     </table>
                 </div>
             </div>
        </div>

        <div id="complaints-view" class="hidden">
             <div class="relative mb-8 pb-4 border-b border-gray-200">
                 <button id="back-to-dashboard-from-complaints-btn" class="flex items-center text-sm font-semibold text-gray-600 hover:text-red-700 transition duration-150 p-2 rounded-lg hover:bg-gray-100">
                     <hero-icon-solid name="arrow-left" class="h-5 w-5 mr-2"></hero-icon-solid>
                     Back to Dashboard
                 </button>
                 <div class="flex items-center justify-center absolute inset-x-0 top-0 z-0">
                     <h1 class="text-3xl font-extrabold text-red-700 tracking-tight">
                         <hero-icon-solid name="bell-alert" class="h-7 w-7 inline-block mr-2"></hero-icon-solid>
                         Student Complaints
                     </h1>
                 </div>
             </div>
            
             <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 bg-white p-4 rounded-xl shadow-md">
                 <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                     <div class="relative w-full md:w-56">
                         <hero-icon-outline name="magnifying-glass" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"></hero-icon-outline>
                         <input type="text" id="complaint-search-input" placeholder="Search by student or room..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
                     </div>
                     <select id="complaint-status-filter" class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full md:w-36 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
                         <option value="All">All Status</option>
                         <option value="Pending">Pending</option>
                         <option value="In Progress">In Progress</option>
                         <option value="Resolved">Resolved</option>
                     </select>
                     <select id="complaint-type-filter" class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm w-full md:w-40 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition duration-150">
                         <option value="All">All Types</option>
                         <option value="Maintenance">Maintenance</option>
                         <option value="Cleaning">Cleaning</option>
                         <option value="Electrical">Electrical</option>
                         <option value="Plumbing">Plumbing</option>
                         <option value="Internet">Internet</option>
                         <option value="Security">Security</option>
                         <option value="Other">Other</option>
                     </select>
                 </div>
                 <button id="refresh-complaints-btn" class="flex items-center px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-all duration-300 text-sm">
                     <hero-icon-solid name="arrow-path" class="h-5 w-5 mr-2"></hero-icon-solid>
                     Refresh
                 </button>
             </div>
            
             <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                 <div class="overflow-x-auto">
                     <table class="w-full min-w-max">
                         <thead class="bg-gray-100 border-b border-gray-200">
                             <tr>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Student</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Room</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Complaint Type</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Description</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Date</th>
                                 <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Status</th>
                                 <th class="px-6 py-3 text-center text-xs font-bold text-gray-700 uppercase tracking-wider">Actions</th>
                             </tr>
                         </thead>
                         <tbody id="complaints-list-container" class="divide-y divide-gray-200">
                             </tbody>
                     </table>
                 </div>
             </div>
        </div>

    </main>

    <footer class="mt-12 py-6 border-t border-gray-200 bg-white shadow-inner">
        <div class="w-full mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm text-gray-500">
                &copy; 2025 Indian Institute of Technology. All rights reserved.
            </p>
        </div>
    </footer>

    <div id="add-block-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-block-modal"></div>
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl z-40 w-full max-w-md mx-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <hero-icon-outline name="building-office-2" class="h-6 w-6 text-indigo-500 mr-2"></hero-icon-outline>
                Add New Hostel Block
            </h2>
            <form id="add-block-form" class="space-y-4">
                <div>
                    <label for="block-name" class="block text-sm font-semibold text-gray-700">Block Name</label>
                    <input type="text" id="block-name" name="blockName" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., Sarojini Hall" required>
                </div>
                 <div>
                    <label for="block-key" class="block text-sm font-semibold text-gray-700">Unique Key</label>
                    <input type="text" id="block-key" name="blockKey" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 'sarojini' (lowercase, no spaces)" required>
                </div>
                <div>
                    <label for="block-theme" class="block text-sm font-semibold text-gray-700">Theme Color</label>
                    <select id="block-theme" name="blockTheme" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="pink">Pink (Women)</option>
                        <option value="blue">Blue (Men)</option>
                        <option value="green">Green</option>
                        <option value="purple">Purple</option>
                        <option value="yellow">Yellow</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <button type="button" class="flex items-center px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium" data-modal-hide="add-block-modal">
                        <hero-icon-solid name="x-mark" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Cancel
                    </button>
                    <button type="submit" class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                        <hero-icon-solid name="folder-plus" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Save Block
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="add-room-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-room-modal"></div>
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl z-40 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <hero-icon-outline name="building-office" class="h-6 w-6 text-indigo-500 mr-2"></hero-icon-outline>
                Add New Room
            </h2>
            <form id="add-room-form" class="space-y-4">
                <div>
                    <label for="room-id" class="block text-sm font-semibold text-gray-700">Room ID / Number</label>
                    <input type="text" id="room-id" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., A-103" required>
                </div>
                 <div>
                    <label for="room-floor" class="block text-sm font-semibold text-gray-700">Floor Details</label>
                    <input type="text" id="room-floor" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 1st Floor, A-Block" required>
                </div>
                <div>
                    <label for="room-capacity" class="block text-sm font-semibold text-gray-700">Total Capacity</label>
                    <input type="number" id="room-capacity" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" value="2" min="1" required>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700">Assign Assets to Room</label>
                    <div id="room-asset-assignment-container" class="mt-2 space-y-3 p-3 border border-gray-200 rounded-lg bg-gray-50">
                    </div>
                    <button type="button" id="add-room-asset-row-btn" class="mt-3 text-sm font-medium text-indigo-600 hover:text-indigo-800 flex items-center">
                        <hero-icon-solid name="plus-circle" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Add Asset Row
                    </button>
                </div>

                <div>
                    <label for="room-image-file" class="block text-sm font-semibold text-gray-700">Upload Room Image</label>
                    <input type="file" id="room-image-file" name="roomImage" class="mt-1 block w-full text-sm text-gray-500
                                 file:mr-4 file:py-2 file:px-4
                                 file:rounded-full file:border-0
                                 file:text-sm file:font-semibold
                                 file:bg-indigo-50 file:text-indigo-700
                                 hover:file:bg-indigo-100"
                                 accept="image/*">
                    <p class="mt-1 text-xs text-gray-500">Upload an image of the room (PNG, JPG, etc.).</p>
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <button type="button" class="flex items-center px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium" data-modal-hide="add-room-modal">
                        <hero-icon-solid name="x-mark" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Cancel
                    </button>
                    <button type="submit" class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                        <hero-icon-solid name="plus" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Add Room
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="add-student-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-student-modal"></div>
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl z-40 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <hero-icon-outline name="user-group" class="h-6 w-6 text-indigo-500 mr-2"></hero-icon-outline>
                Add New Student
            </h2>
            <form id="add-student-form" class="space-y-4">
                 <h3 class="text-sm font-bold text-gray-600 border-b pb-1">Login Details</h3>
                 <div class="grid grid-cols-2 gap-4">
                      <div>
                          <label for="student-username" class="block text-sm font-semibold text-gray-700">Username</label>
                          <input type="text" id="student-username" name="username" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                      </div>
                      <div>
                          <label for="student-password" class="block text-sm font-semibold text-gray-700">Password</label>
                          <input type="password" id="student-password" name="password" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                      </div>
                 </div>

                 <h3 class="text-sm font-bold text-gray-600 border-b pt-2 pb-1">Hostel Details</h3>
                 <div>
                      <label for="student-room-id" class="block text-sm font-semibold text-gray-700">Select Room</label>
                      <select id="student-room-id" name="roomId" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                          </select>
                 </div>
                 <div>
                      <label for="student-joining-date" class="block text-sm font-semibold text-gray-700">Joining Date</label>
                      <input type="date" id="student-joining-date" name="joiningDate" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                 </div>
                  <div class="grid grid-cols-2 gap-4">
                      <div>
                          <label for="student-fee-status" class="block text-sm font-semibold text-gray-700">Fee Status</label>
                          <select id="student-fee-status" name="feeStatus" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                              <option value="Paid">Paid</option>
                              <option value="Pending" selected>Pending</option>
                          </select>
                      </div>
                      <div>
                          <label for="student-payment-method" class="block text-sm font-semibold text-gray-700">Payment Method</label>
                          <select id="student-payment-method" name="paymentMethod" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                              <option value="Not Paid">Not Paid</option>
                              <option value="Cash">Cash</option>
                              <option value="Card">Card</option>
                              <option value="Online">Online</option>
                          </select>
                      </div>
                  </div>

                 <h3 class="text-sm font-bold text-gray-600 border-b pt-2 pb-1">Personal & Academic</h3>
                 <div>
                      <label for="student-name" class="block text-sm font-semibold text-gray-700">Student Name</label>
                      <input type="text" id="student-name" name="name" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Enter full name" required>
                 </div>
                 
                 <div>
                      <label for="student-roll-number" class="block text-sm font-semibold text-gray-700">Roll Number</label>
                      <input type="text" id="student-roll-number" name="rollNumber" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 21CS10001" required>
                 </div>
                 
                 <div>
                      <label for="student-course" class="block text-sm font-semibold text-gray-700">Course</label>
                      <input type="text" id="student-course" name="course" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., B.Tech">
                 </div>
                 <div>
                      <label for="student-department" class="block text-sm font-semibold text-gray-700">Department</label>
                      <input type="text" id="student-department" name="department" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., CSE">
                 </div>
                 <div>
                      <label for="student-year" class="block text-sm font-semibold text-gray-700">Year</label>
                      <input type="text" id="student-year" name="year" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 3rd Year">
                 </div>
                 <div>
                      <label for="student-email" class="block text-sm font-semibold text-gray-700">Email</label>
                      <input type="email" id="student-email" name="email" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="student@iit.edu">
                 </div>
                 <div>
                      <label for="student-phone" class="block text-sm font-semibold text-gray-700">Phone</label>
                      <input type="tel" id="student-phone" name="phone" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="+91 XXXXX XXXXX">
                 </div>
                 
                 <div>
                      <label for="student-profile-image" class="block text-sm font-semibold text-gray-700">Upload Profile Photo</label>
                      <input type="file" id="student-profile-image" name="profileImage" class="mt-1 block w-full text-sm text-gray-500
                                 file:mr-4 file:py-2 file:px-4
                                 file:rounded-full file:border-0
                                 file:text-sm file:font-semibold
                                 file:bg-indigo-50 file:text-indigo-700
                                 hover:file:bg-indigo-100"
                                 accept="image/*">
                 </div>

                 <div>
                      <label class="block text-sm font-semibold text-gray-700">Assign Assets to Student</label>
                      <div id="student-asset-assignment-container" class="mt-2 space-y-3 p-3 border border-gray-200 rounded-lg bg-gray-50">
                      </div>
                      <button type="button" id="add-student-asset-row-btn" class="mt-3 text-sm font-medium text-indigo-600 hover:text-indigo-800 flex items-center">
                          <hero-icon-solid name="plus-circle" class="h-5 w-5 mr-1"></hero-icon-solid>
                          Add Asset Row
                      </button>
                 </div>

                 <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                      <button type="button" class="flex items-center px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium" data-modal-hide="add-student-modal">
                          <hero-icon-solid name="x-mark" class="h-5 w-5 mr-1"></hero-icon-solid>
                          Cancel
                      </button>
                      <button type="submit" class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                          <hero-icon-solid name="user-plus" class="h-5 w-5 mr-1"></hero-icon-solid>
                          Add Student
                      </button>
                 </div>
            </form>
        </div>
    </div>
    
    <div id="add-event-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-event-modal"></div>
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl z-40 w-full max-w-md mx-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <hero-icon-outline name="calendar-days" class="h-6 w-6 text-indigo-500 mr-2"></hero-icon-outline>
                Add Event or Announcement
            </h2>
            <form id="add-event-form" class="space-y-4">
                 <div>
                    <label for="event-title" class="block text-sm font-semibold text-gray-700">Title</label>
                    <input type="text" id="event-title" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                </div>
                 <div>
                    <label for="event-type" class="block text-sm font-semibold text-gray-700">Type</label>
                    <select id="event-type" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="Sports">Sports</option>
                        <option value="Club Activity">Club Activity</option>
                        <option value="Announcement">Announcement</option>
                        <option value="General">General</option>
                    </select>
                </div>
                <div>
                    <label for="event-date" class="block text-sm font-semibold text-gray-700">Date</label>
                    <input type="date" id="event-date" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                </div>
                <div>
                    <label for="event-description" class="block text-sm font-semibold text-gray-700">Description</label>
                    <textarea id="event-description" rows="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <button type="button" class="flex items-center px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium" data-modal-hide="add-event-modal">
                        <hero-icon-solid name="x-mark" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Cancel
                    </button>
                    <button type="submit" class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                        <hero-icon-solid name="paper-airplane" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Post Event
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="room-details-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="room-details-modal"></div>
        <div class="modal-content bg-gray-50 rounded-xl shadow-2xl z-40 w-full max-w-3xl mx-4 max-h-[90vh] flex flex-col">
             <div class="flex justify-between items-center p-6 border-b bg-white rounded-t-xl">
                 <div class="flex items-center gap-3">
                     <h2 class="text-xl font-bold text-gray-800" id="modal-room-title">Room Details: A-101</h2>
                     <span id="modal-room-complaints-badge" class="hidden items-center text-xs font-bold px-3 py-1 bg-red-100 text-red-600 rounded-full">
                           <hero-icon-solid name="exclamation-circle" class="h-4 w-4 mr-1"></hero-icon-solid>
                           <span id="modal-room-complaints-count">1</span> Complaint
                     </span>
                 </div>
                 <button data-modal-hide="room-details-modal" class="text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition duration-150">
                     <hero-icon-solid name="x-mark" class="h-6 w-6"></hero-icon-solid>
                 </button>
             </div>
             <div class="p-6 overflow-y-auto space-y-6">
                 <div class="bg-white p-4 rounded-lg shadow-md border-t-4 border-indigo-500">
                     <div class="grid grid-cols-3 gap-4 text-center">
                         <div class="border-r border-gray-200">
                             <span class="text-sm text-gray-500 font-semibold uppercase tracking-wider">Capacity</span>
                             <p class="text-2xl font-bold text-gray-800 mt-1" id="modal-room-capacity">2</p>
                         </div>
                         <div class="border-r border-gray-200">
                             <span class="text-sm text-gray-500 font-semibold uppercase tracking-wider">Occupancy</span>
                             <p class="text-2xl font-bold text-blue-600 mt-1" id="modal-room-occupancy">2</p>
                         </div>
                         <div>
                             <span class="text-sm text-gray-500 font-semibold uppercase tracking-wider">Available Beds</span>
                             <p class="text-2xl font-bold text-green-600 mt-1" id="modal-room-available">0</p>
                         </div>
                     </div>
                 </div>
                 <div>
                     <div class="flex justify-between items-center mb-4">
                         <h3 class="text-lg font-semibold text-gray-900" id="modal-occupant-title">Current Occupants (2)</h3>
                         <button id="modal-delete-room-btn" class="flex items-center px-4 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-150">
                             <hero-icon-solid name="trash" class="h-5 w-5 mr-2"></hero-icon-solid>
                             Delete Room
                         </button>
                     </div>
                     <div id="modal-occupant-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                 </div>
                 <div>
                     <div class="flex items-center gap-2 mb-4">
                         <hero-icon-solid name="exclamation-triangle" class="h-5 w-5 text-red-600"></hero-icon-solid>
                         <h3 class="text-lg font-semibold text-gray-900">Open Issues In This Room</h3>
                     </div>
                     <div id="modal-issues-container" class="space-y-3"></div>
                 </div>
             </div>
             <div class="p-4 bg-white border-t rounded-b-xl text-right">
                 <a href="#" id="modal-view-all-complaints" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline transition duration-150">
                     View All Complaint Tickets &rarr;
                 </a>
             </div>
        </div>
    </div>
    
    <div id="add-club-activity-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-club-activity-modal"></div>
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl z-40 w-full max-w-md mx-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <hero-icon-outline name="puzzle-piece" class="h-6 w-6 text-indigo-500 mr-2"></hero-icon-outline>
                Add New Club Activity
            </h2>
            <form id="add-club-activity-form" class="space-y-4">
                <div>
                    <label for="club-activity-title" class="block text-sm font-semibold text-gray-700">Activity Title</label>
                    <input type="text" id="club-activity-title" name="title" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., Inter-Hostel Cricket Finals" required>
                </div>
                 <div>
                    <label for="club-activity-type" class="block text-sm font-semibold text-gray-700">Activity Type</label>
                    <select id="club-activity-type" name="type" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="Sports">Sports</option>
                        <option value="Cultural">Cultural</option>
                        <option value="Technical">Technical</option>
                        <option value="Workshop">Workshop</option>
                        <option value="General">General</option>
                    </select>
                </div>
                <div>
                    <label for="club-activity-date" class="block text-sm font-semibold text-gray-700">Date</label>
                    <input type="date" id="club-activity-date" name="date" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                </div>
                <div>
                    <label for="club-activity-description" class="block text-sm font-semibold text-gray-700">Description</label>
                    <textarea id="club-activity-description" name="description" rows="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Add relevant details..."></textarea>
                </div>
                <div>
                    <label for="club-activity-image-file" class="block text-sm font-semibold text-gray-700">Upload Image</label>
                    <input type="file" id="club-activity-image-file" name="clubActivityImage" class="mt-1 block w-full text-sm text-gray-500
                                 file:mr-4 file:py-2 file:px-4
                                 file:rounded-full file:border-0
                                 file:text-sm file:font-semibold
                                 file:bg-indigo-50 file:text-indigo-700
                                 hover:file:bg-indigo-100"
                                 accept="image/*">
                    <p class="mt-1 text-xs text-gray-500">Upload an image from your device (PNG, JPG, etc.).</p>
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <button type="button" class="flex items-center px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium" data-modal-hide="add-club-activity-modal">
                        <hero-icon-solid name="x-mark" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Cancel
                    </button>
                    <button type="submit" class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                        <hero-icon-solid name="paper-airplane" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Post Activity
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="add-asset-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="add-asset-modal"></div>
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl z-40 w-full max-w-md mx-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <hero-icon-outline name="archive-box" class="h-6 w-6 text-indigo-500 mr-2"></hero-icon-outline>
                Add New Asset to Inventory
            </h2>
            <form id="add-asset-form" class="space-y-4">
                <div>
                    <label for="asset-type" class="block text-sm font-semibold text-gray-700">Asset Type</label>
                    <select id="asset-type" name="type" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="Table">Table</option>
                        <option value="Chair">Chair</option>
                        <option value="Bed">Bed</option>
                        <option value="Mattress">Mattress</option>
                        <option value="Cupboard">Cupboard</option>
                        <option value="Fan">Fan</option>
                        <option value="Light">Light</option>
                        <option value="System">System (PC)</option>
                        <option value="Other">Other (Specify)</option>
                    </select>
                </div>
                <div id="asset-name-other-wrapper" class="hidden">
                    <label for="asset-name-other" class="block text-sm font-semibold text-gray-700">Specify Asset Name</label>
                    <input type="text" id="asset-name-other" name="name" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., Study Lamp">
                </div>
                <div>
                    <label for="asset-quantity" class="block text-sm font-semibold text-gray-700">Quantity</label>
                    <input type="number" id="asset-quantity" name="quantity" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" min="1" value="1" required>
                </div>
                         <div>
                    <label for="asset-description" class="block text-sm font-semibold text-gray-700">Description / Notes</label>
                    <textarea id="asset-description" name="description" rows="2" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., Location, condition..."></textarea>
                </div>
                <div>
                    <label for="asset-image-file" class="block text-sm font-semibold text-gray-700">Upload Asset Image</label>
                    <input type="file" id="asset-image-file" name="assetImage" class="mt-1 block w-full text-sm text-gray-500
                                 file:mr-4 file:py-2 file:px-4
                                 file:rounded-full file:border-0
                                 file:text-sm file:font-semibold
                                 file:bg-indigo-50 file:text-indigo-700
                                 hover:file:bg-indigo-100"
                                 accept="image/*">
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <button type="button" class="flex items-center px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium" data-modal-hide="add-asset-modal">
                        <hero-icon-solid name="x-mark" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Cancel
                    </button>
                    <button type="submit" class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                        <hero-icon-solid name="check-badge" class="h-5 w-5 mr-1"></hero-icon-solid>
                        Save Asset
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="complaint-details-modal" class="modal hidden fixed inset-0 z-30 flex items-center justify-center">
        <div class="modal-backdrop fixed inset-0" data-modal-hide="complaint-details-modal"></div>
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl z-40 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <hero-icon-outline name="clipboard-document-check" class="h-6 w-6 text-indigo-500 mr-2"></hero-icon-outline>
                Complaint Details
            </h2>
            <div id="complaint-details-content" class="space-y-4">
            </div>
            <div class="flex justify-end space-x-3 pt-4 mt-6 border-t border-gray-100">
                <button type="button" class="flex items-center px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium" data-modal-hide="complaint-details-modal">
                    <hero-icon-solid name="x-mark" class="h-5 w-5 mr-1"></hero-icon-solid>
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- 1. GLOBAL STATE (FIXED: Using localStorage for persistence & Mock Data for initial load) ---
        const MOCK_DATA = {
            blocks: [{
                _id: 'b1', blockName: 'Sarojini Hall', blockKey: 'sarojini', blockTheme: 'pink',
                rooms: [
                    { _id: 'r101', roomNumber: 'A-101', floor: '1st Floor', capacity: 2, students: [
                        { _id: 's1', name: 'Priya Sharma', rollNumber: '21CS10001', year: '3rd Year', email: 'priya@iit.edu', phone: '9876543210', feeStatus: 'Paid', joiningDate: '2023-08-01', assets: [{name: 'Table', quantity: 1}], profileImageUrl: 'https://i.pravatar.cc/150?img=1' },
                        { _id: 's2', name: 'Alia Khan', rollNumber: '22EE20002', year: '2nd Year', email: 'alia@iit.edu', phone: '9123456789', feeStatus: 'Pending', joiningDate: '2024-08-01', assets: [{name: 'Chair', quantity: 1}], profileImageUrl: 'https://i.pravatar.cc/150?img=2' },
                    ], imageUrl: 'https://picsum.photos/300/150?random=1' },
                    { _id: 'r102', roomNumber: 'A-102', floor: '1st Floor', capacity: 3, students: [], imageUrl: 'https://picsum.photos/300/150?random=2' },
                ]
            }, {
                _id: 'b2', blockName: 'Vivekananda Hall', blockKey: 'vivekananda', blockTheme: 'blue',
                rooms: [
                    { _id: 'r201', roomNumber: 'B-201', floor: '2nd Floor', capacity: 2, students: [
                        { _id: 's3', name: 'Rohan Verma', rollNumber: '20ME30003', year: '4th Year', email: 'rohan@iit.edu', phone: '9998887770', feeStatus: 'Paid', joiningDate: '2022-08-01', assets: [{name: 'Bed', quantity: 1}], profileImageUrl: 'https://i.pravatar.cc/150?img=3' },
                        { _id: 's4', name: 'Vikram Singh', rollNumber: '23CS40004', year: '1st Year', email: 'vikram@iit.edu', phone: '9000111222', feeStatus: 'Pending', joiningDate: '2024-11-01', assets: [{name: 'Mattress', quantity: 1}], profileImageUrl: 'https://i.pravatar.cc/150?img=4' },
                    ], imageUrl: 'https://picsum.photos/300/150?random=3' },
                    { _id: 'r202', roomNumber: 'B-202', floor: '2nd Floor', capacity: 1, students: [], imageUrl: 'https://picsum.photos/300/150?random=4' },
                ]
            }],
            assets: [
                { _id: 'a1', type: 'Table', name: 'Study Table', quantity: 10, description: 'Standard wooden study table.', imageUrl: 'https://picsum.photos/300/150?random=5' },
                { _id: 'a2', type: 'Chair', name: 'Ergonomic Chair', quantity: 5, description: 'Adjustable office-style chair.', imageUrl: 'https://picsum.photos/300/150?random=6' },
                { _id: 'a3', type: 'Bed', name: 'Single Bed Frame', quantity: 8, description: 'Metal single bed frame.', imageUrl: 'https://picsum.photos/300/150?random=7' },
                { _id: 'a4', type: 'Light', name: 'LED Tube Light', quantity: 20, description: 'Ceiling mounted LED light.', imageUrl: 'https://picsum.photos/300/150?random=8' },
            ],
            complaints: [
                { _id: 'c1', studentId: 's2', studentName: 'Alia Khan', roomNumber: 'A-101', complaintType: 'Plumbing', description: 'Leaking tap in the bathroom sink, wasting water.', status: 'Pending', createdAt: '2025-11-12T10:00:00Z', responses: [] },
                { _id: 'c2', studentId: 's4', studentName: 'Vikram Singh', roomNumber: 'B-201', complaintType: 'Electrical', description: 'The table fan is sparking when turned on. Potentially dangerous.', status: 'In Progress', createdAt: '2025-11-11T14:30:00Z', responses: [{response: 'Acknowledged and assigned to electrician.', respondedAt: '2025-11-11T15:00:00Z', respondedBy: 'Admin'}] },
                { _id: 'c3', studentId: 's3', studentName: 'Rohan Verma', roomNumber: 'B-201', complaintType: 'Cleaning', description: 'Stairwell on the 2nd floor has not been mopped in three days.', status: 'Resolved', createdAt: '2025-11-10T09:00:00Z', resolvedAt: '2025-11-10T12:00:00Z', adminNotes: 'Cleaning staff dispatched. Area cleaned.', responses: [] }
            ],
            activities: [
                { _id: 'act1', title: 'Code-a-thon 2025', type: 'Technical', date: '2025-11-30', description: '24-hour coding challenge for all students.', imageUrl: 'https://picsum.photos/300/150?random=9' },
                { _id: 'act2', title: 'Cultural Night Auditions', type: 'Cultural', date: '2025-11-20', description: 'Auditions for the annual cultural performance.', imageUrl: 'https://picsum.photos/300/150?random=10' },
            ],
        };

        const loadState = (key, defaultData) => {
            const data = localStorage.getItem(key);
            if (data) {
                try {
                    return JSON.parse(data);
                } catch (e) {
                    console.error(`Error parsing localStorage key ${key}:`, e);
                    return defaultData;
                }
            }
            return defaultData;
        };

        const saveState = (key, data) => {
            localStorage.setItem(key, JSON.stringify(data));
        };

        // Initialize App State from Local Storage or Mock Data
        let appState = { 
            blocks: loadState('appState.blocks', MOCK_DATA.blocks), 
            assets: loadState('appState.assets', MOCK_DATA.assets),
            complaints: loadState('appState.complaints', MOCK_DATA.complaints)
        }; 

        // Non-persisted data
        let eventData = MOCK_DATA.events || [
            { id: 1, title: 'Inter-Hostel Cricket Match', type: 'Sports', date: '2025-11-10', description: 'Finals between Men\'s Hostel and Women\'s Hostel.' },
            { id: 2, title: 'Mess Committee Meeting', type: 'Announcement', date: '2025-11-05', description: 'Discussing the new menu for next month.' }
        ];
        let visitorLogData = MOCK_DATA.visitorLogs || [
             { id: 1, visitorName: 'Ramesh Kumar', studentName: 'Priya Sharma', roomNumber: 'A-101', date: new Date().toISOString().split('T')[0], timeIn: '09:00 AM', timeOut: '10:30 AM' },
             { id: 2, visitorName: 'Sita Devi', studentName: 'Rohan Verma', roomNumber: 'B-201', date: '2025-11-05', timeIn: '10:00 AM', timeOut: '11:00 AM' },
             { id: 3, visitorName: 'Arjun Singh', studentName: 'Vikram Singh', roomNumber: 'B-201', date: '2025-11-04', timeIn: '04:00 PM', timeOut: '05:00 PM' }
        ];
        let clubActivityData = loadState('clubActivityData', MOCK_DATA.activities);

        let currentRoomData = null; 

        // --- 2. DOM Elements (IDs remain the same) ---
        // ... (All DOM elements remain the same) ...
        const dashboardView = document.getElementById('dashboard-view');
        const detailView = document.getElementById('detail-view');
        const feesView = document.getElementById('fees-view');
        const showFeesViewBtn = document.getElementById('show-fees-view-btn');
        const backToDashboardFromFeesBtn = document.getElementById('back-to-dashboard-from-fees-btn');
        const feesStudentListContainer = document.getElementById('fees-student-list-container');
        const feesSearchInput = document.getElementById('fees-search-input');
        const feesFilterSelect = document.getElementById('fees-filter-select');
        const statFeesPending = document.getElementById('stat-fees-pending');

        const visitorsView = document.getElementById('visitors-view');
        const showVisitorsViewBtn = document.getElementById('show-visitors-view-btn');
        const backToDashboardFromVisitorsBtn = document.getElementById('back-to-dashboard-from-visitors-btn');
        const visitorLogContainer = document.getElementById('visitor-log-container');
        const visitorSearchInput = document.getElementById('visitor-search-input');
        const visitorDateFilter = document.getElementById('visitor-date-filter');
        const statVisitorsToday = document.getElementById('stat-visitors-today');
        
        const complaintsView = document.getElementById('complaints-view');
        const showComplaintsViewBtn = document.getElementById('show-complaints-view-btn');
        const backToDashboardFromComplaintsBtn = document.getElementById('back-to-dashboard-from-complaints-btn');
        const complaintsListContainer = document.getElementById('complaints-list-container');
        const complaintSearchInput = document.getElementById('complaint-search-input');
        const complaintStatusFilter = document.getElementById('complaint-status-filter');
        const complaintTypeFilter = document.getElementById('complaint-type-filter');
        const refreshComplaintsBtn = document.getElementById('refresh-complaints-btn');
        const statOpenComplaints = document.getElementById('stat-open-complaints');
        const complaintDetailsModal = document.getElementById('complaint-details-modal');
        const complaintDetailsContent = document.getElementById('complaint-details-content');
        
        const hostelBlockContainer = document.getElementById('hostel-block-container');
        const statTotalCapacity = document.getElementById('stat-total-capacity');
        const statOccupancyPercent = document.getElementById('stat-occupancy-percent');
        const statOccupancyLabel = document.getElementById('stat-occupancy-label');
        const statOccupancyRing = document.getElementById('stat-occupancy-ring');
        const eventListContainer = document.getElementById('event-list-container');
        const detailHostelName = document.getElementById('detail-hostel-name');
        const backToDashboardBtn = document.getElementById('back-to-dashboard-btn');
        const roomListContainer = document.getElementById('room-list-container');
        const detailStatCapacity = document.getElementById('detail-stat-capacity');
        const detailStatOccupancy = document.getElementById('detail-stat-occupancy');
        const detailStatAvailable = document.getElementById('detail-stat-available');
        const roomSearchInput = document.getElementById('room-search-input');
        const roomFilterSelect = document.getElementById('room-filter-select');
        const showAddBlockModalBtn = document.getElementById('show-add-block-modal-btn');
        const addBlockForm = document.getElementById('add-block-form');
        const showAddRoomModalBtn = document.getElementById('show-add-room-modal-btn');
        const addRoomForm = document.getElementById('add-room-form');
        const showAddStudentModalBtn = document.getElementById('show-add-student-modal-btn');
        const addStudentForm = document.getElementById('add-student-form');
        const studentRoomSelect = document.getElementById('student-room-id');
        const showAddEventModalBtn = document.getElementById('show-add-event-modal-btn');
        const addEventForm = document.getElementById('add-event-form');
        const adminLogoutBtn = document.getElementById('admin-logout-btn'); 

        const roomDetailsModal = document.getElementById('room-details-modal');
        const modalRoomTitle = document.getElementById('modal-room-title');
        const modalRoomComplaintsBadge = document.getElementById('modal-room-complaints-badge');
        const modalRoomComplaintsCount = document.getElementById('modal-room-complaints-count');
        const modalRoomCapacity = document.getElementById('modal-room-capacity');
        const modalRoomOccupancy = document.getElementById('modal-room-occupancy');
        const modalRoomAvailable = document.getElementById('modal-room-available');
        const modalOccupantTitle = document.getElementById('modal-occupant-title');
        const modalOccupantContainer = document.getElementById('modal-occupant-container');
        const modalIssuesContainer = document.getElementById('modal-issues-container');
        const modalDeleteRoomBtn = document.getElementById('modal-delete-room-btn'); 

        const clubActivityContainer = document.getElementById('club-activity-container');
        const showAddClubActivityModalBtn = document.getElementById('show-add-club-activity-modal-btn');
        const addClubActivityForm = document.getElementById('add-club-activity-form');
        
        const assetInventoryContainer = document.getElementById('asset-inventory-container');
        const showAddAssetModalBtn = document.getElementById('show-add-asset-modal-btn');
        const addAssetForm = document.getElementById('add-asset-form');
        const assetTypeSelect = document.getElementById('asset-type');
        const assetNameOtherWrapper = document.getElementById('asset-name-other-wrapper');
        
        const addRoomAssetRowBtn = document.getElementById('add-room-asset-row-btn');
        const roomAssetAssignmentContainer = document.getElementById('room-asset-assignment-container');
        const addStudentAssetRowBtn = document.getElementById('add-student-asset-row-btn');
        const studentAssetAssignmentContainer = document.getElementById('student-asset-assignment-container');


        // --- 3. THEME/HELPER DATA ---
        const themes = { 
            pink: { border: 'border-pink-500', bg: 'bg-pink-100', text: 'text-pink-600', icon: 'building-office' },
            blue: { border: 'border-indigo-500', bg: 'bg-indigo-100', text: 'text-indigo-600', icon: 'building-office' },
            green: { border: 'border-green-500', bg: 'bg-green-100', text: 'text-green-600', icon: 'building-office' },
            purple: { border: 'border-purple-500', bg: 'bg-purple-100', text: 'text-purple-600', icon: 'academic-cap' },
            yellow: { border: 'border-yellow-500', bg: 'bg-yellow-100', text: 'text-yellow-600', icon: 'beaker' },
        };
        const eventThemes = { 
            'Sports': { border: 'border-green-500', bg: 'bg-green-100', text: 'text-green-700' },
            'Club Activity': { border: 'border-purple-500', bg: 'bg-purple-100', text: 'text-purple-700' },
            'Announcement': { border: 'border-red-500', bg: 'bg-red-100', text: 'text-red-700' },
            'General': { border: 'border-indigo-500', bg: 'bg-indigo-100', text: 'text-indigo-700' },
        };
        const clubActivityThemes = { 
            'Sports': { border: 'border-orange-500', bg: 'bg-orange-100', text: 'text-orange-700' },
            'Cultural': { border: 'border-pink-500', bg: 'bg-pink-100', text: 'text-pink-700' },
            'Technical': { border: 'border-indigo-500', bg: 'bg-indigo-100', text: 'text-indigo-700' },
            'Workshop': { border: 'border-yellow-500', bg: 'bg-yellow-100', text: 'text-yellow-700' },
            'General': { border: 'border-gray-500', bg: 'bg-gray-100', text: 'text-gray-700' },
        };
        const getStatus = (current, max) => { 
            if (current >= max) return { text: 'Full', classes: 'bg-red-500 text-white', progress: 'bg-red-500' };
            return { text: 'Available', classes: 'bg-green-500 text-white', progress: 'bg-green-500' };
        };
        
        function findStudentById(studentId) {
            for (const block of appState.blocks) {
                for (const room of block.rooms) {
                    const student = (room.students || []).find(s => s._id === studentId);
                    if (student) return student;
                }
            }
            return null;
        }

        // --- 4. Mock API & Data Handling ---

        // Helper to find a room
        function findRoom(blockKey, roomId) {
            const block = appState.blocks.find(b => b.blockKey === blockKey);
            if (!block) return [null, null, -1];
            const roomIndex = block.rooms.findIndex(r => r._id === roomId);
            const room = roomIndex !== -1 ? block.rooms[roomIndex] : null;
            return [block, room, roomIndex];
        }

        // Helper to find a block by ID
        function findBlockById(blockId) {
            const blockIndex = appState.blocks.findIndex(b => b._id === blockId);
            const block = blockIndex !== -1 ? appState.blocks[blockIndex] : null;
            return [block, blockIndex];
        }

        // Helper to find a student and their location
        function findStudentLocation(studentId) {
            for (const [blockIndex, block] of appState.blocks.entries()) {
                for (const [roomIndex, room] of (block.rooms || []).entries()) {
                    const studentIndex = (room.students || []).findIndex(s => s._id === studentId);
                    if (studentIndex !== -1) {
                        return { blockIndex, roomIndex, studentIndex, block, room, student: room.students[studentIndex] };
                    }
                }
            }
            return null;
        }

        // Helper to update asset quantities
        function updateAssetQuantity(assetName, delta) {
            const asset = appState.assets.find(a => a.name === assetName);
            if (asset) {
                asset.quantity += delta;
                saveState('appState.assets', appState.assets);
            }
        }

        // --- MOCK API CALLS ---

        async function loadHostelData() {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 100));
            // Data is loaded from appState which is persisted/mocked
            saveState('appState.blocks', appState.blocks);

            if (!dashboardView.classList.contains('hidden')) { renderDashboard(); }
            if (!detailView.classList.contains('hidden')) {
                const currentBlockKey = detailView.dataset.currentHostelKey;
                if (currentBlockKey) { renderDetailView(currentBlockKey); }
            }
            return { success: true, blocks: appState.blocks };
        }

        async function loadAssetData() {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 100));
            // Data is loaded from appState which is persisted/mocked
            saveState('appState.assets', appState.assets);
            renderAssets(appState.assets);
            return { success: true, assets: appState.assets };
        }

        async function loadClubActivities() {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 100));
            // Data is loaded from persistence/mocked
            saveState('clubActivityData', clubActivityData);
            renderClubActivities(clubActivityData);
            return { success: true, activities: clubActivityData };
        }

        async function loadComplaintsData() {
             // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 100));
            // Data is loaded from appState which is persisted/mocked
            saveState('appState.complaints', appState.complaints);
            updateComplaintsCount();
            if (!complaintsView.classList.contains('hidden')) { renderComplaintsView(); }
            return { success: true, complaints: appState.complaints };
        }

        async function updateComplaintStatus(complaintId, newStatus, adminNotes = '') {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const complaintIndex = appState.complaints.findIndex(c => c._id === complaintId);
            if (complaintIndex !== -1) { 
                appState.complaints[complaintIndex].status = newStatus; 
                if (newStatus === 'Resolved') appState.complaints[complaintIndex].resolvedAt = new Date().toISOString();
                if (adminNotes) appState.complaints[complaintIndex].adminNotes = adminNotes;

                saveState('appState.complaints', appState.complaints);

                updateComplaintsCount();
                renderComplaintsView();
                showSuccess(`Complaint status updated to ${newStatus}`);
                return true;
            } else { 
                showError('Complaint not found.'); 
                return false; 
            }
        }

        async function addComplaintResponse(complaintId, response) {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const complaintIndex = appState.complaints.findIndex(c => c._id === complaintId);
            if (complaintIndex !== -1) {
                if (!appState.complaints[complaintIndex].responses) appState.complaints[complaintIndex].responses = [];
                appState.complaints[complaintIndex].responses.push({ response: response, respondedAt: new Date().toISOString(), respondedBy: 'Admin' });

                saveState('appState.complaints', appState.complaints);

                renderComplaintsView();
                showSuccess('Response added successfully');
                return true;
            } else {
                showError('Complaint not found.');
                return false;
            }
        }

        // --- END MOCK API CALLS ---

        function updateComplaintsCount() {
            const openComplaints = appState.complaints.filter(complaint => 
                complaint.status === 'Pending' || complaint.status === 'In Progress'
            ).length;
            statOpenComplaints.textContent = openComplaints;
        }

        function renderComplaintsView() {
            const statusFilter = complaintStatusFilter.value;
            const typeFilter = complaintTypeFilter.value;
            const searchTerm = complaintSearchInput.value.toLowerCase();
            
            complaintsListContainer.innerHTML = '';
            
            const filteredComplaints = appState.complaints.filter(complaint => {
                const statusMatch = (statusFilter === 'All') || (complaint.status === statusFilter);
                const typeMatch = (typeFilter === 'All') || (complaint.complaintType === typeFilter);
                const searchMatch = (complaint.studentName.toLowerCase().includes(searchTerm)) ||
                                           (complaint.roomNumber.toLowerCase().includes(searchTerm)) ||
                                           (complaint.description.toLowerCase().includes(searchTerm));
                return statusMatch && typeMatch && searchMatch;
            });

            if (filteredComplaints.length === 0) {
                // RENDER: Use Heroicon
                complaintsListContainer.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-gray-500 py-6">
                            <hero-icon-outline name="document-text" class="h-5 w-5 inline-block mr-1 text-gray-400"></hero-icon-outline> No complaints found matching the criteria.
                        </td>
                    </tr>
                `;
                return;
            }

            filteredComplaints.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            filteredComplaints.forEach(complaint => {
                const statusColors = {
                    'Pending': 'bg-yellow-100 text-yellow-800',
                    'In Progress': 'bg-blue-100 text-blue-800', 
                    'Resolved': 'bg-green-100 text-green-800'
                };
                
                const statusColor = statusColors[complaint.status] || 'bg-gray-100 text-gray-800';
                const formattedDate = new Date(complaint.createdAt).toLocaleDateString('en-US', {
                    year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                });

                // MAPPING: Use Heroicons and professional names for consistent rendering
                const complaintIcons = {
                    'Maintenance': 'wrench-screwdriver',
                    'Cleaning': 'trash',
                    'Electrical': 'light-bulb',
                    'Plumbing': 'water-symbol',
                    'Internet': 'wifi',
                    'Security': 'lock-closed',
                    'Other': 'document-text'
                };
                const iconName = complaintIcons[complaint.complaintType] || 'document-text';

                const rowHTML = `
                    <tr class="hover:bg-gray-50 complaint-row" data-complaint-id="${complaint._id}">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="ml-4">
                                    <div class="text-sm font-semibold text-gray-900">${complaint.studentName}</div>
                                    <div class="text-xs text-gray-500">${complaint.studentId || ''}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-indigo-600 font-medium">
                            ${complaint.roomNumber}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            <div class="flex items-center">
                                <hero-icon-solid name="${iconName}" class="h-5 w-5 mr-2 text-gray-500"></hero-icon-solid>
                                ${complaint.complaintType}
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-700 max-w-xs">
                            <div class="truncate complaint-description" title="${complaint.description}">
                                ${complaint.description}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${formattedDate}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                                ${complaint.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2">
                            <button class="view-complaint-details-btn px-3 py-1 bg-indigo-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-indigo-600" data-complaint-id="${complaint._id}">
                                <hero-icon-outline name="eye" class="h-4 w-4 inline-block"></hero-icon-outline> View
                            </button>
                            ${complaint.status !== 'Resolved' ? `
                                <button class="update-complaint-status-btn px-3 py-1 bg-green-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-green-600" data-complaint-id="${complaint._id}" data-new-status="Resolved">
                                    <hero-icon-outline name="check-circle" class="h-4 w-4 inline-block"></hero-icon-outline> Resolve
                                </button>
                            ` : ''}
                            ${complaint.status === 'Pending' ? `
                                <button class="update-complaint-status-btn px-3 py-1 bg-blue-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-blue-600" data-complaint-id="${complaint._id}" data-new-status="In Progress">
                                    <hero-icon-outline name="wrench-screwdriver" class="h-4 w-4 inline-block"></hero-icon-outline> Start Progress
                                </button>
                            ` : ''}
                            ${complaint.status === 'In Progress' ? `
                                <button class="update-complaint-status-btn px-3 py-1 bg-yellow-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-yellow-600" data-complaint-id="${complaint._id}" data-new-status="Pending">
                                    <hero-icon-outline name="clock" class="h-4 w-4 inline-block"></hero-icon-outline> Mark Pending
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
                complaintsListContainer.innerHTML += rowHTML;
            });
        }

        function showComplaintDetails(complaintId) {
            const complaint = appState.complaints.find(c => c._id === complaintId);
            if (!complaint) { showError('Complaint not found'); return; }

            const formattedDate = new Date(complaint.createdAt).toLocaleDateString('en-US', {
                year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
            });

            const resolvedDate = complaint.resolvedAt ? new Date(complaint.resolvedAt).toLocaleDateString('en-US', {
                year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
            }) : 'Not resolved yet';

            const complaintIcons = {
                'Maintenance': 'wrench-screwdriver', 'Cleaning': 'trash', 'Electrical': 'light-bulb',
                'Plumbing': 'water-symbol', 'Internet': 'wifi', 'Security': 'lock-closed', 'Other': 'document-text'
            };
            const iconName = complaintIcons[complaint.complaintType] || 'document-text';

            let responsesHTML = '';
            if (complaint.responses && complaint.responses.length > 0) {
                responsesHTML = `
                    <div class="mt-4">
                        <h4 class="font-bold text-gray-800 mb-2 border-b pb-1">Admin Responses:</h4>
                        ${complaint.responses.map(response => `
                            <div class="bg-indigo-50 p-3 rounded-lg mb-2 shadow-sm">
                                <p class="text-sm text-gray-700">${response.response}</p>
                                <p class="text-xs text-gray-500 mt-1 flex items-center">
                                    <hero-icon-outline name="user-circle" class="h-4 w-4 mr-1"></hero-icon-outline> By ${response.respondedBy} on ${new Date(response.respondedAt).toLocaleDateString()}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // RENDER: Updated detail content with icons and better spacing
            complaintDetailsContent.innerHTML = `
                 <div class="space-y-4">
                     <div class="grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
                         <div>
                             <label class="block text-xs font-bold text-gray-500 uppercase">Student Name</label>
                             <p class="mt-1 text-sm font-semibold text-gray-900">${complaint.studentName}</p>
                         </div>
                         <div>
                             <label class="block text-xs font-bold text-gray-500 uppercase">Room Number</label>
                             <p class="mt-1 text-sm font-semibold text-gray-900">${complaint.roomNumber}</p>
                         </div>
                     </div>
                     
                     <div class="grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
                         <div>
                             <label class="block text-xs font-bold text-gray-500 uppercase">Complaint Type</label>
                             <p class="mt-1 text-sm font-semibold text-gray-900 flex items-center">
                                 <hero-icon-solid name="${iconName}" class="h-5 w-5 text-indigo-500 mr-2"></hero-icon-solid>
                                 ${complaint.complaintType}
                             </p>
                         </div>
                         <div>
                             <label class="block text-xs font-bold text-gray-500 uppercase">Status</label>
                             <p class="mt-1 text-sm text-gray-900">
                                 <span class="px-3 py-1 text-xs font-semibold rounded-full ${
                                     complaint.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' :
                                     complaint.status === 'In Progress' ? 'bg-blue-100 text-blue-800' :
                                     'bg-green-100 text-green-800'
                                 }">
                                     ${complaint.status}
                                 </span>
                             </p>
                         </div>
                     </div>
                     
                     <div>
                         <label class="block text-xs font-bold text-gray-500 uppercase">Description</label>
                         <p class="mt-1 text-sm text-gray-900 bg-white p-4 rounded-lg shadow-inner border border-gray-200">${complaint.description}</p>
                     </div>
                     
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-xs font-bold text-gray-500 uppercase">Submitted On</label>
                             <p class="mt-1 text-sm text-gray-900">${formattedDate}</p>
                         </div>
                         <div>
                             <label class="block text-xs font-bold text-gray-500 uppercase">Resolved On</label>
                             <p class="mt-1 text-sm text-gray-900">${resolvedDate}</p>
                         </div>
                     </div>
                     
                     ${complaint.adminNotes ? `
                         <div>
                             <label class="block text-xs font-bold text-gray-500 uppercase">Admin Notes</label>
                             <p class="mt-1 text-sm text-gray-900 bg-indigo-50 p-3 rounded-lg border border-indigo-200">${complaint.adminNotes}</p>
                         </div>
                     ` : ''}
                     
                     ${responsesHTML}
                     
                     <div class="mt-6 border-t pt-4 border-gray-100">
                         <label for="complaint-response" class="block text-sm font-semibold text-gray-700">Add New Response</label>
                         <textarea id="complaint-response" rows="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm" placeholder="Enter your response to the student..."></textarea>
                         <button id="submit-complaint-response" data-complaint-id="${complaint._id}" class="mt-3 px-4 py-2 bg-indigo-600 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 flex items-center">
                             <hero-icon-solid name="paper-airplane" class="h-5 w-5 mr-1"></hero-icon-solid>
                             Send Response
                         </button>
                     </div>
                 </div>
            `;

            showModal('complaint-details-modal');
        }

        function showSuccess(message) { console.log(' ' + message); alert(' ' + message); }
        function showError(message) { console.error(' ' + message); alert(' ' + message); }

        // --- 5. RENDER FUNCTIONS (Updated to use icons/text) ---
        function renderDashboard() {
            hostelBlockContainer.innerHTML = '';
            let grandTotalCapacity = 0;
            let grandTotalStudents = 0;
            let totalPendingFees = 0;

            if (!appState.blocks || appState.blocks.length === 0) {
                 hostelBlockContainer.innerHTML = `<p class="text-gray-500 col-span-full flex items-center"><hero-icon-solid name="building-office-2" class="h-5 w-5 mr-2 text-gray-400"></hero-icon-solid> No hostel blocks found. Add one to get started!</p>`;
            }

            for (const block of appState.blocks) {
                const theme = themes[block.blockTheme] || themes.blue;
                const totalRooms = block.rooms ? block.rooms.length : 0;
                let currentStudents = 0;
                let totalCapacity = 0;
                
                if (block.rooms) {
                    block.rooms.forEach(room => {
                        const studentsInRoom = room.students ? room.students.length : 0;
                        currentStudents += studentsInRoom;
                        totalCapacity += (room.capacity || 0);
                        
                        if (room.students) {
                            room.students.forEach(student => {
                                if (student.feeStatus === 'Pending') {
                                    totalPendingFees++;
                                }
                            });
                        }
                    });
                }
                
                const occupiedRooms = block.rooms ? block.rooms.filter(room => room.students && room.students.length > 0).length : 0;
                
                grandTotalCapacity += totalCapacity;
                grandTotalStudents += currentStudents;

                const blockHTML = `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border-l-8 ${theme.border} relative transition-all duration-300 hover:shadow-xl hover:scale-[1.02]">
                        <button class="remove-block-btn absolute top-3 right-3 p-1 text-red-500 hover:bg-red-100 rounded-full transition-colors duration-200 z-10" data-block-id="${block._id}" data-block-name="${block.blockName}" title="Delete Block">
                            <hero-icon-outline name="trash" class="h-5 w-5"></hero-icon-outline>
                        </button>
                        <a href="#" class="block-link block hover:bg-gray-50 p-6" data-hostel-key="${block.blockKey}">
                            <div class="flex items-center mb-4">
                                <div class="p-3 ${theme.bg} rounded-xl"><hero-icon-solid name="${theme.icon}" class="h-6 w-6 ${theme.text}"></hero-icon-solid></div>
                                <h3 class="text-2xl font-bold text-gray-900 ml-4">${block.blockName}</h3>
                            </div>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
                                <div><span class="text-gray-500 font-medium">Total Rooms</span><p class="text-lg font-semibold text-gray-900">${totalRooms}</p></div>
                                <div><span class="text-gray-500 font-medium">Occupied Rooms</span><p class="text-lg font-semibold text-gray-900">${occupiedRooms}</p></div>
                                <div><span class="text-gray-500 font-medium">Current Students</span><p class="text-lg font-semibold text-gray-900">${currentStudents}</p></div>
                                <div><span class="text-gray-500 font-medium">Total Capacity</span><p class="text-lg font-semibold text-gray-900">${totalCapacity}</p></div>
                            </div>
                        </a>
                    </div>
                `;
                hostelBlockContainer.innerHTML += blockHTML;
            }
            
            statTotalCapacity.textContent = grandTotalCapacity;
            const occupancyPercent = grandTotalCapacity > 0 ? (grandTotalStudents / grandTotalCapacity * 100) : 0;
            statOccupancyPercent.textContent = occupancyPercent.toFixed(1) + '%';
            statOccupancyLabel.textContent = occupancyPercent.toFixed(0) + '%';
            statOccupancyRing.style.strokeDashoffset = 100 - occupancyPercent;
            
            statFeesPending.textContent = `${totalPendingFees} Pending`;
            const today = new Date().toISOString().split('T')[0];
            const visitorsToday = visitorLogData.filter(v => v.date === today).length;
            statVisitorsToday.textContent = `${visitorsToday} Today`;
        }

        function renderDetailView(blockKey) {
             const block = appState.blocks.find(b => b.blockKey === blockKey);
             if (!block) { alert('Error: Could not find block data.'); backToDashboardBtn.click(); return; }
             detailView.dataset.currentHostelKey = block.blockKey;
             const theme = themes[block.blockTheme] || themes.blue;
             // RENDER: Updated title 
             detailHostelName.innerHTML = `<span class="p-2 ${theme.bg} ${theme.text} rounded-lg mr-2"><hero-icon-solid name="${theme.icon}" class="h-6 w-6 inline-block"></hero-icon-solid></span> ${block.blockName}`;
             let hostelCapacity = 0, hostelOccupancy = 0;
             roomListContainer.innerHTML = '';
             studentRoomSelect.innerHTML = '<option value="" disabled selected>-- Select an available room --</option>';
             const rooms = block.rooms || [];
             rooms.sort((a, b) => a.roomNumber.localeCompare(b.roomNumber, undefined, { numeric: true, sensitivity: 'base' }));

             rooms.forEach(room => {
                 const current = room.students ? room.students.length : 0;
                 const max = room.capacity; hostelCapacity += max; hostelOccupancy += current;
                 const status = getStatus(current, max); const percent = max > 0 ? (current / max) * 100 : 0;
                 const studentNames = (room.students && room.students.length > 0) ? room.students.map(s => s.name).join(', ') : 'None';
                 const imageUrl = room.imageUrl || `https://via.placeholder.com/300x150/e0e0e0/909090?text=${room.roomNumber}`;
                 
                 // FIX: Added data-room-id to room card
                 const roomHTML = `
                      <div class="room-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:scale-[1.02] cursor-pointer" data-room-id="${room._id}" data-room-status="${status.text}">
                          <img src="${imageUrl}" alt="Room ${room.roomNumber}" class="activity-card-image">
                          <div class="p-5">
                              <div class="flex justify-between items-center mb-2">
                                   <h3 class="text-2xl font-bold text-gray-800">${room.roomNumber}</h3>
                                   <span class="text-xs font-bold px-3 py-1 rounded-full ${status.classes}">${status.text}</span>
                              </div>
                              <p class="text-sm text-gray-500 mb-4">${room.floor}</p>
                              <div class="progress-bar mb-3">
                                   <div class="progress-bar-inner ${status.progress}" style="width: ${percent}%;"></div>
                              </div>
                              <p class="text-sm text-gray-700 font-semibold mb-1">Occupancy: <span class="font-normal text-gray-900">${current}/${max}</span></p>
                              <p class="text-sm text-gray-700 font-semibold truncate">Students: <span class="font-normal text-gray-900">${studentNames}</span></p>
                          </div>
                      </div>
                    `;
                 roomListContainer.innerHTML += roomHTML;
                 if (current < max) { studentRoomSelect.innerHTML += `<option value="${room._id}">${block.blockName} ${room.roomNumber} (${current}/${max})</option>`; }
             });
             if (rooms.length === 0) { 
                 roomListContainer.innerHTML = '<p class="text-gray-500 text-center col-span-full flex items-center justify-center"><hero-icon-solid name="building-office" class="h-5 w-5 mr-2 text-gray-400"></hero-icon-solid> No rooms added to this block yet.</p>'; 
             }
             detailStatCapacity.textContent = hostelCapacity; detailStatOccupancy.textContent = hostelOccupancy; detailStatAvailable.textContent = hostelCapacity - hostelOccupancy;
             roomSearchInput.value = ''; roomFilterSelect.value = 'All';
        }
        
        function renderRoomDetailsModal(room, block) {
            if (!room) { console.error("Room data is missing."); return; }
            currentRoomData = room; 
            modalRoomTitle.textContent = `Room Details: ${room.roomNumber}`;
            modalRoomCapacity.textContent = room.capacity;
            const occupancy = room.students ? room.students.length : 0;
            const available = room.capacity - occupancy;
            modalRoomOccupancy.textContent = occupancy; modalRoomAvailable.textContent = available;
            
            // RENDER: Removed emoji
            modalOccupantTitle.textContent = `Current Occupants (${occupancy})`;
            modalOccupantContainer.innerHTML = '';

            // Get relevant complaints for this room
            const roomComplaints = appState.complaints.filter(c => c.roomNumber === room.roomNumber && c.status !== 'Resolved');
            const allRoomComplaints = appState.complaints.filter(c => c.roomNumber === room.roomNumber);
            
            if (occupancy === 0) {
                 // RENDER: Updated to use icon
                modalOccupantContainer.innerHTML = '<p class="text-gray-500 md:col-span-2 flex items-center"><hero-icon-outline name="user-slash" class="h-5 w-5 mr-1"></hero-icon-outline> This room is currently vacant.</p>';
            } else {
                room.students.forEach(student => {
                    const feeStatus = student.feeStatus || 'Pending';
                    const statusColor = feeStatus.toLowerCase() === 'paid' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                    let yearColor = 'bg-gray-100 text-gray-700'; 
                    if (student.year && student.year.toLowerCase().includes('3')) yearColor = 'bg-pink-100 text-pink-700';
                    if (student.year && student.year.toLowerCase().includes('2')) yearColor = 'bg-yellow-100 text-yellow-700';
                    if (student.year && student.year.toLowerCase().includes('1')) yearColor = 'bg-blue-100 text-blue-700'; 
                    
                    // RENDER: Updated student card icons/text
                    const studentHTML = `<div class="bg-white border rounded-lg p-4 shadow-sm relative"><button class="remove-student-btn absolute top-2 right-2 p-1 text-red-500 hover:bg-red-100 rounded-full transition-colors duration-200 z-10" data-student-id="${student._id}" title="Remove Student"><hero-icon-outline name="user-minus" class="h-5 w-5"></hero-icon-outline></button><span class="absolute top-3 left-3 text-xs font-semibold px-2 py-0.5 ${yearColor} rounded">${student.year || 'N/A'}</span><div class="flex items-center gap-4 mt-8"><img src="${student.profileImageUrl || 'https://i.pravatar.cc/150?img=60'}" alt="${student.name}" class="flex-shrink-0 h-12 w-12 rounded-full bg-indigo-100 object-cover"><div class="overflow-hidden"><h4 class="font-bold text-gray-800 truncate">${student.name}</h4><p class="text-sm text-indigo-600 truncate">${student.rollNumber || ''}</p></div></div><div class="mt-4 space-y-2 text-sm text-gray-600"><p class="truncate flex items-center"><strong><hero-icon-outline name="envelope" class="h-4 w-4 mr-1"></hero-icon-outline> Email:</strong> ${student.email || 'N/A'}</p><p class="flex items-center"><strong><hero-icon-outline name="phone" class="h-4 w-4 mr-1"></hero-icon-outline> Phone:</strong> ${student.phone || 'N/A'}</p><p class="flex items-center"><strong><hero-icon-outline name="calendar-days" class="h-4 w-4 mr-1"></hero-icon-outline> Joined:</strong> ${student.joiningDate ? new Date(student.joiningDate).toLocaleDateString() : 'N/A'}</p></div><div class="flex justify-between items-center mt-4 pt-3 border-t"><div><span class="text-xs font-medium text-gray-500 block mb-1">Fee Status:</span><span class="text-sm font-bold px-3 py-1 rounded ${statusColor}">${feeStatus === 'Pending' ? 'Due' : feeStatus}</span></div><a href="#" class="view-student-details text-sm font-medium text-indigo-600 hover:underline" data-student-id="${student._id}"><hero-icon-outline name="arrow-right" class="h-4 w-4 inline-block ml-1"></hero-icon-outline> View Full Details</a></div></div>`;
                    
                    modalOccupantContainer.innerHTML += studentHTML;
                });
            }
            modalIssuesContainer.innerHTML = '';
            const openComplaints = roomComplaints || []; 
            
            if (openComplaints.length === 0) {
                 // RENDER: Updated to use icon
                modalIssuesContainer.innerHTML = '<p class="text-gray-500 flex items-center"><hero-icon-solid name="check-circle" class="h-5 w-5 mr-1 text-green-500"></hero-icon-solid> No open issues reported for this room.</p>';
                modalRoomComplaintsBadge.classList.add('hidden');
            } else {
                openComplaints.forEach(complaint => {
                    const statusColor = complaint.status === 'Pending' ? 'bg-yellow-500 text-white' : 'bg-red-500 text-white';
                    const issueHTML = `<div class="flex justify-between items-center bg-white p-3 rounded-lg shadow-sm border"><p class="font-medium text-gray-700">${complaint.description.substring(0, 50)}...</p><span class="text-xs font-bold px-3 py-1 rounded-full ${statusColor}">${complaint.status}</span></div>`;
                    modalIssuesContainer.innerHTML += issueHTML;
                });
                modalRoomComplaintsCount.textContent = openComplaints.length;
                modalRoomComplaintsBadge.classList.remove('hidden');
                modalRoomComplaintsBadge.style.display = 'inline-flex';
            }

            const modalViewAllComplaints = document.getElementById('modal-view-all-complaints');
            modalViewAllComplaints.onclick = (e) => {
                e.preventDefault();
                hideModal('room-details-modal');
                document.getElementById('complaint-search-input').value = room.roomNumber;
                document.getElementById('complaint-status-filter').value = 'All';
                showComplaintsViewBtn.click(); 
                setTimeout(renderComplaintsView, 350); // Delay for view transition
            }
        } 

        function renderEvents() {
             eventListContainer.innerHTML = '';
            if (eventData.length === 0) {
                 // RENDER: Updated to use icon
                eventListContainer.innerHTML = `<p class="text-gray-500 col-span-full flex items-center"><hero-icon-solid name="calendar-days" class="h-5 w-5 mr-2 text-gray-400"></hero-icon-solid> No events or announcements posted yet.</p>`; return;
            }
            eventData.slice().sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(event => {
                const theme = eventThemes[event.type] || eventThemes.General;
                const formattedDate = new Date(event.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                
                const eventHTML = `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border-l-8 ${theme.border} transition-all duration-300 hover:shadow-xl hover:scale-[1.02]">
                        <div class="p-5">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-xl font-bold text-gray-900">${event.title}</h3>
                                <span class="text-xs font-bold px-3 py-1 rounded-full ${theme.bg} ${theme.text} flex-shrink-0 ml-2">${event.type}</span>
                            </div>
                            <p class="text-sm font-semibold text-gray-600 mb-3 flex items-center">
                                <hero-icon-outline name="calendar" class="h-4 w-4 mr-1"></hero-icon-outline> ${formattedDate}
                            </p>
                            <p class="text-sm text-gray-700">${event.description}</p>
                        </div>
                    </div>
                `;
                eventListContainer.innerHTML += eventHTML;
            });
        }
        
        function renderClubActivities(activities) { 
             clubActivityContainer.innerHTML = '';
            if (!activities || activities.length === 0) {
                 // RENDER: Updated to use icon
                clubActivityContainer.innerHTML = `<p class="text-gray-500 col-span-full flex items-center"><hero-icon-solid name="puzzle-piece" class="h-5 w-5 mr-2 text-gray-400"></hero-icon-solid> No club activities posted yet.</p>`;
                return;
            }
            activities.slice().sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(activity => {
                const theme = clubActivityThemes[activity.type] || clubActivityThemes.General;
                const formattedDate = new Date(activity.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const imageUrl = activity.imageUrl || `https://via.placeholder.com/300x150/${theme.bg.split('-')[1].slice(0, 2)}00/FFFFFF?text=${activity.type.replace(' ', '+')}`; 
                
                const activityHTML = `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border-l-8 ${theme.border} relative transition-all duration-300 hover:shadow-xl hover:scale-[1.02] flex flex-col">
                        <button class="remove-activity-btn absolute top-3 right-3 p-1 text-red-500 hover:bg-red-100 rounded-full transition-colors duration-200 z-10" data-activity-id="${activity._id}" data-activity-title="${activity.title}" title="Delete Activity">
                            <hero-icon-outline name="trash" class="h-5 w-5"></hero-icon-outline>
                        </button>
                        <img src="${imageUrl}" alt="${activity.title}" class="activity-card-image">
                        <div class="p-5 flex flex-col flex-grow">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-bold text-gray-900">${activity.title}</h3>
                                <span class="text-xs font-bold px-3 py-1 rounded-full ${theme.bg} ${theme.text} flex-shrink-0 ml-2">${activity.type}</span>
                            </div>
                            <p class="text-sm font-semibold text-gray-600 mb-3 flex items-center">
                                <hero-icon-outline name="calendar" class="h-4 w-4 mr-1"></hero-icon-outline> ${formattedDate}
                            </p>
                            <p class="text-sm text-gray-700 flex-grow">${activity.description || ''}</p>
                            </div>
                    </div>
                `;
                clubActivityContainer.innerHTML += activityHTML;
            });
        }
        
        function renderAssets(assets) {
            assetInventoryContainer.innerHTML = '';
            if (!assets || assets.length === 0) {
                // RENDER: Updated to use icon
                assetInventoryContainer.innerHTML = `<p class="text-gray-500 col-span-full flex items-center"><hero-icon-solid name="archive-box" class="h-5 w-5 mr-2 text-gray-400"></hero-icon-solid> No assets found in inventory.</p>`;
                return;
            }
            
            assets.forEach(asset => {
                const assetName = asset.name || asset.type;
                const imageUrl = asset.imageUrl || `https://via.placeholder.com/300x150/e0e0e0/909090?text=${assetName.replace(' ', '+')}`;
                
                // MAPPING: Use Heroicons and professional names
                const assetIcons = {
                    'Table': 'table-cells', 'Chair': 'chair', 'Bed': 'cube', 'Mattress': 'cube',
                    'Cupboard': 'archive-box', 'Fan': 'wind', 'Light': 'light-bulb', 'System': 'computer-desktop', 'Other': 'document-text'
                };
                const iconName = assetIcons[asset.type] || 'document-text';

                const assetHTML = `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border-l-4 border-indigo-200 transition-all duration-300 hover:shadow-xl hover:scale-[1.02] flex flex-col relative">
                        <button class="remove-asset-btn absolute top-3 right-3 p-1 text-red-500 hover:bg-red-100 rounded-full transition-colors duration-200 z-10" data-asset-id="${asset._id}" data-asset-name="${assetName}" title="Delete Asset">
                            <hero-icon-outline name="trash" class="h-5 w-5"></hero-icon-outline>
                        </button>
                        <img src="${imageUrl}" alt="${assetName}" class="activity-card-image">
                        <div class="p-5 flex flex-col flex-grow">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-bold text-gray-900 flex items-center">
                                    <hero-icon-solid name="${iconName}" class="h-5 w-5 mr-2 text-indigo-500"></hero-icon-solid> ${assetName}
                                </h3>
                                <span class="text-2xl font-extrabold text-indigo-600">x ${asset.quantity}</span>
                            </div>
                            <p class="text-sm text-gray-700 flex-grow">${asset.description || 'No description provided.'}</p>
                        </div>
                    </div>
                `;
                assetInventoryContainer.innerHTML += assetHTML;
            });
        }
        
        function renderFeesView() {
            const statusFilter = feesFilterSelect.value;
            const searchTerm = feesSearchInput.value.toLowerCase();
            feesStudentListContainer.innerHTML = '';
            
            const allStudents = appState.blocks.flatMap(block => 
                (block.rooms || []).flatMap(room => 
                    (room.students || []).map(student => ({
                        ...student, roomNumber: room.roomNumber, blockName: block.blockName
                    }))
                )
            );
            
            const filteredStudents = allStudents.filter(student => {
                const statusMatch = (statusFilter === 'All') || (student.feeStatus === statusFilter);
                const searchMatch = (student.name.toLowerCase().includes(searchTerm)) || (student.rollNumber.toLowerCase().includes(searchTerm));
                return statusMatch && searchMatch;
            });

            if (filteredStudents.length === 0) {
                 // RENDER: Updated to use icon
                feesStudentListContainer.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 py-6 flex items-center justify-center"><hero-icon-solid name="user-circle" class="h-5 w-5 inline-block mr-1 text-gray-400"></hero-icon-solid> No students match the criteria.</td></tr>`;
                return;
            }
            
            filteredStudents.forEach(student => {
                const isPaid = student.feeStatus === 'Paid';
                const statusClass = isPaid ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700';
                // Buttons updated to Indigo colors and icons
                const buttonClass = isPaid ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-indigo-600 hover:bg-indigo-700';
                const buttonIcon = isPaid ? 'clock' : 'check';
                const buttonText = isPaid ? 'Mark Pending' : 'Mark Paid';

                const rowHTML = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <img class="h-10 w-10 rounded-full object-cover border border-gray-200" src="${student.profileImageUrl || 'https://i.pravatar.cc/150?img=60'}" alt="${student.name}">
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-semibold text-gray-900">${student.name}</div>
                                    <div class="text-xs text-gray-500">${student.email || 'N/A'}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${student.rollNumber}</div>
                            <div class="text-xs text-gray-500">${student.department || 'N/A'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            ${student.blockName} / <strong class="text-indigo-600">${student.roomNumber}</strong>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                ${student.feeStatus}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                            <button class="toggle-fee-status-btn px-3 py-2 text-white text-xs font-semibold rounded-lg shadow-md ${buttonClass} flex items-center justify-center mx-auto transition duration-150" data-student-id="${student._id}">
                                <hero-icon-solid name="${buttonIcon}" class="h-4 w-4 mr-1"></hero-icon-solid>
                                ${buttonText}
                            </button>
                        </td>
                    </tr>
                `;
                feesStudentListContainer.innerHTML += rowHTML;
            });
        }
        
        function renderVisitorsView() {
            const searchTerm = visitorSearchInput.value.toLowerCase();
            const dateFilter = visitorDateFilter.value;
            visitorLogContainer.innerHTML = '';
            
            const filteredLogs = visitorLogData.filter(log => {
                const searchMatch = (log.visitorName.toLowerCase().includes(searchTerm)) || (log.studentName.toLowerCase().includes(searchTerm));
                const dateMatch = (!dateFilter) || (log.date === dateFilter);
                return searchMatch && dateMatch;
            });
            
            if (filteredLogs.length === 0) {
                 // RENDER: Updated to use icon
                visitorLogContainer.innerHTML = `<tr><td colspan="6" class="text-center text-gray-500 py-6 flex items-center justify-center"><hero-icon-solid name="document-text" class="h-5 w-5 inline-block mr-1 text-gray-400"></hero-icon-solid> No visitor logs match the criteria.</td></tr>`;
                return;
            }

            filteredLogs.slice().reverse().forEach(log => {
                const rowHTML = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">${log.visitorName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${log.studentName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-indigo-600 font-medium">${log.roomNumber}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${log.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium">${log.timeIn}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-medium">${log.timeOut || 'N/A'}</td>
                    </tr>
                `;
                visitorLogContainer.innerHTML += rowHTML;
            });
        }

        // --- 6. MODAL & VIEW-SWITCHING LOGIC ---
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('hidden', 'active');
            void modal.offsetWidth;
            modal.classList.remove('hidden');
            requestAnimationFrame(() => {
                modal.classList.add('active');
            });
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('active');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300); 
        }
        
        function hideAllViews() {
            dashboardView.classList.add('hidden');
            detailView.classList.add('hidden');
            feesView.classList.add('hidden');
            visitorsView.classList.add('hidden');
            complaintsView.classList.add('hidden');
        }

        document.addEventListener('click', (e) => {
            if (e.target.dataset.modalHide) {
                hideModal(e.target.dataset.modalHide);
            }
        });

        backToDashboardBtn.addEventListener('click', () => {
            hideAllViews();
            dashboardView.classList.remove('hidden');
            detailView.dataset.currentHostelKey = '';
            currentRoomData = null;
            loadHostelData();
        });

        hostelBlockContainer.addEventListener('click', (e) => {
            const link = e.target.closest('.block-link');
            if (link) {
                e.preventDefault();
                const blockKey = link.dataset.hostelKey;
                renderDetailView(blockKey);
                hideAllViews();
                detailView.classList.remove('hidden');
            }
        });
        
        // --- 7. ASSET ASSIGNMENT LOGIC (Updated rendering to use icons) ---
        function getAssetOptionsHTML() {
            let optionsHTML = '<option value="" disabled selected>Select asset...</option>';
            const availableAssets = appState.assets.filter(a => a.quantity > 0);
            if(availableAssets.length === 0) {
                return '<option value="" disabled>No assets in stock</option>';
            }
            availableAssets.forEach(asset => {
                optionsHTML += `<option value="${asset.name}" data-qty="${asset.quantity}">${asset.name} (Stock: ${asset.quantity})</option>`;
            });
            return optionsHTML;
        }

        function addAssetAssignmentRow(container) {
            const assetOptions = getAssetOptionsHTML();
            
            const noAssetsMsg = container.querySelector('.no-assets-msg');
            if(noAssetsMsg) noAssetsMsg.remove();

            if (assetOptions.includes("No assets")) {
                 // RENDER: Updated to use icon
                if (!container.querySelector('.asset-assignment-row')) {
                     container.innerHTML = '<p class="text-sm text-gray-500 no-assets-msg flex items-center"><hero-icon-outline name="archive-box-x-mark" class="h-4 w-4 mr-1"></hero-icon-outline> No assets in stock to assign.</p>';
                }
                return;
            }
            
            const row = document.createElement('div');
            // RENDER: Adjusted grid layout/classes for new look
            row.className = 'asset-assignment-row grid grid-cols-4 gap-3 items-center'; 
            row.innerHTML = `
                <select name="assignedAssetName" class="asset-select col-span-2 block w-full rounded-lg border-gray-300 shadow-sm text-sm focus:border-indigo-500 focus:ring-indigo-500">
                    ${assetOptions}
                </select>
                <input type="number" name="assignedAssetQty" value="1" min="1" class="asset-qty block w-full rounded-lg border-gray-300 shadow-sm text-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Qty">
                <button type="button" class="remove-asset-row-btn text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-50 transition duration-150">
                    <hero-icon-solid name="minus-circle" class="h-5 w-5"></hero-icon-solid>
                </button>
            `;
            
            row.querySelector('.remove-asset-row-btn').addEventListener('click', () => {
                row.remove();
                 // RENDER: Updated to use icon
                if (!container.querySelector('.asset-assignment-row') && assetOptions.includes("No assets")) {
                     container.innerHTML = '<p class="text-sm text-gray-500 no-assets-msg flex items-center"><hero-icon-outline name="archive-box-x-mark" class="h-4 w-4 mr-1"></hero-icon-outline> No assets in stock to assign.</p>';
                }
            });
            
            container.appendChild(row);
        }

        addRoomAssetRowBtn.addEventListener('click', () => addAssetAssignmentRow(roomAssetAssignmentContainer));
        addStudentAssetRowBtn.addEventListener('click', () => addAssetAssignmentRow(studentAssetAssignmentContainer));

        function processAssetAssignments(container) {
            const assignmentRows = container.querySelectorAll('.asset-assignment-row');
            const assignedAssets = [];
            const tempStockCheck = {}; 

            for (const row of assignmentRows) {
                 const assetSelect = row.querySelector('.asset-select');
                 const assetQtyInput = row.querySelector('.asset-qty');

                 const assetName = assetSelect.value;
                 const quantity = parseInt(assetQtyInput.value, 10);
                
                if (!assetName || !quantity || quantity <= 0) { continue; }

                const assetInStock = appState.assets.find(a => a.name === assetName);
                if (!assetInStock) { alert(`Error: Asset "${assetName}" not found in inventory.`); return null; }

                const currentStock = assetInStock.quantity;
                const alreadyAssigned = tempStockCheck[assetName] || 0;
                
                if (quantity > (currentStock - alreadyAssigned)) {
                    alert(`Error: Not enough "${assetName}" in stock. Available: ${currentStock}, Requested: ${quantity + alreadyAssigned}`);
                    return null; 
                }

                tempStockCheck[assetName] = alreadyAssigned + quantity;
                assignedAssets.push({ name: assetName, quantity: quantity });
            }
            
            return assignedAssets;
        }

        // --- 8. FORM & DATA HANDLERS (Updated to use local state persistence) ---
        addBlockForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const blockName = document.getElementById('block-name').value;
            const blockKey = document.getElementById('block-key').value.toLowerCase().replace(/\s+/g, '-');
            const blockTheme = document.getElementById('block-theme').value;
            if (!blockName || !blockKey) return;

            if (appState.blocks.some(b => b.blockKey === blockKey)) {
                alert('Error: Block with this unique key already exists.');
                return;
            }

            try {
                // Simulate API POST request success
                const newBlock = { 
                    _id: 'b' + Date.now(), 
                    blockName, 
                    blockKey, 
                    blockTheme, 
                    rooms: [] 
                };
                appState.blocks.push(newBlock);
                await loadHostelData(); 
                showSuccess(`Block "${blockName}" added successfully.`);
                hideModal('add-block-modal');
                addBlockForm.reset();
            } catch (error) { alert(`Error adding block: ${error.message}`); }
        });

        addRoomForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const assignedAssets = processAssetAssignments(roomAssetAssignmentContainer);
            if (assignedAssets === null) { return; }

            const blockKey = detailView.dataset.currentHostelKey;
            const block = appState.blocks.find(b => b.blockKey === blockKey);
            if (!block) { alert('Error: No block selected.'); return; }
            
            const roomNumber = document.getElementById('room-id').value;
            const floor = document.getElementById('room-floor').value;
            const capacity = parseInt(document.getElementById('room-capacity').value, 10);
            
            if (block.rooms.some(r => r.roomNumber === roomNumber)) {
                alert(`Error: Room number ${roomNumber} already exists in ${block.blockName}.`);
                return;
            }

            const submitBtn = addRoomForm.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Saving...';
                
                // Simulate API POST request success
                const newRoom = {
                    _id: 'r' + Date.now(),
                    roomNumber,
                    floor,
                    capacity,
                    students: [],
                    assets: assignedAssets,
                    imageUrl: 'https://picsum.photos/300/150?random=' + Date.now() 
                };
                block.rooms.push(newRoom);
                
                // Update asset stock locally
                assignedAssets.forEach(a => updateAssetQuantity(a.name, -a.quantity));

                await loadHostelData(); await loadAssetData(); 
                showSuccess(`Room ${roomNumber} added to ${block.blockName}.`);
                
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Room';

                hideModal('add-room-modal');
                addRoomForm.reset();
                roomAssetAssignmentContainer.innerHTML = ''; 
            } catch (error) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Room';
                alert(`Error adding room: ${error.message}`);
            }
        });

        addStudentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const assignedAssets = processAssetAssignments(studentAssetAssignmentContainer);
            if (assignedAssets === null) { return; }
            
            const blockKey = detailView.dataset.currentHostelKey;
            const block = appState.blocks.find(b => b.blockKey === blockKey);
            const roomId = document.getElementById('student-room-id').value;
            const room = block.rooms.find(r => r._id === roomId);

            if (!room || (room.students || []).length >= room.capacity) {
                alert('Error: Selected room is full or invalid.');
                return;
            }

            const newStudent = {
                _id: 's' + Date.now(),
                username: document.getElementById('student-username').value,
                password: '***', // Never store or show password on frontend
                roomId: roomId,
                joiningDate: document.getElementById('student-joining-date').value,
                feeStatus: document.getElementById('student-fee-status').value,
                paymentMethod: document.getElementById('student-payment-method').value,
                name: document.getElementById('student-name').value,
                rollNumber: document.getElementById('student-roll-number').value,
                course: document.getElementById('student-course').value,
                department: document.getElementById('student-department').value,
                year: document.getElementById('student-year').value,
                email: document.getElementById('student-email').value,
                phone: document.getElementById('student-phone').value,
                profileImageUrl: 'https://i.pravatar.cc/150?img=' + Math.floor(Math.random() * 70), 
                assets: assignedAssets,
            };

            const submitBtn = addStudentForm.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Uploading...';
                
                // Simulate API POST request success
                room.students.push(newStudent);
                
                // Update asset stock locally
                assignedAssets.forEach(a => updateAssetQuantity(a.name, -a.quantity));

                await loadHostelData(); await loadAssetData(); 
                showSuccess(`Student ${newStudent.name} added to ${room.roomNumber}.`);
                
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Student';

                hideModal('add-student-modal');
                addStudentForm.reset();
                studentAssetAssignmentContainer.innerHTML = ''; 
            } catch (error) {
                alert(`Error adding student: ${error.message}`);
                const submitBtn = addStudentForm.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Student';
            }
        });

        addEventForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newEvent = {
                id: Date.now(),
                title: document.getElementById('event-title').value,
                type: document.getElementById('event-type').value,
                date: document.getElementById('event-date').value,
                description: document.getElementById('event-description').value,
            };
            eventData.push(newEvent);
            renderEvents();
            showSuccess(`Event "${newEvent.title}" posted.`);
            hideModal('add-event-modal');
            addEventForm.reset();
        });

        addClubActivityForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(addClubActivityForm);
            
            const newActivity = {
                _id: 'act' + Date.now(),
                title: formData.get('title'),
                type: formData.get('type'),
                date: formData.get('date'),
                description: formData.get('description'),
                imageUrl: 'https://picsum.photos/300/150?random=' + Date.now()
            };
            
            const submitBtn = addClubActivityForm.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Uploading...';

                // Simulate API POST request success
                clubActivityData.push(newActivity);
                
                submitBtn.disabled = false;
                submitBtn.textContent = 'Post Activity';

                await loadClubActivities();
                showSuccess(`Activity "${newActivity.title}" posted.`);
                hideModal('add-club-activity-modal');
                addClubActivityForm.reset();
            } catch (error) {
                alert(`Error adding activity: ${error.message}`);
                const submitBtn = addClubActivityForm.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Post Activity';
            }
        });
        
        addAssetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const type = assetTypeSelect.value;
            const otherName = document.getElementById('asset-name-other').value;
            const name = type === 'Other' ? otherName : type;

            if (type === 'Other' && !otherName) { alert('Please specify the asset name when selecting "Other".'); return; }
            
            const quantity = parseInt(document.getElementById('asset-quantity').value, 10);
            const description = document.getElementById('asset-description').value;

            const submitBtn = addAssetForm.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Saving...';
                
                // Simulate API POST request success
                const newAsset = {
                    _id: 'a' + Date.now(),
                    type,
                    name,
                    quantity,
                    description,
                    imageUrl: 'https://picsum.photos/300/150?random=' + Date.now()
                };
                appState.assets.push(newAsset);

                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Asset';

                await loadAssetData(); 
                showSuccess(`Asset "${name}" (x${quantity}) added to inventory.`);
                hideModal('add-asset-modal');
                addAssetForm.reset();
                assetNameOtherWrapper.classList.add('hidden');
            } catch (error) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Asset';
                alert(`Error adding asset: ${error.message}`);
            }
        });

        assetTypeSelect.addEventListener('change', () => {
            if (assetTypeSelect.value === 'Other') {
                assetNameOtherWrapper.classList.remove('hidden');
            } else {
                assetNameOtherWrapper.classList.add('hidden');
            }
        });

        // --- 9. DELETE HANDLERS (Logic maintained) ---
        hostelBlockContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-block-btn');
            if (button) {
                e.preventDefault(); e.stopPropagation();
                const blockId = button.dataset.blockId;
                const blockName = button.dataset.blockName;
                if (confirm(`Are you sure you want to delete the block "${blockName}"?\nThis action is permanent and will delete all associated rooms, students, and return their assets.`)) {
                    
                    const block = appState.blocks.find(b => b._id === blockId);
                    if (!block) { alert('Block not found.'); return; }
                    
                    try {
                        // Simulate API DELETE request success
                        const blockIndex = appState.blocks.findIndex(b => b._id === blockId);
                        if (blockIndex !== -1) {
                            // Logic for asset return (simplified: assume all student/room assets are returned)
                            (block.rooms || []).forEach(room => {
                                (room.assets || []).forEach(a => updateAssetQuantity(a.name, a.quantity));
                                (room.students || []).forEach(s => {
                                    (s.assets || []).forEach(a => updateAssetQuantity(a.name, a.quantity));
                                });
                            });

                            appState.blocks.splice(blockIndex, 1);
                            await loadHostelData(); await loadAssetData(); 
                            showSuccess(`Block "${blockName}" deleted.`);
                        }
                    } catch (error) { alert(`Error deleting block: ${error.message}`); }
                }
            }
        });
        
        clubActivityContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-activity-btn');
            if (button) {
                e.preventDefault(); e.stopPropagation();
                const activityId = button.dataset.activityId;
                const activityTitle = button.dataset.activityTitle;
                if (confirm(`Are you sure you want to delete the activity "${activityTitle}"?`)) {
                    try {
                        // Simulate API DELETE request success
                        const activityIndex = clubActivityData.findIndex(a => a._id === activityId);
                        if (activityIndex !== -1) {
                            clubActivityData.splice(activityIndex, 1);
                            await loadClubActivities();
                            showSuccess(`Activity "${activityTitle}" deleted.`);
                        }
                    } catch (error) { alert(`Error deleting activity: ${error.message}`); }
                }
            }
        });

        assetInventoryContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-asset-btn');
            if (button) {
                e.preventDefault(); e.stopPropagation();
                const assetId = button.dataset.assetId;
                const assetName = button.dataset.assetName;
                if (confirm(`Are you sure you want to delete "${assetName}" from the inventory?`)) {
                    try {
                        // Simulate API DELETE request success
                        const assetIndex = appState.assets.findIndex(a => a._id === assetId);
                        if (assetIndex !== -1) {
                            // Warning: This does not check if the asset is still assigned to a room/student. 
                            appState.assets.splice(assetIndex, 1);
                            await loadAssetData(); 
                            showSuccess(`Asset "${assetName}" deleted from inventory.`);
                        }
                    } catch (error) { alert(`Error deleting asset: ${error.message}`); }
                }
            }
        });

        // --- 10. DETAIL VIEW & MODAL LISTENERS (Logic maintained) ---
        function filterAndSearchRooms() {
            const searchTerm = roomSearchInput.value.toLowerCase();
            const filterTerm = roomFilterSelect.value;
            const roomCards = roomListContainer.querySelectorAll('.room-card');

            roomCards.forEach(card => {
                const roomId = card.dataset.roomId.toLowerCase();
                const roomStatus = card.dataset.roomStatus;
                const searchMatch = roomId.includes(searchTerm);
                // FIX: Use 'Full' and 'Available' text for comparison
                const filterMatch = (filterTerm === 'All') || (filterTerm === 'Full' && roomStatus === 'Full') || (filterTerm === 'Available' && roomStatus === 'Available');
                card.style.display = (searchMatch && filterMatch) ? 'block' : 'none';
            });
        }
        roomSearchInput.addEventListener('input', filterAndSearchRooms);
        roomFilterSelect.addEventListener('change', filterAndSearchRooms);

        roomListContainer.addEventListener('click', (e) => {
            const card = e.target.closest('.room-card');
            if (card) {
                const roomId = card.dataset.roomId;
                const blockKey = detailView.dataset.currentHostelKey;
                const block = appState.blocks.find(b => b.blockKey === blockKey);
                if (!block) return;
                const room = block.rooms.find(r => r._id === roomId);
                if (!room) return;
                
                renderRoomDetailsModal(room, block);
                showModal('room-details-modal');
            }
        });

        modalDeleteRoomBtn.addEventListener('click', async () => {
            if (!currentRoomData || !currentRoomData._id) return;
            const blockKey = detailView.dataset.currentHostelKey;
            const roomId = currentRoomData._id;

            if (confirm(`Are you sure you want to delete room ${currentRoomData.roomNumber}?\nThis will also remove all students in it and return all assets to stock.`)) {
                try {
                    // Simulate API DELETE request success
                    const blockIndex = appState.blocks.findIndex(b => b.blockKey === blockKey);
                    if (blockIndex !== -1) {
                        const roomIndex = appState.blocks[blockIndex].rooms.findIndex(r => r._id === roomId);
                        if (roomIndex !== -1) {
                            const room = appState.blocks[blockIndex].rooms[roomIndex];
                            
                            // Return Room Assets
                            (room.assets || []).forEach(a => updateAssetQuantity(a.name, a.quantity));

                            // Return Student Assets & Remove Students
                            (room.students || []).forEach(s => {
                                (s.assets || []).forEach(a => updateAssetQuantity(a.name, a.quantity));
                            });
                            
                            appState.blocks[blockIndex].rooms.splice(roomIndex, 1);
                            await loadHostelData(); await loadAssetData(); 
                            showSuccess(`Room ${room.roomNumber} deleted.`);
                            hideModal('room-details-modal');
                            return;
                        }
                    } 
                    alert('Error: Room not found.');
                } catch (error) { alert(`Error deleting room: ${error.message}`); }
            }
        });

        modalOccupantContainer.addEventListener('click', async (e) => {
            const button = e.target.closest('.remove-student-btn');
            if (button) {
                e.preventDefault(); e.stopPropagation();
                const studentId = button.dataset.studentId;
                const studentLocation = findStudentLocation(studentId);
                
                if (!studentLocation) { alert('Student not found.'); return; }
                const { room, student } = studentLocation;

                if (confirm(`Are you sure you want to remove student ${student.name}?\nTheir assets will be returned to stock.`)) {
                    try {
                        // Simulate API DELETE request success
                        const studentIndex = room.students.findIndex(s => s._id === studentId);
                        if (studentIndex !== -1) {
                            
                            // Return Student Assets
                            (student.assets || []).forEach(a => updateAssetQuantity(a.name, a.quantity));

                            room.students.splice(studentIndex, 1);
                            await loadHostelData(); await loadAssetData(); 

                            // Update modal state
                            renderRoomDetailsModal(room, studentLocation.block);
                            showSuccess(`Student ${student.name} removed.`);
                        }
                    } catch (error) { alert(`Error removing student: ${error.message}`); }
                }
            }
        });
        
        // --- 11. OTHER LISTENERS (Logic maintained) ---
        adminLogoutBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to log out?')) {
                // In a real application, this would clear session/token
                window.location.href = '#'; // Stay on the same page for mock demo
            }
        });
        
        feesSearchInput.addEventListener('input', renderFeesView);
        feesFilterSelect.addEventListener('change', renderFeesView);
        
        visitorSearchInput.addEventListener('input', renderVisitorsView);
        visitorDateFilter.addEventListener('change', renderVisitorsView);
        
        feesStudentListContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.toggle-fee-status-btn');
            if (button) {
                const studentId = button.dataset.studentId;
                const studentLocation = findStudentLocation(studentId);
                
                if (studentLocation) {
                    const student = studentLocation.student;
                    student.feeStatus = (student.feeStatus === 'Paid') ? 'Pending' : 'Paid';
                    saveState('appState.blocks', appState.blocks);
                    renderFeesView();
                    renderDashboard(); // Update dashboard stats
                    showSuccess(`Fee status updated to ${student.feeStatus}`);
                } else {
                    showError('Student not found for fee update.');
                }
            }
        });

        // Complaints filtering and search (Logic maintained)
        complaintSearchInput.addEventListener('input', renderComplaintsView);
        complaintStatusFilter.addEventListener('change', renderComplaintsView);
        complaintTypeFilter.addEventListener('change', renderComplaintsView);

        // Refresh complaints (Logic maintained)
        refreshComplaintsBtn.addEventListener('click', () => {
            loadComplaintsData();
            showSuccess('Complaints refreshed');
        });

        // Complaint actions (Logic maintained)
        complaintsListContainer.addEventListener('click', async (e) => {
            const viewBtn = e.target.closest('.view-complaint-details-btn');
            const statusBtn = e.target.closest('.update-complaint-status-btn');
            
            if (viewBtn) {
                const complaintId = viewBtn.dataset.complaintId;
                showComplaintDetails(complaintId);
            }
            
            if (statusBtn) {
                const complaintId = statusBtn.dataset.complaintId;
                const newStatus = statusBtn.dataset.newStatus;
                
                let adminNotes = '';
                if (newStatus === 'Resolved') {
                    adminNotes = prompt('Enter resolution notes:');
                    if (adminNotes === null) return;
                }
                
                if (await updateComplaintStatus(complaintId, newStatus, adminNotes)) {
                    renderComplaintsView();
                }
            }
        });

        // Add response to complaint (Logic maintained)
        complaintDetailsContent.addEventListener('click', async (e) => {
            if (e.target.id === 'submit-complaint-response') {
                const complaintId = e.target.dataset.complaintId;
                const responseText = document.getElementById('complaint-response').value.trim();
                
                if (!responseText) { showError('Please enter a response'); return; }
                
                if (await addComplaintResponse(complaintId, responseText)) {
                    document.getElementById('complaint-response').value = '';
                    showComplaintDetails(complaintId);
                }
            }
        });

        // --- 12. INITIALIZE APP (Logic maintained) ---
        function initApp() {
            // FIX: Initial load relies on mock functions
            loadHostelData();
            loadClubActivities();
            loadAssetData();
            loadComplaintsData();
            renderEvents();
             // Set default for visitor date filter
            visitorDateFilter.value = new Date().toISOString().split('T')[0];
        }

        initApp();
    });
    </script>
</body>
</html>