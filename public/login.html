<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IIT Hostel Management - Login</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Base Styles */
        :root {
            --primary-blue: #2d6fff; /* Main Blue */
            --dark-blue: #0056b3;
            --text-dark: #202020; 
            --text-light: #555; 
            --logo-purple: #9B59B6;
            --logo-orange: #FF884D;
            --card-bg: #ffffff;
            --input-bg: #fdfdfe; /* Exact light background for inputs */
            --input-border: #e0e0e0; 
            --shadow-subtle: 0 10px 40px rgba(0, 0, 0, 0.08);
            --light-blue-theme: #f0f3f8; /* Base color for background gradient */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            /* Light blue themed background */
            background: linear-gradient(135deg, var(--light-blue-theme) 0%, #ffffff 100%); 
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; 
            position: relative; 
        }
        
        /* Animated Background Bubbles */
        .area { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 0; }
        .circles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .circles li {
            position: absolute; display: block; list-style: none; width: 20px; height: 20px;
            background: rgba(108, 92, 231, 0.15); 
            animation: animate 25s linear infinite; bottom: -150px; 
            border-radius: 50%; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); 
        }
        .circles li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; background: rgba(108, 92, 231, 0.25); }
        .circles li:nth-child(2) { left: 10%; width: 30px; height: 30px; animation-delay: 2s; animation-duration: 18s; }
        .circles li:nth-child(3) { left: 70%; width: 25px; height: 25px; animation-delay: 4s; animation-duration: 20s; }
        .circles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 15s; }
        .circles li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; animation-duration: 30s; }
        .circles li:nth-child(6) { left: 75%; width: 100px; height: 100px; animation-delay: 3s; animation-duration: 12s; }
        .circles li:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; animation-duration: 40s; background: rgba(108, 92, 231, 0.35); }
        .circles li:nth-child(8) { left: 50%; width: 40px; height: 40px; animation-delay: 15s; animation-duration: 25s; }
        .circles li:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
        .circles li:nth-child(10){ left: 85%; width: 130px; height: 130px; animation-delay: 0s; animation-duration: 11s; }

        @keyframes animate {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.9; } 
            100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; }
        }
        
        /* Logo Styling - Exact Size and Spacing */
        .logo {
            width: 85px; /* Slightly increased width */
            height: 42px; /* Slightly increased height */
            margin-bottom: 25px; 
            margin-top: 5px; /* Added slight top margin to push it down */
            /* Using inline SVG data URL for the "IIT" look */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 50'%3E%3C!-- Purple i --%3E%3Crect x='10' y='5' width='10' height='30' fill='%239B59B6'/%3E%3Ccircle cx='15' cy='0' r='5' fill='%239B59B6'/%3E%3C!-- Purple i --%3E%3Crect x='30' y='5' width='10' height='30' fill='%239B59B6'/%3E%3Ccircle cx='35' cy='0' r='5' fill='%239B59B6'/%3E%3C!-- Orange t --%3E%3Crect x='50' y='10' width='30' height='10' fill='%23FF884D'/%3E%3Crect x='60' y='5' width='10' height='40' fill='%23FF884D'/%3E%3C!-- Orange i --%3E%3Crect x='85' y='5' width='10' height='30' fill='%23FF884D'/%3E%3Ccircle cx='90' cy='0' r='5' fill='%23FF884D'/%3E%3C/svg%3E");
            background-size: contain; background-repeat: no-repeat; background-position: center;
        }

        /* Login Card Container */
        .login-container {
            width: 100%; 
            max-width: 380px; 
            padding: 40px 35px; 
            background-color: var(--card-bg); 
            border-radius: 16px; 
            box-shadow: var(--shadow-subtle); 
            text-align: center;
            position: relative; z-index: 1; 
        }

        /* Login Title - adjusted margin */
        .login-title { 
            color: var(--primary-blue); 
            font-size: 1.1em; 
            font-weight: 600; 
            margin-bottom: 30px; /* Increased margin for spacing */
        }

        /* Form Group - adjusted margin-bottom */
        .form-group { margin-bottom: 20px; text-align: left; } 
        
        /* Label - adjusted font size and margin-bottom */
        .form-group label { 
            display: block; font-weight: 500; color: var(--text-dark); 
            margin-bottom: 8px; 
            font-size: 0.9em; 
        }

        /* Input Fields - adjusted padding, border, background */
        .form-group input, .form-group select { /* Added select for role dropdown */
            width: 100%; 
            padding: 10px 12px; 
            border: 1px solid var(--input-border); 
            border-radius: 8px; 
            background-color: var(--input-bg);
            font-size: 0.95em; 
            transition: box-shadow 0.3s, border-color 0.3s;
        }
        .form-group input::placeholder {
            color: #b0b0b0;
            font-size: 0.95em;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none; 
            border-color: var(--primary-blue); 
            box-shadow: 0 0 0 2px rgba(45, 111, 255, 0.2); 
        }

        /* Login Button - adjusted margin and size */
        .login-btn {
            width: 100%; padding: 12px 15px; 
            background-color: var(--primary-blue);
            color: white; border: none; border-radius: 8px;
            font-size: 1em; font-weight: 600; cursor: pointer;
            transition: background-color 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 10px rgba(45, 111, 255, 0.4); 
            margin-top: 25px; 
            margin-bottom: 12px; 
            display: flex; justify-content: center; align-items: center;
        }
        .login-btn:hover { background-color: var(--dark-blue); }
        .login-btn i { margin-left: 10px; font-size: 0.9em; }
        
        /* Google Button - adjusted spacing and border */
        .google-btn {
            width: 100%; padding: 10px; 
            background-color: var(--card-bg);
            color: var(--text-dark); border: 1px solid var(--input-border); border-radius: 8px; /* Used input-border for clarity */
            font-size: 0.9em; 
            font-weight: 500; 
            cursor: pointer;
            transition: box-shadow 0.3s, border-color 0.3s; 
            margin-top: 0; 
            margin-bottom: 30px; 
            display: flex; justify-content: center; align-items: center;
        }
        .google-btn:hover { box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); border-color: #c0c0c0; }
        .google-icon { width: 18px; height: 18px; margin-right: 10px; }
        
        /* Forgot Password Link - adjusted spacing and color */
        .forgot-password { 
            display: block; 
            margin-top: 0; 
            font-size: 0.85em; 
            color: #5d5d5d; 
            text-decoration: none; 
            transition: color 0.3s; 
        }
        .forgot-password:hover { color: var(--primary-blue); }

        /* Error Message Placeholder - Integrated for logic */
        #msg { 
            height: 1.4em; 
            margin-bottom: 15px; 
            font-size: 0.85em; 
            font-weight: 500;
            color: red; /* Default for error */
            visibility: hidden; /* Hide until content is present */
        } 

        /* Custom style for the role dropdown to be discrete */
        #role-select-group {
            margin-top: -10px; /* Adjust spacing to keep it close to password */
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="area" >
        <ul class="circles">
            <li></li> <li></li> <li></li> <li></li> <li></li>
            <li></li> <li></li> <li></li> <li></li> <li></li>
        </ul>
    </div>

    <div class="login-container">
        
        <div class="logo"></div>

        <div class="login-title">Hostel Management System</div>

        <form id="loginForm">
            <div class="form-group">
                <label for="username">Email Address</label>
                <input type="text" id="username" placeholder="Enter your email" required>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password" required>
            </div>

            <div class="form-group" id="role-select-group">
                <label for="role">Login As</label>
                <select id="role">
                    <option value="admin">Admin</option>
                    <option value="student" selected>Student</option>
                </select>
            </div>

            <p id="msg" class="text-sm text-red-600 font-medium"></p> 

            <button type="submit" id="loginButton" class="login-btn">
                Login <i class="fas fa-arrow-right"></i>
            </button>
        </form>

        <button class="google-btn" onclick="alert('Google login not implemented yet.')">
            <svg class="google-icon" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22 12c0-.7-.06-1.37-.16-2.03H12v4.06h5.45c-.24 1.18-.84 2.17-1.74 2.91v2.81h3.62c2.1-1.93 3.33-4.75 3.33-8.79z"/>
                <path fill="#34A853" d="M12 22c3.24 0 5.92-1.08 7.89-2.92l-3.62-2.81c-.96.65-2.2 1.03-4.27 1.03-3.29 0-6.07-2.22-7.07-5.18H1.32v2.89C3.18 20.39 7.23 22 12 22z"/>
                <path fill="#FBBC05" d="M4.93 14.82C4.69 14.15 4.56 13.39 4.56 12s.13-2.15.37-2.82V6.13H1.32c-.89 1.76-1.32 3.73-1.32 5.87s.43 4.11 1.32 5.87l3.61-2.81z"/>
                <path fill="#EA4335" d="M12 4.12c1.77 0 3.34.61 4.58 1.79l3.1-3.1C18.01 1.5 15.24.08 12 .08 7.23.08 3.18 1.7 1.32 4.59L4.93 7.4C5.93 4.44 8.71 2.22 12 2.22z"/>
            </svg>
            Continue with Google
        </button>

        <a href="#" class="forgot-password">Forgot your password?</a>
    </div>
    
    <script>
    async function login(event) {
        event.preventDefault(); // Prevent default form submission

        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        const role = document.getElementById("role").value; // Get role value
        const msgEl = document.getElementById("msg");

        // Clear previous message and hide it
        msgEl.innerText = "";
        msgEl.style.visibility = "hidden";
        msgEl.style.color = "red"; // Reset color

        try {
            const res = await fetch("https://workinghost.onrender.com/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password, role }),
            });
            const data = await res.json();

            if (res.ok) {
                // Handle studentId storage
                if (data.studentId) {
                    localStorage.setItem('currentStudentId', data.studentId);
                } else {
                    localStorage.removeItem('currentStudentId');
                }
                
                // Show success message before redirecting
                msgEl.style.color = "green";
                msgEl.innerText = "Login successful! Redirecting...";
                msgEl.style.visibility = "visible";
                
                setTimeout(() => {
                    // --- FIX APPLIED HERE ---
                    if (role === 'admin') {
                        // Redirect admin to the main Hostel Admin Dashboard file
                        window.location.href = 'my admin page.html'; 
                    } else {
                        // Use the default redirect provided by the server for students
                        window.location.href = data.redirect;
                    }
                }, 1000); // Small delay so user sees the message

            } else {
                // Handle login failure
                msgEl.style.color = "red";
                msgEl.innerText = data.message || "Invalid credentials.";
                msgEl.style.visibility = "visible";
            }
        } catch (error) {
            console.error("Login error:", error);
            msgEl.style.color = "red";
            msgEl.innerText = "An error occurred. Please try again.";
            msgEl.style.visibility = "visible";
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            // Attach the login function to the form's submit event
            loginForm.addEventListener('submit', login);
        }
    });
</script>
</body>
</html>